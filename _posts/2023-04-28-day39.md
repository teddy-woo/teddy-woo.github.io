---
date: 2023-04-05 00:00:00
layout: post
title: DevOps&#91;SECTION2&#93; <AWS ë°°í¬ ìë™í™”> DAY 2 LOG 
subtitle: '<AWS ë°°í¬ ìë™í™”> DAY 2'
description: <AWS ë°°í¬ ìë™í™”> DAY 2
image: /404.jpg
optimized_image: /404.jpg
category: í”„ë¡œì íŠ¸ íšŒê³ 
tags:
  - AWS
  - ECR
  - ìë™í™”
  - Docker
  - mongo DB
  - NoSql
  - HTTPS
  - HTTP
  - POSTMAN
  - íšŒê³ 
  - DevOps BootCamp
author: teddy-woo

---

# #í•™ìŠµ ëª©í‘œ

- WAS ë° mongoDB ì´ë¯¸ì§€ë¥¼ ECSë¥¼ í†µí•´ ë°°í¬
- WAS ì´ë¯¸ì§€ì˜ ë°°í¬ ìë™í™”ë¥¼ êµ¬í˜„
- WASì™€ ì—°ê²°ëœ ë¡œë“œ ë°¸ëŸ°ì„œì— HTTPSë¥¼ ì ìš©
- ë¡œë“œ ë°¸ëŸ°ì„œì™€ ECS ì„œë¹„ìŠ¤ë¥¼ ì—°ê²°
- GitHub Actionì„ ì´ìš©í•´ ECS ë°°í¬ ê³¼ì • workflowë¥¼ ì¶”ê°€
- ë¯¼ê° ì •ë³´ê°€ ì ˆëŒ€ Gitì— ë…¸ì¶œë˜ì§€ ì•Šë„ë¡ ì„¤ì •

# #í•´ê²° ê³¼ì œ

ğŸ’¡ ë§ˆì¼ìŠ¤í†¤4Â -Â ì´ë¯¸ì§€Â ECSÂ ë°°í¬

- ECSì˜ í´ëŸ¬ìŠ¤í„°, íƒœìŠ¤í¬ ì •ì˜, íƒœìŠ¤í¬, ì„œë¹„ìŠ¤ì— ëŒ€í•œ ê°œë…ì„ ì´í•´
- ECRì— ì €ì¥ëœ ì›¹ ì„œë²„ ì´ë¯¸ì§€ë¥¼ ECSë¡œ ë°°í¬
- ECS íƒœìŠ¤í¬ì˜ ë¡œê·¸ í™•ì¸
- mongodb ì´ë¯¸ì§€ë¥¼ ECSë¥¼ ì´ìš©í•´ ë°°í¬
- mongodb í´ë¼ì´ì–¸íŠ¸ë¥¼ ì´ìš©í•´, ì»¨í…Œì´ë„ˆì— ì ‘ì†ì´ ê°€ëŠ¥í•œì§€ í™•ì¸
- ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œë“œ ë°¸ëŸ°ì„œì™€ ë„¤íŠ¸ì›Œí¬ ë¡œë“œ ë°¸ëŸ°ì„œì˜ ì°¨ì´ì— ëŒ€í•´ ì´í•´

ğŸ’¡ ë§ˆì¼ìŠ¤í†¤5Â -Â ì„œë²„Â ì´ë¯¸ì§€Â ECSÂ ë°°í¬Â ìë™í™”

- ì›¹ ì„œë²„ ì´ë¯¸ì§€ì˜ ìƒˆ ë²„ì „ì´ ì¤€ë¹„ë˜ì—ˆì„ ë•Œ, ìƒˆë¡œìš´ ì‘ì—… ì •ì˜ì™€ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ê³ , ìƒˆ ë²„ì „ì´ ë°°í¬ë˜ë„ë¡ ì„¤ì •
- ê³ ì˜ì ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ì§€ ëª»í•˜ê²Œ ë§Œë“¤ì–´ì„œ, ë°°í¬ê°€ ì‹¤íŒ¨í•˜ëŠ” ê²ƒì„ ë¡œê·¸ë¥¼ í†µí•´ í™•ì¸
- WASì—ì„œ mongodbì— ì ‘ì†í•˜ê³ , ì¿¼ë¦¬ í•´ë³´ë©´ì„œ ì ‘ì†ì´ ì •ìƒì ì¸ì§€ í™•ì¸
- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ë“±ì— í•„ìš”í•œ ë¯¼ê°ì •ë³´ë¥¼ ì–´ë–»ê²Œ ì»¨í…Œì´ë„ˆì— ì£¼ì…ì‹œí‚¤ëŠ”ì§€ í™•ì¸
- GitHub Actionì„ ì´ìš©í•´ ECS ë°°í¬ ê³¼ì • workflowë¥¼ ì¶”ê°€
- ë¯¼ê° ì •ë³´ê°€ ì ˆëŒ€ Gitì— ë…¸ì¶œë˜ì§€ ì•Šë„ë¡ ì„¤ì €

ğŸ’¡ ë§ˆì¼ìŠ¤í†¤6Â -Â ì„œë²„Â ì• í”Œë¦¬ì¼€ì´ì…˜ì˜Â HTTPSÂ ì ìš©

- [https://ë³¸ì¸ë„ë©”ì¸.click](https://xn--hq1bm8j58bhtqca.click/)ì˜ íŠ¸ë˜í”½ì´ ì„œë²„ ì»¨í…Œì´ë„ˆ(ì¦‰ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œë“œ ë°¸ëŸ°ì„œ)ë¡œ ì—°ê²°ë˜ë„ë¡ ì„¤ì •

# #ê³¼ì œ í•­ëª©ë³„ ì§„í–‰ ìƒí™©

# **âœï¸Â Â ë§ˆì¼ìŠ¤í†¤4Â -Â ì´ë¯¸ì§€Â ECSÂ ë°°í¬**

# Step 1 : ì—°ìŠµê³¼ì œ: ì„œë²„ ì´ë¯¸ì§€ ECS ë°°í¬ (ì°¸ê³ Â [Amazon ECS êµ¬ì„±ìš”ì†Œ ê³µì‹ ë¬¸ì„œ)](https://docs.aws.amazon.com/ko_kr/AmazonECS/latest/developerguide/welcome-features.html)

1. ECS ì½˜ì†”ì— ì ‘ì†í•´ íƒœìŠ¤í¬ ì •ì˜ì‘ì„±

1-1. íƒœìŠ¤í¬ ì •ì˜ ë° ì»¨í…Œì´ë„ˆ êµ¬ì„±

![https://blog.kakaocdn.net/dn/OX86m/btsdc1s3WCE/j3ND9QU1lpkj1BlqeRehPK/img.png](https://blog.kakaocdn.net/dn/OX86m/btsdc1s3WCE/j3ND9QU1lpkj1BlqeRehPK/img.png)

1. íƒœìŠ¤í¬ ì •ì˜ ì´ë¦„ ì„¤ì •
2. ì»¨í…Œì´ë„ˆëª…ê³¼ ì´ë¯¸ì§€ URI (ECR ë ˆíŒŒì§€í† ë¦¬ ì£¼ì†Œ/ì‚¬ìš©í•  ì´ë¯¸ì§€:íƒœê·¸) ì‘ì„±
3. ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í¬íŠ¸ ì§€ì •
4. ì„¤ì •í•  í™˜ê²½ë³€ìˆ˜ ì„¤ì •

1-2. í™˜ê²½, ìŠ¤í† ë¦¬ì§€, ëª¨ë‹ˆí„°ë§ ë° íƒœê·¸ êµ¬ì„±

![https://blog.kakaocdn.net/dn/J4Z4G/btsddtvN4X3/KGxEaPcNh3wHz4iiotLt9k/img.png](https://blog.kakaocdn.net/dn/J4Z4G/btsddtvN4X3/KGxEaPcNh3wHz4iiotLt9k/img.png)

1-3. ê²€í†  ë° ìƒì„±

2. ECS ì½˜ì†”ì—ì„œ í´ëŸ¬ìŠ¤í„° ìƒì„±

![https://blog.kakaocdn.net/dn/CEfsc/btsddlEMOrA/EClAnOvyQpItgI6lOTXlX0/img.png](https://blog.kakaocdn.net/dn/CEfsc/btsddlEMOrA/EClAnOvyQpItgI6lOTXlX0/img.png)

1. [í´ëŸ¬ìŠ¤í„° êµ¬ì„±]ì—ì„œ í´ëŸ¬ìŠ¤í„°ëª… ì‘ì„±
2. [ë„¤íŠ¸ì›Œí‚¹]ì—ì„œ VPCë¥¼ ì„ íƒí•˜ê³  ì„œë¸Œë„·ì„ ì„ íƒí•  ë•Œ í•„ìš”í•˜ì§€ ì•Šì€ ì„œë¸Œë„·ì€ ì œê±°í•˜ê³  ìƒì„±í•  ê²ƒ

3. ECS ì½˜ì†”ì—ì„œ í´ëŸ¬ìŠ¤í„°ì—ì„œ ì„œë¹„ìŠ¤ ìƒì„± í›„ íƒœìŠ¤í¬ ì‹¤í–‰

3-1. í´ëŸ¬ìŠ¤í„° > ìƒì„±í•œ í´ëŸ¬ìŠ¤í„° ì„ íƒ > ì„œë¹„ìŠ¤ ìƒì„±

![https://blog.kakaocdn.net/dn/cOuebF/btsdaY4FaSj/y7iQWPUYIOePqnBJIPpr0K/img.png](https://blog.kakaocdn.net/dn/cOuebF/btsdaY4FaSj/y7iQWPUYIOePqnBJIPpr0K/img.png)

1. [í™˜ê²½]ì—ì„œ ì»´í“¨íŒ… ì˜µì…˜ ì„ íƒ
2. [ë°°í¬ êµ¬ì„±]ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ìœ í˜• ì§€ì •
3. [ë°°í¬ êµ¬ì„±]ì˜ íŒ¨ë°€ë¦¬ì— ì´ì „ì— ì§€ì •í•œ ì‘ì—… ì •ì˜ì™€ ê°œì • ë²„ì „ì„ ì„ íƒ
4. [ë°°í¬ êµ¬ì„±]ì—ì„œ ì„œë¹„ìŠ¤ëª… ì‘ì„±
5. [ë°°í¬ êµ¬ì„±]ì—ì„œ ì‹¤í–‰í•  íƒœìŠ¤í¬ ìˆ˜ ì‘ì„±
6. [ë„¤íŠ¸ì›Œí‚¹]ì—ì„œ VPC, ì„œë¸Œë„·, ë³´ì•ˆ ê·¸ë£¹ ì„ íƒ
7. [ë¡œë“œë°¸ëŸ°ì‹±]ì—ì„œ í•´ë‹¹ ì„œë¹„ìŠ¤ì— ì í•©í•˜ê²Œ ì‚¬ìš©í•  ë¡œë“œë°¸ëŸ°ì„œ ìœ í˜•ì„ ì„ íƒ
    - ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ì˜ ê²½ìš° ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨ì˜ ALB
    - DB ì„œë²„ì˜ ê²½ìš° TCP í†µì‹ ì„ í•˜ë¯€ë¡œ NLB ì‚¬ìš©
8. [ë¡œë“œë°¸ëŸ°ì‹±]ì—ì„œ ê¸°ì¡´/ìƒˆë¡œìš´ ë¡œë“œë°¸ëŸ°ì„œë¥¼ ì‚¬ìš©í• ì§€ ì„ íƒí•˜ê³  ì´ë¦„ ì„¤ì •
9. [ë¡œë“œë°¸ëŸ°ì‹±]ì—ì„œ ë¡œë“œë°¸ëŸ°ì‹±í•  ì»¨í…Œì´ë„ˆ(ì‘ì—… ì •ì˜ì—ì„œ ìƒì„±í•œ)ë¥¼ ì„ íƒ
10. [ë¡œë“œë°¸ëŸ°ì‹±]ì—ì„œ ë¡œë“œë°¸ëŸ°ì„œì—ì„œ ì‚¬ìš©í•  ë¦¬ìŠ¤ë„ˆ í¬íŠ¸ ì¶”ê°€
11. [ë¡œë“œë°¸ëŸ°ì‹±]ì—ì„œ ëŒ€ìƒê·¸ë£¹ì„ ìƒì„±í•˜ê±°ë‚˜ ê¸°ì¡´ ëŒ€ìƒ ê·¸ë£¹ ì‚¬ìš©
12. ìƒì„±

4. ìƒì„±ëœ íƒœìŠ¤í¬ë“¤ì˜ í¼ë¸”ë¦­ IP ì£¼ì†Œì˜ 3000í¬íŠ¸, ALBì˜ DNS ì£¼ì†Œë¡œ ì ‘ê·¼í–ˆì„ ë•Œ ì •ìƒì ìœ¼ë¡œ ì›¹ì„œë²„ê°€ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸

![https://blog.kakaocdn.net/dn/ca6EN5/btsdduha65r/Bsc6r6XjDKaUFFnTAgfYzk/img.png](https://blog.kakaocdn.net/dn/ca6EN5/btsdduha65r/Bsc6r6XjDKaUFFnTAgfYzk/img.png)

4-1. [ë¡œê·¸] íƒ­ì—ì„œ ì„œë¹„ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ê¸°ë™ë˜ëŠ”ì§€ í™•ì¸ ê°€ëŠ¥

![https://blog.kakaocdn.net/dn/dlhrPN/btsdaXLsZyj/wcJv3h1oGUJ6ojM4o8wrJK/img.png](https://blog.kakaocdn.net/dn/dlhrPN/btsdaXLsZyj/wcJv3h1oGUJ6ojM4o8wrJK/img.png)

4-2.Â  [êµ¬ì„± ë° íƒœìŠ¤í¬] íƒ­ì—ì„œ íƒœìŠ¤í¬ ìƒì„¸ ë‚´ì—­ í™•ì¸ ê°€ëŠ¥

![https://blog.kakaocdn.net/dn/bg8I6I/btsdeeLJxmI/4xD5ggYVRx6nwr1b0E5NnK/img.png](https://blog.kakaocdn.net/dn/bg8I6I/btsdeeLJxmI/4xD5ggYVRx6nwr1b0E5NnK/img.png)

4-3. íŠ¹ì • íƒœìŠ¤í¬ë¥¼ ì„ íƒí•´ íƒœìŠ¤í¬ ìƒì„¸ ë‚´ì—­ í™•ì¸

![https://blog.kakaocdn.net/dn/npLRK/btsdjnnxwwy/KkhHeCkgksx5wlJlqDbQTk/img.png](https://blog.kakaocdn.net/dn/npLRK/btsdjnnxwwy/KkhHeCkgksx5wlJlqDbQTk/img.png)

![https://blog.kakaocdn.net/dn/vl0sB/btsdhzaH9PD/C7dcrx7kCsDKvTBfA30rjk/img.png](https://blog.kakaocdn.net/dn/vl0sB/btsdhzaH9PD/C7dcrx7kCsDKvTBfA30rjk/img.png)

4-4. íƒœìŠ¤í¬ í¼ë¸”ë¦­ IP:3000, ALB DNS ì£¼ì†Œë¡œ ì ‘ì†í–ˆì„ ì‹œ ì •ìƒ ê¸°ë™ í™•ì¸

![https://blog.kakaocdn.net/dn/nfc2E/btsdbPGp4XO/cFEtKrQ9yY4BCsYivNZpZk/img.png](https://blog.kakaocdn.net/dn/nfc2E/btsdbPGp4XO/cFEtKrQ9yY4BCsYivNZpZk/img.png)

![https://blog.kakaocdn.net/dn/AaIpF/btsdeYu3OMn/yY7QCUKrYWA2bhSdB7yNYk/img.png](https://blog.kakaocdn.net/dn/AaIpF/btsdeYu3OMn/yY7QCUKrYWA2bhSdB7yNYk/img.png)

# Step 2 : ì‹¤ì „ê³¼ì œ: ì„œë²„ ì»¨í…Œì´ë„ˆí™”ì™€ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¡œ push

1. EC2 ì½˜ì†”ì—ì„œ NetworkÂ [Load Balancer](https://docs.aws.amazon.com/ko_kr/elasticloadbalancing/latest/application/introduction.html#application-load-balancer-components)Â ìƒì„±

![https://blog.kakaocdn.net/dn/EGEp1/btsdc0VdSIf/1EguUxM5SeFtfvzoCunvt0/img.png](https://blog.kakaocdn.net/dn/EGEp1/btsdc0VdSIf/1EguUxM5SeFtfvzoCunvt0/img.png)

1. [ê¸°ë³¸ êµ¬ì„±]ì—ì„œ ë¡œë“œë°¸ëŸ°ì„œ ì´ë¦„ ì„¤ì •
2. [ë„¤íŠ¸ì›Œí¬ ë§¤í•‘]ì—ì„œ VPCë¥¼ ì„ íƒí•˜ê³  2ê°œ ì´ìƒì˜ ê°€ìš© ì˜ì—­ì„ ì„ íƒí•˜ê³  ê° AZë§ˆë‹¤ ì„œë¸Œë„·ì„ í•˜ë‚˜ì”© ì„ íƒ
3. [ë¦¬ìŠ¤ë„ˆ ë° ë¼ìš°íŒ…]ì—ì„œ ìƒì„±í•  ë¦¬ìŠ¤ë„ˆì˜ í”„ë¡œí† ì½œê³¼ í¬íŠ¸(ì´ ê²½ìš° 80)ë¥¼ ì„¤ì •
4. [ë¦¬ìŠ¤ë„ˆ ë° ë¼ìš°íŒ…]ì˜ ê¸°ë³¸ ì‘ì—…ìœ¼ë¡œ ëŒ€ìƒ ê·¸ë£¹ì„ ì„ íƒí•˜ê¸° ìœ„í•´ ëŒ€ìƒ ê·¸ë£¹ ìƒì„±í•˜ê³  ì§€ì •
    - ëŒ€ìƒ ê·¸ë£¹ ìƒì„±ì˜ 1ë‹¨ê³„ : ê·¸ë£¹ ì„¸ë¶€ ì •ë³´ ì§€ì •ì˜ [ê¸°ë³¸ êµ¬ì„±]ìœ¼ë¡œ ëŒ€ìƒ ìœ í˜•ì„ ì§€ì • (ì´ ê²½ìš° IP ì£¼ì†Œ)
        - instance: ëŒ€ìƒì´ ì¸ìŠ¤í„´ìŠ¤ IDì— ì˜í•´ ì§€ì •
        - ip: ëŒ€ìƒì´ IP ì£¼ì†Œ
        - lambda: ëŒ€ìƒì´ Lambda í•¨ìˆ˜
    - [ê¸°ë³¸ êµ¬ì„±]ì—ì„œ ëŒ€ìƒ ê·¸ë£¹ ì´ë¦„ ì„¤ì •
    - [ê¸°ë³¸ êµ¬ì„±]ì—ì„œ ë¡œë“œë°¸ëŸ°ì„œì˜ ë¦¬ìŠ¤ë„ˆë¡œ ë°›ì€ íŒ¨í‚·ì„ ì „ë‹¬í•  ì„œë²„ í”„ë¡œí† ì½œ(ì´ ê²½ìš° 27017)ì„ ì„¤ì •
    - ëŒ€ìƒ ê·¸ë£¹ ìƒì„±ì˜ 2ë‹¨ê³„ : ëŒ€ìƒ ë“±ë¡ì˜ [IP ì£¼ì†Œ], [ëŒ€ìƒ ë³´ê¸°] ì„¤ì • í›„ ëŒ€ìƒ ê·¸ë£¹ ìƒì„±
5. ë„¤íŠ¸ì›Œí¬ ë¡œë“œë°¸ëŸ°ì„œ ìƒì„±

2. í„°ë¯¸ë„ì—ì„œ mongodb ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•´ ECRë¡œ í‘¸ì‹œ

```
$ aws ecr get-login-password --region ap-northeast-2 | docker login --username AWS --password-stdin 123456789012.dkr.ecr.ap-northeast-2.amazonaws.com
$ docker tag 9a5e0d0cf6de 123456789012.dkr.ecr.ap-northeast-2.amazonaws.com/<ECR_REPOSITORY_NAME>:mongodb
$ docker push 123456789012.dkr.ecr.ap-northeast-2.amazonaws.com/<ECR_REPOSITORY_NAME>:mongodb
```

3. Step 1ê³¼ ë™ì¼í•˜ê²Œ íƒœìŠ¤í¬ ì •ì˜ > í´ëŸ¬ìŠ¤í„° ìƒì„± > ì„œë¹„ìŠ¤ ìƒì„± ê³¼ì •ì„ ì§„í–‰í•˜ë©° ë¡œë“œë°¸ëŸ°ì„œë¡œ NLBë¥¼ ì„ íƒí•´ ì„œë¹„ìŠ¤ì™€ íƒœìŠ¤í¬ ìƒì„¸ ë‚´ì—­ í™•ì¸

![https://blog.kakaocdn.net/dn/dbhpBF/btsdduIhCae/XcRFQVZDzTAkXtEKzp5hxK/img.png](https://blog.kakaocdn.net/dn/dbhpBF/btsdduIhCae/XcRFQVZDzTAkXtEKzp5hxK/img.png)

![https://blog.kakaocdn.net/dn/b3gc3y/btsdeG2g8Lf/23XLkoo6DdniHf5yhvaS71/img.png](https://blog.kakaocdn.net/dn/b3gc3y/btsdeG2g8Lf/23XLkoo6DdniHf5yhvaS71/img.png)

4. íƒœìŠ¤í¬ì˜ í¼ë¸”ë¦­ IPì™€ DNS ì£¼ì†Œë¡œ ì ‘ê·¼í•˜ì—¬ ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸

![https://blog.kakaocdn.net/dn/pbkvI/btsdeY2T8pV/z7CnxdbRZVWPXkJpBg6HK0/img.png](https://blog.kakaocdn.net/dn/pbkvI/btsdeY2T8pV/z7CnxdbRZVWPXkJpBg6HK0/img.png)

![https://blog.kakaocdn.net/dn/ntTaq/btsdi3CIQJE/6NAQPfvvOAvCpI0ZPmZFfk/img.png](https://blog.kakaocdn.net/dn/ntTaq/btsdi3CIQJE/6NAQPfvvOAvCpI0ZPmZFfk/img.png)

# **âœï¸Â ë§ˆì¼ìŠ¤í†¤5Â -Â ì„œë²„Â ì´ë¯¸ì§€Â ECSÂ ë°°í¬Â ìë™í™”**

# Step 1 :Â ì—°ìŠµê³¼ì œ: WASì—ì„œ mongodbë¡œì˜ ì ‘ì†

1. Fastifyìš© mongodb í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜

```coffeescript
$ npm i @fastify/mongodb
```

2. mongodb í”ŒëŸ¬ê·¸ì¸ ì ìš© - plugins/mongodb.js íŒŒì¼ ìƒì„±

```jsx
'use strict'

const fp = require('fastify-plugin')

const { MONGO_HOSTNAME, MONGO_USERNAME, MONGO_PASSWORD } = process.env

module.exports = fp(async function (fastify, opts) {
  const url = `mongodb://${MONGO_USERNAME}:${MONGO_PASSWORD}@${MONGO_HOSTNAME}:27017/?authMechanism=DEFAULT`
  console.log(url)

  fastify.register(require('@fastify/mongodb'), {
    forceClose: true,
    url: url
  })
})
```

3. ë°°í¬í•˜ê¸° ì „ ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸

1. ë¡œì»¬ í…ŒìŠ¤íŠ¸ ë°©ë²•
    - í•„ìš”í•œ í™˜ê²½ ë³€ìˆ˜ë¥¼ export ëª…ë ¹ì„ ì´ìš©í•´ ì£¼ì…
    - npm start ëª…ë ¹ì„ ì´ìš©í•´ ì‹¤í–‰ ì‹œ DB ì ‘ì†
2. ë„ì»¤ ì´ë¯¸ì§€ í…ŒìŠ¤íŠ¸ ë°©ë²•
    - ë„ì»¤ íŒŒì¼ì„ ë§Œë“¤ê³  ë‚œ í›„, --env ì˜µì…˜ì„ ì´ìš©í•´ì„œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì£¼ì… (docker run --env MONGO_PASSWORD=secret)
- 

4. (Optional) mongodbì— ë°ì´í„° ì¶”ê°€/ì¡°íšŒ ë“±ì„ í…ŒìŠ¤íŠ¸ -Â routes/example/index.js ìƒì„±

```jsx
module.exports = async function (fastify, opts) {
  fastify.post('/', async function (request, reply) {
    const test = this.mongo.client.db('test')
    const article = test.collection('article')
    await article.insertOne({ 'title': 'ì•ˆë…• ì„¸ìƒì•„' })

    const result = await article.find({}).toArray();

    reply.send(result)
  })
}
```

# Step 3 : ì—°ìŠµê³¼ì œ:Â ECSì—ì„œÂ ë¯¼ê°Â ì •ë³´Â ë‹¤ë£¨ê¸°

1. Fastifyë¡œ ì‘ì„±ëœ WASì˜ routes/root.js íŒŒì¼ ìˆ˜ì • í›„ git repositoryì— add, commit, push

```jsx
'use strict'

module.exports = async function (fastify, opts) {
  fastify.get('/', async function (request, reply) {
    console.log(process.env.MONGO_HOSTNAME)
    console.log(process.env.MONGO_USERNAME)
    return { root: true, host: process.env.MONGO_HOSTNAME, username: process.env.MONGO_USERNAME }
  })
}
```

2. ë¯¼ê° ì •ë³´ ì…ë ¥

2-1. ì½˜ì†”ì—ì„œ AWS Secrets Managerë¡œ ì´ë™ í›„ ìƒˆ ë³´ì•ˆ ì•”í˜¸ ì €ì¥ ì„ íƒ

![https://blog.kakaocdn.net/dn/c2js3G/btsdcI1okgM/j6ZZPQs0gewNpebY4b5Ig0/img.png](https://blog.kakaocdn.net/dn/c2js3G/btsdcI1okgM/j6ZZPQs0gewNpebY4b5Ig0/img.png)

2-2. ë³´ì•ˆ ì•”í˜¸ ìƒì„¸ ë‚´ìš© ì„¤ì • í›„ ì €ì¥

![https://blog.kakaocdn.net/dn/dyFtYA/btsdjn8Wk7e/MaJs3IIRtKKi4hzI892dwK/img.png](https://blog.kakaocdn.net/dn/dyFtYA/btsdjn8Wk7e/MaJs3IIRtKKi4hzI892dwK/img.png)

1. 1ë‹¨ê³„ ë³´ì•ˆ ì•”í˜¸ ìœ í˜• ì„ íƒì—ì„œ [ë³´ì•ˆ ì•”í˜¸ ìœ í˜•]ì—ì„œÂ **ë‹¤ë¥¸ ìœ í˜•ì˜ ë³´ì•ˆ ì•”í˜¸**Â ì„ íƒ
2. 1ë‹¨ê³„ ë³´ì•ˆ ì•”í˜¸ ìœ í˜• ì„ íƒì—ì„œ [í‚¤/ê°’ í˜ì–´]ì—ì„œ ë‹¤ìŒì˜ í‚¤/ê°’ë“¤ì„ ì…ë ¥
    - MONGO_HOSTNAME: mongodbì˜ ì—”ë“œí¬ì¸íŠ¸ (ECRì˜ DBì´ë¯¸ì§€ë¡œ ë§Œë“  íƒœìŠ¤í¬ì˜ NLBì˜ DNS ì£¼ì†Œ)
    - MONGO_USERNAME: mongodbì˜ ì‚¬ìš©ì ì´ë¦„
    - MONGO_PASSWORD: mongodbì˜ ë¹„ë°€ë²ˆí˜¸
3. 2ë‹¨ê³„ ë³´ì•ˆ ì•”í˜¸ êµ¬ì„±ì—ì„œ [ë³´ì•ˆ ì•”í˜¸ ì´ë¦„]ì„ ì˜ êµ¬ë¶„í•  ìˆ˜ ìˆëŠ” ì´ë¦„ìœ¼ë¡œ ì§€ì •
4. 3ë‹¨ê³„ êµì²´ êµ¬ì„±ì—ì„œ [ìë™ êµì²´]ëŠ” ë¯¸ì ìš© í›„ ê²€í† í•˜ì—¬ ìƒˆ ë³´ì•ˆ ì•”í˜¸ ì €ì¥

3. ìƒˆë¡œìš´ ì‘ì—… ì •ì˜ ìƒì„±

- Step 1ì˜ íƒœìŠ¤í¬ ì •ì˜ì™€ ë™ì¼í•˜ê²Œ íƒœìŠ¤í¬ ì •ì˜ë¥¼ ìƒˆë¡­ê²Œ ê°œì •í•˜ë˜, í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •

![https://blog.kakaocdn.net/dn/btRYJM/btscZWd4PKN/iupPKcKc3fdkh7BMhMb8g1/img.png](https://blog.kakaocdn.net/dn/btRYJM/btscZWd4PKN/iupPKcKc3fdkh7BMhMb8g1/img.png)

1. í‚¤: ì‹¤ì œë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‚¬ìš©í•  í™˜ê²½ ë³€ìˆ˜ ì´ë¦„
2. ê°’ ìœ í˜•: ValueFromìœ¼ë¡œ ì„¤ì •
3. ê°’: Secrets Managerì— ì €ì¥ë˜ì–´ ìˆëŠ” ë³´ì•ˆ ì•”í˜¸ì˜ í‚¤/ê°’ì˜ ARNìœ¼ë¡œ ì§€ì • (í˜•ì‹: arn:aws:secretsmanager:**region**:**aws_account_id**:secret:**appauthexample****AbCdEf**:**username1**::)
    - appauthexample: ë³´ì•ˆ ì•”í˜¸ ì´ë¦„
    - AbCdEf: ì¼ì¢…ì˜ í•´ì‹œê°’ìœ¼ë¡œ ARNì—ì„œ í™•ì¸ ê°€ëŠ¥
    - username1: ë³´ì•ˆ ì•”í˜¸ì˜ í‚¤(í˜„ ì‹¤ìŠµì—ì„œ ì‚¬ìš©í•˜ëŠ” MONGO_USERNAME ë“±ìœ¼ë¡œ ì§€ì •)

4. ì‘ì—… ì •ì˜ì˜ ìµœì‹  ê°œì •ì„ ë°”íƒ•ìœ¼ë¡œ ì„œë¹„ìŠ¤ ì—…ë°ì´íŠ¸

4-1. ê¸°ì¡´ì— ë§Œë“¤ì–´ë‘ì—ˆë˜ ì„œë¹„ìŠ¤ë¥¼ ì„ íƒí•˜ê³ Â **[ì„œë¹„ìŠ¤ ì—…ë°ì´íŠ¸]**Â ì„ íƒ

![https://blog.kakaocdn.net/dn/nukNK/btscYWsj8lM/kcSxnqsyn0k4Ge9iArDKPK/img.png](https://blog.kakaocdn.net/dn/nukNK/btscYWsj8lM/kcSxnqsyn0k4Ge9iArDKPK/img.png)

4-2. ì‘ì—… ì •ì˜ì˜ ìµœì‹  ê°œì •ì„ ì„ íƒí•´ì„œ ì„œë¹„ìŠ¤ë¥¼ ì—…ë°ì´íŠ¸í•˜ë©´, íƒœìŠ¤í¬ê°€ ìƒˆë¡œìš´ ê°œì •ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ë©°, ì´ì „ ê°œì • ë²„ì „ì€ ë¹„í™œì„±í™”ë˜ê³  ì¤‘ë‹¨ë˜ì–´ ì„œë¹„ìŠ¤ ìƒì„± ì‹œ ì§€ì •í•œ íƒœìŠ¤í¬ ìˆ˜ë§Œí¼ ìµœì‹  ê°œì • íƒœìŠ¤í¬ê°€ ë™ì‘

![https://blog.kakaocdn.net/dn/zZ02h/btsc1NmXWdZ/GjKS6utoQwX0GqNfCXQgo0/img.png](https://blog.kakaocdn.net/dn/zZ02h/btsc1NmXWdZ/GjKS6utoQwX0GqNfCXQgo0/img.png)

5. íƒœìŠ¤í¬ì— ì ‘ì† í›„, í™˜ê²½ë³€ìˆ˜ ì ìš© í™•ì¸ : ë¡œë“œ ë°¸ëŸ°ì„œë‚˜, ê° íƒœìŠ¤í¬ì˜ í¼ë¸”ë¦­ IPë¥¼ í†µí•´ WASì— ì ‘ê·¼

![https://blog.kakaocdn.net/dn/bqb0hp/btsdc8MfUPV/U64kXn4yLNL1ssgO3JS4g0/img.png](https://blog.kakaocdn.net/dn/bqb0hp/btsdc8MfUPV/U64kXn4yLNL1ssgO3JS4g0/img.png)

![https://blog.kakaocdn.net/dn/dE8vtl/btsdeYu6kgr/e5giQaaD37mQtgyjrMswc1/img.png](https://blog.kakaocdn.net/dn/dE8vtl/btsdeYu6kgr/e5giQaaD37mQtgyjrMswc1/img.png)

![https://blog.kakaocdn.net/dn/elCHfb/btsdcskgmfB/bmzQjnv9dKoCSA5etUiuhk/img.png](https://blog.kakaocdn.net/dn/elCHfb/btsdcskgmfB/bmzQjnv9dKoCSA5etUiuhk/img.png)

# Step 4 : ì‹¤ìŠµê³¼ì œ: ì‘ì—… ì •ì˜ íŒŒì¼ì„ ì´ìš©í•œ ECRë¡œ ë°°í¬ ìë™í™”

- ì°¸ê³  : ë°ì´í„°ë² ì´ìŠ¤ ì´ë¯¸ì§€ ìì²´ê°€ ë³€ê²½ë˜ëŠ” ì¼ì´ ì ìœ¼ë¯€ë¡œ, ì²˜ìŒ í•œ ë²ˆë§Œ ë°°í¬í•˜ë©´ ë˜ê¸° ë•Œë¬¸ì— mongodbì˜ ë°°í¬ ìë™í™”ë¥¼ í•  í•„ìš” ì—†ìŒ
- âš ï¸Â ì‘ì—…Â ì •ì˜Â íŒŒì¼ì—Â ë¯¼ê°Â ì •ë³´ê°€Â í¬í•¨ë˜ì–´Â ìˆëŠ”ì§€Â ì—¬ë¶€ë¥¼Â ë°˜ë“œì‹œÂ í™•ì¸

1. ì‘ì—… ì •ì˜ JSON íŒŒì¼ì„ Git repositoryì— ì¶”ê°€

1-1. ECS ì½˜ì†”ì—ì„œ íƒœìŠ¤í¬ ì •ì˜ > ìë™í™” í•  íƒœìŠ¤í¬ ê°œì • ë²„ì „ ì„ íƒ > JSON > JSON ë‹¤ìš´ë¡œë“œ

![https://blog.kakaocdn.net/dn/b2wJhP/btsdhz2VCJy/P9jq5JaSZnsdY736JkcaAK/img.png](https://blog.kakaocdn.net/dn/b2wJhP/btsdhz2VCJy/P9jq5JaSZnsdY736JkcaAK/img.png)

1-2. JSON í˜•ì‹ì˜ ì‘ì—… ì •ì˜ë¥¼ Git Repositoryì— ì ë‹¹í•œ ê³³ì— ìœ„ì¹˜

2. ECSë¡œì˜ ë°°í¬ë¥¼ ìœ„í•œ GitHub Action workflowë¥¼ ì¶”ê°€

2-1. GitHub Actionì— Deploy to Amazon ECSë¼ëŠ” ì´ë¦„ì˜ workflowë¥¼ ì¶”ê°€ ì—¬ëŸ¬ ê°€ì§€ í™˜ê²½ ì„¤ì •í•˜ì—¬ ë°°í¬ ìë™í™”

![https://blog.kakaocdn.net/dn/dRX7jo/btsc02koczz/s6mmuoaKKR9btAoSTZ3Ig0/img.png](https://blog.kakaocdn.net/dn/dRX7jo/btsc02koczz/s6mmuoaKKR9btAoSTZ3Ig0/img.png)

2-2. workflow íŒŒì¼ ë‚´ìš©

```scala
name: Deploy to AMAZON ECS

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

env:
  AWS_REGION: "ap-northeast-2"                                # set this to your preferred AWS region, e.g. us-west-1
  ECR_REPOSITORY: ${{ secrets.ECR_REPOSITORY }}          # set this to your Amazon ECR repository name
  ECS_SERVICE: helloworld-was-svc                             # set this to your Amazon ECS service name
  ECS_CLUSTER: helloworld-was-cluster                         # set this to your Amazon ECS cluster name
  ECS_TASK_DEFINITION: helloworld-was-task-definitions.json   # set this to the path to your Amazon ECS task definition
                                                              # file, e.g. .aws/task-definition.json
  CONTAINER_NAME: helloworld-was-container                    # set this to the name of the container in the
                                                              # containerDefinitions section of your task definition
  ROLE_ARN: ${{ secrets.ECR_ROLE_ARN }}

permissions:
  contents: read
  id-token: write   # This is required for requesting the JWT

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    environment: production

    steps:
    - name: "1. github runnerì— ë ˆíŒŒì§€í† ë¦¬ ì²´í¬ì•„ì›ƒ"
      uses: actions/checkout@v3

    - name: "2. AWS credential ì„¤ì •"
      uses: aws-actions/configure-aws-credentials@v2
      with:
        aws-region: ${{ env.AWS_REGION }}
        role-session-name: GitHubActions
        role-to-assume: ${{ env.ROLE_ARN }}

    # Login to Amazon ECR Private, then build and push a Docker image: (cf. public)
    - name: "3. AMAZON ECR ë¡œê·¸ì¸"
      id: login-ecr
      uses: aws-actions/amazon-ecr-login@v1

    - name: "4. AMAZON ECRì— ì´ë¯¸ì§€ ë¹Œë“œ, íƒœê·¸, í‘¸ì‹œ"
      id: build-image
      env:
        ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}
        IMAGE_TAG: ${{ github.sha }}
      run: |
        cd ./helloworld-was
        docker build -t $ECR_REGISTRY/${{ env.ECR_REPOSITORY }}:$IMAGE_TAG .
        docker push $ECR_REGISTRY/${{ env.ECR_REPOSITORY }}:$IMAGE_TAG
        echo "image=$ECR_REGISTRY/${{ env.ECR_REPOSITORY }}:$IMAGE_TAG" >> $GITHUB_OUTPUT
        cd ../

    - name: "5. AMAZON ECS ì‘ì—… ì •ì˜ ì•ˆì— ìƒˆë¡œìš´ ì´ë¯¸ì§€ID ì…ë ¥"
      id: task-def
      uses: aws-actions/amazon-ecs-render-task-definition@v1
      with:
        task-definition: ${{ env.ECS_TASK_DEFINITION }}
        container-name: ${{ env.CONTAINER_NAME }}
        image: ${{ steps.build-image.outputs.image }}

    - name: "6. ì•„ë§ˆì¡´ ECS "
      uses: aws-actions/amazon-ecs-deploy-task-definition@v1
      with:
        task-definition: ${{ steps.task-def.outputs.task-definition }}
        service: ${{ env.ECS_SERVICE }}
        cluster: ${{ env.ECS_CLUSTER }}
        wait-for-service-stability: true
```

2-3. ê¸°ì¡´ì˜ ECRë¡œì˜ ë¹Œë“œ/push ì‘ì—… ìë™í™” workflowê°€ ìˆëŠ” ê²½ìš°ì— í•´ë‹¹ ë‚´ìš©ì´ ì¤‘ë³µì´ë¯€ë¡œ ê¸°ì¡´ workflow ì‚­ì œ

# **âœï¸Â ë§ˆì¼ìŠ¤í†¤6Â -Â ì„œë²„Â ì• í”Œë¦¬ì¼€ì´ì…˜ì˜Â HTTPSÂ ì ìš©**

# Step 1 : ì‹¤ìŠµê³¼ì œ:Â ì„œë²„Â ì• í”Œë¦¬ì¼€ì´ì…˜ì˜Â HTTPSÂ ì ìš©

1. Route53ë¥¼ ì´ìš©í•´ êµ¬ì…í•œ ë„ë©”ì¸ì— ALB ì—°ê²°

1-1. Route53 ì½˜ì†” > í˜¸ìŠ¤íŒ… ì˜ì—­ > ë ˆì½”ë“œ ìƒì„±

![https://blog.kakaocdn.net/dn/b9VPbj/btsdctcjTpL/TKwYHArGh7feAUIyddlIoK/img.png](https://blog.kakaocdn.net/dn/b9VPbj/btsdctcjTpL/TKwYHArGh7feAUIyddlIoK/img.png)

1-2. HTTPS ì ìš©ì´ ê°€ëŠ¥í•œ ì¸ì¦ì„œê°€ ì—†ì„ ê²½ìš° ACMì„ ì´ìš©í•´ í•´ë‹¹ ë„ë©”ì¸ ì£¼ì†Œì—Â [ì¸ì¦ì„œ ë°œê¸‰](https://docs.aws.amazon.com/ko_kr/acm/latest/userguide/gs-acm-request-public.html)

[
í¼ë¸”ë¦­ ì¸ì¦ì„œ ìš”ì²­ - AWS Certificate Manager
ëª©ë¡ì„ ì •ë ¬í•œ ë°©ë²•ì— ë”°ë¼ ì°¾ê³  ìˆëŠ” ì¸ì¦ì„œê°€ ì¦‰ì‹œ í‘œì‹œë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜¤ë¥¸ìª½ì˜ ê²€ì€ìƒ‰ ì‚¼ê°í˜•ì„ í´ë¦­í•˜ì—¬ ìˆœì„œë¥¼ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜¤ë¥¸ìª½ ìƒë‹¨ì˜ í˜ì´ì§€ ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì—¬ëŸ¬
docs.aws.amazon.com](https://docs.aws.amazon.com/ko_kr/acm/latest/userguide/gs-acm-request-public.html)

1-3. ë„ë©”ì¸ìœ¼ë¡œ ì ‘ì† ì‹œ SSL ì ìš©ë˜ì–´ ì •ìƒì ìœ¼ë¡œ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ë¡œ ì ‘ì†ë˜ëŠ” ê²ƒ í™•ì¸

![https://blog.kakaocdn.net/dn/CSJzY/btsdcskhtzF/kaAX7I9kUWDXGmrh1nnGS1/img.png](https://blog.kakaocdn.net/dn/CSJzY/btsdcskhtzF/kaAX7I9kUWDXGmrh1nnGS1/img.png)

# #TROUBLE SHOOTING LOG

# ğŸ“ ë¬¸ì œ 1 : mongodbì˜ íƒœìŠ¤í¬ ì •ì˜ í›„ íƒœìŠ¤í¬ ì‘ë™ ì‹¤íŒ¨

- ì›ì¸ : ì´ë¯¸ì§€ URIì— ì˜ëª»ëœ URI ì…ë ¥
- í•´ê²° ë°©ì•ˆ : ì •ìƒì ì¸ ECR ë ˆíŒŒì§€í† ë¦¬ì™€ íƒœê·¸ ì…ë ¥

# ğŸ“ ë¬¸ì œ 2 : ë¹Œë“œ í›„ ECRì— ì´ë¯¸ì§€ê°€ ë°°í¬ë˜ì—ˆì„ ë•Œ ìë™ìœ¼ë¡œ ì„œë¹„ìŠ¤ì— ë°°í¬í•˜ëŠ” workflow ì‹¤í–‰ ì‹œ ECR ë°°í¬ ì‹¤íŒ¨

- ì›ì¸ : ì‘ì—… ì •ì˜ ì ‘ê·¼ ê¶Œí•œ ë¬¸ì œë¡œ ë°°í¬ ìë™í™” ì‹¤íŒ¨
- í•´ê²° ë°©ì•ˆ : IAMì˜ ì—­í• ì— í•„ìš”í•œ ê¶Œí•œ ë¶€ì—¬

```jsx
{
   "Version":"2012-10-17",
   "Statement":[
      {
         "Sid":"RegisterTaskDefinition",
         "Effect":"Allow",
         "Action":[
            "ecs:RegisterTaskDefinition"
         ],
         "Resource":"*"
      },
      {
         "Sid":"PassRolesInTaskDefinition",
         "Effect":"Allow",
         "Action":[
            "iam:PassRole"
         ],
         "Resource":[
            "arn:aws:iam::<aws_account_id>:role/<task_definition_task_role_name>",
            "arn:aws:iam::<aws_account_id>:role/<task_definition_task_execution_role_name>"
         ]
      },
      {
         "Sid":"DeployService",
         "Effect":"Allow",
         "Action":[
            "ecs:UpdateService",
            "ecs:DescribeServices"
         ],
         "Resource":[
            "arn:aws:ecs:<region>:<aws_account_id>:service/<cluster_name>/<service_name>"
         ]
      }
   ]
}
```

[https://github.com/aws-actions/amazon-ecs-deploy-task-definition](https://github.com/aws-actions/amazon-ecs-deploy-task-definition)

[
GitHub - aws-actions/amazon-ecs-deploy-task-definition: Registers an Amazon ECS task definition and deploys it to an ECS service
Registers an Amazon ECS task definition and deploys it to an ECS service. - GitHub - aws-actions/amazon-ecs-deploy-task-definition: Registers an Amazon ECS task definition and deploys it to an ECS ...
github.com](https://github.com/aws-actions/amazon-ecs-deploy-task-definition)

# ğŸ“ ë¬¸ì œ 3 : ì»¨í…Œì´ë„ˆë¡œ WASì™€ DBë¥¼ ë”°ë¡œ ê¸°ë™ í›„ WASì—ì„œ DB ì ‘ê·¼ ë¶ˆê°€

- ì›ì¸
    1. composeë¡œ í•¨ê»˜ ê¸°ë™í•˜ì§€ ì•Šê³  ë”°ë¡œ ê¸°ë™í•  ê²½ìš° ë¸Œë¦¿ì§€ê°€ ìƒì„±ë˜ì§€ ì•ŠìŒ
    2. containerëŠ” ë…ë¦½ëœ ë„¤íŠ¸ì›Œí¬ë¡œ ë™ì‘í•˜ë¯€ë¡œ ë‘ ì„œë²„ê°€ ë™ì¼í•œ ì„œë¸Œë„·ì— ì†í•´ìˆì§€ ì•Šìœ¼ë¯€ë¡œ í†µì‹ ì´ ë¶ˆê°€ëŠ¥

```
$ docker run --name servertest -p 3000:3000 --env MONGO_PASSWORD=secret --env MONGO_HOSTNAME=172.22.0.2 --env MONGO_USERNAME=root --network devops-04-s2-team9_default ohrory218/helloworld:1.1

> helloworld-was@1.0.0 start
> fastify start -l info app.js --address 0.0.0.0

[INFO] app.js file processing
[INFO] app.js file done
[DB CONNECTION STRING] mongodb://root:secret@172.22.0.2:27017/?authMechanism=DEFAULT
MongoServerSelectionError: connect ECONNREFUSED 172.22.0.2:27017
    at Timeout._onTimeout (/app/node_modules/@fastify/mongodb/node_modules/mongodb/lib/sdam/topology.js:277:38)
    at listOnTimeout (node:internal/timers:569:17)
    at process.processTimers (node:internal/timers:512:7) {
  reason: TopologyDescription {
    type: 'Unknown',
    servers: Map(1) { '172.22.0.2:27017' => [ServerDescription] },
    stale: false,
    compatible: true,
    heartbeatFrequencyMS: 10000,
    localThresholdMS: 15,
    setName: null,
    maxElectionId: null,
    maxSetVersion: null,
    commonWireVersion: 0,
    logicalSessionTimeoutMinutes: null
  },
  code: undefined,
  [Symbol(errorLabels)]: Set(0) {}
}
```

- íŠ¸ëŸ¬ë¸” ìŠˆíŒ… ê³¼ì •

```
# ê¸°ë™ëœ mongodb ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí¬ í™•ì¸í•˜ì—¬ í™˜ê²½ ë³€ìˆ˜ì˜ HOSTNAMEì— IPAddress ê¸°ì…, networkì— networksëª… ê¸°ì…
$ docker container inspect mongodb
[
    {
#... ì¤‘ëµ ...#
            "Networks": {
                "devops-04-s2-team9_default": {
                    "IPAMConfig": null,
                    "Links": null,
                    "Aliases": [
                        "mongodb",
                        "mongo",
                        "223966663fe2"
                    ],

# ... ì¤‘ëµ ....#
                    "IPAddress": "172.22.0.2",
# ... í•˜ëµ ....#

                }
            }
        }
    }
]
```

- í•´ê²° ë°©ë²•
    1. mongo DBì˜ configë¥¼ ë³€ê²½í•´ ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
    2. (ì±„íƒ) WAS ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•  ë•Œ DB ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ëœ ë„¤íŠ¸ì›Œí¬ì—ì„œ ì‹¤í–‰ë˜ë„ë¡ ìˆ˜ì •

```
$ docker run --name servertest -p 3000:3000 --env MONGO_PASSWORD=secret --env MONGO_HOSTNAME=172.22.0.2 --env MONGO_USERNAME=root --network devops-04-s2-team9_default ohrory218/helloworld:1.1

> helloworld-was@1.0.0 start
> fastify start -l info app.js --address 0.0.0.0

[INFO] app.js file processing
[INFO] app.js file done
[DB CONNECTION STRING] mongodb://root:secret@172.22.0.2:27017/?authMechanism=DEFAULT
{"level":30,"time":1682772429521,"pid":18,"hostname":"87140ace8e46","msg":"Server listening at http://0.0.0.0:3000"}
```

# # REFERENCES

[https://docs.aws.amazon.com/ko_kr/elasticloadbalancing/latest/application/introduction.html#application-load-balancer-components](https://docs.aws.amazon.com/ko_kr/elasticloadbalancing/latest/application/introduction.html#application-load-balancer-components)



[Using Secrets Manager to secure sensitive data](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/specifying-sensitive-data-secrets.html)

