---
date: 2023-05-01 00:00:00
layout: post
title: DevOps&#91;SECTION2&#93; <AWS ë°°í¬ ìë™í™”> DAY 3 LOG 
subtitle: '<AWS ë°°í¬ ìë™í™”> DAY 3'
description: <AWS ë°°í¬ ìë™í™”> DAY 3
image: /thumbnail/404.jpg
optimized_image: /thumbnail/404.jpg
category: í”„ë¡œì íŠ¸ íšŒê³ 
tags:
  - AWS
  - ECR
  - ìë™í™”
  - Docker
  - mongo DB
  - NoSql
  - HTTPS
  - HTTP
  - POSTMAN
  - íšŒê³ 
  - DevOps BootCamp
author: teddy-woo

---

# # í•™ìŠµ ëª©í‘œ

- í”„ë¡ íŠ¸ì—”ë“œì˜ ë°°í¬ë¥¼ ìë™í™”
- CDNì„ í†µí•´ í”„ë¡ íŠ¸ì—”ë“œë¥¼ ìºì‹±í•˜ê³ , HTTPSë¥¼ ì ìš©
- í”„ë¡ íŠ¸ì—”ë“œì™€ WASë¥¼ ì—°ê²°
- í”„ë¡ íŠ¸ì—”ë“œê°€ ì˜ ì‘ë™í•˜ê¸° ìœ„í•´ WASë¥¼ êµ¬í˜„

# # í•´ê²° ê³¼ì œ

ğŸ’¡ ë§ˆì¼ìŠ¤í†¤7Â -Â í”„ë¡ íŠ¸ì—”ë“œÂ ë°°í¬Â ìë™í™”

- í”„ë¡ íŠ¸ì—”ë“œ í”„ë¡œì íŠ¸ì˜ ë°°í¬ ìë™í™”ë¥¼ êµ¬í˜„
    - GitHub Action ë˜ëŠ” CodePipeline + CodeBuild ì¡°í•© ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•´ì„œ êµ¬í˜„
- í”„ë¡ íŠ¸ì—”ë“œì˜ ë³€ê²½ì‚¬í•­ì´ S3ì— ë°°í¬ê°€ ë˜ëŠ”ì§€ í™•ì¸
- ì •ì  ì›¹ì‚¬ì´íŠ¸ ì„¤ì •ì„ í†µí•´ S3 ì›¹ì‚¬ì´íŠ¸ URLë¡œ ì ‘ê·¼ ì‹œ ì›¹ í˜ì´ì§€ê°€ ì œëŒ€ë¡œ ë³´ì—¬ì•¼ í•¨

ğŸ’¡ ë§ˆì¼ìŠ¤í†¤8Â -Â í”„ë¡ íŠ¸ì—”ë“œÂ HTTPSÂ ì ìš©

- CloudFrontë¥¼ ì´ìš©í•˜ì—¬, S3 ì •ì  ì›¹ì‚¬ì´íŠ¸ë¥¼ ìºì‹±
- RouteÂ 53ì„Â ì´ìš©í•´Â [https://www.yourdomain.clickì˜](https://www.yourdomain.xn--click-tl3w/)Â íŠ¸ë˜í”½ì´, CDN(CloudFront)ì— ì—°ê²°ë˜ë„ë¡ ë§Œë“¤ì–´ì•¼ í•¨

ğŸ’¡ ë§ˆì¼ìŠ¤í†¤9Â -Â í”„ë¡ íŠ¸ì—”ë“œ-ì„œë²„Â ì—°ê²°Â í™•ì¸

- í”„ë¡ íŠ¸ì—”ë“œê°€ ì˜ ì‘ë™í•˜ë„ë¡, WAS ì¸¡ ì½”ë“œë¥¼ ë³€ê²½
- WASê°€ CORSë¥¼ í—ˆìš©
- í”„ë¡ íŠ¸ì—”ë“œê°€ ì˜¬ë°”ë¥¸ ì„œë²„ë¥¼ ë°”ë¼ë³¼ ìˆ˜ ìˆë„ë¡ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆì–´ì•¼ í•¨

# #ê³¼ì œ í•­ëª©ë³„ ì§„í–‰ ìƒí™©

# **âœï¸Â Â ë§ˆì¼ìŠ¤í†¤7Â -Â í”„ë¡ íŠ¸ì—”ë“œÂ ë°°í¬Â ìë™í™”**

# Step 1 : ë¡œì»¬ì—ì„œ DB, WAS, WEB ì„œë²„(í”„ë¡ íŠ¸ì—”ë“œ, ì •ì  ì›¹ì‚¬ì´íŠ¸ ì´í›„ WEB ì„œë²„ í†µì¼) ê¸°ë™ ì‹œ ë™ì‘ í™•ì¸

```
$ npm install
$ npm run build
$ npm run start &
```

![https://blog.kakaocdn.net/dn/cUapA4/btsdi1ytX8C/myec4p1h2kDAtpNc7driYK/img.png](https://blog.kakaocdn.net/dn/cUapA4/btsdi1ytX8C/myec4p1h2kDAtpNc7driYK/img.png)

![https://blog.kakaocdn.net/dn/bZM3Ro/btsdcJM5ooj/dUk88uTkjMMsF9iKKkPxj0/img.png](https://blog.kakaocdn.net/dn/bZM3Ro/btsdcJM5ooj/dUk88uTkjMMsF9iKKkPxj0/img.png)

# Step 2 : S3 ë²„í‚·ì„ ìƒì„±í•œ í›„ ë¹Œë“œí•œ WEB ì„œë²„ë¥¼ í˜¸ìŠ¤íŒ…í•˜ê³  í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

1 : S3 ë²„í‚· ìƒì„±

![https://blog.kakaocdn.net/dn/bMgb3U/btsdlLigtw8/VDM6kGmxYUFGWka5WTUYWk/img.png](https://blog.kakaocdn.net/dn/bMgb3U/btsdlLigtw8/VDM6kGmxYUFGWka5WTUYWk/img.png)

2. S3ë¥¼ ì •ì  ì›¹ í˜¸ìŠ¤íŒ…ìš©ìœ¼ë¡œ êµ¬ì„±

1. AWS Management Consoleì— ë¡œê·¸ì¸í•œ í›„Â [https://console.aws.amazon.com/s3/](https://console.aws.amazon.com/s3/)ì—ì„œ Amazon S3 ì½˜ì†” >Â **ë²„í‚·**Â ëª©ë¡ì—ì„œ ì •ì  ì›¹ ì‚¬ì´íŠ¸ í˜¸ìŠ¤íŒ…ì„ ì‚¬ìš© ì„¤ì •í•˜ë ¤ëŠ” ë²„í‚·ì˜ ì´ë¦„ì„ ì„ íƒ
2. [**ì†ì„±(Properties)**]ì„ ì„ íƒ
    - 
        
        ![https://blog.kakaocdn.net/dn/LDz9v/btsdwvyTT8H/XLn3mBPq6P1uzxFkoJ7qgk/img.png](https://blog.kakaocdn.net/dn/LDz9v/btsdwvyTT8H/XLn3mBPq6P1uzxFkoJ7qgk/img.png)
        
3. **ì •ì  ì›¹ ì‚¬ì´íŠ¸ í˜¸ìŠ¤íŒ…(Static website hosting)**ì—ì„œÂ **í¸ì§‘(Edit)**ì„ ì„ íƒ
4. **ì´ ë²„í‚·ì„ ì‚¬ìš©í•˜ì—¬ ì›¹ ì‚¬ì´íŠ¸ë¥¼ í˜¸ìŠ¤íŒ…**ë¥¼ ì„ íƒ
5. **ì •ì  ì›¹ ì‚¬ì´íŠ¸ í˜¸ìŠ¤íŒ…**ì—ì„œÂ **ì‚¬ìš©**ì„ ì„ íƒ
6. **ì¸ë±ìŠ¤ ë¬¸ì„œ(Index document)**ì— ì¸ë±ìŠ¤ ë¬¸ì„œ ì´ë¦„ì„ ì…ë ¥(ì¼ë°˜ì ìœ¼ë¡œÂ index.html)
    - 
        
        ![https://blog.kakaocdn.net/dn/bS5Cvy/btsdgTBcoMv/WUWJ4Z3FrLoVFDkLamhnmk/img.png](https://blog.kakaocdn.net/dn/bS5Cvy/btsdgTBcoMv/WUWJ4Z3FrLoVFDkLamhnmk/img.png)
        
    - ì¸ë±ìŠ¤ ë¬¸ì„œ ì´ë¦„ì€ ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ë©° S3 ë²„í‚·ì— ì—…ë¡œë“œí•˜ë ¤ëŠ” HTML ì¸ë±ìŠ¤ ë¬¸ì„œì˜ íŒŒì¼ ì´ë¦„ê³¼ ì •í™•íˆ ì¼ì¹˜í•´ì•¼í•˜ë©°, ì›¹ ì‚¬ì´íŠ¸ í˜¸ìŠ¤íŒ…ìš© ë²„í‚·ì„ êµ¬ì„±í•˜ëŠ” ê²½ìš° ì¸ë±ìŠ¤ ë¬¸ì„œë¥¼ ì§€ì •í•´ì•¼ ë£¨íŠ¸ ë„ë©”ì¸ì´ë‚˜ ì„ì˜ì˜ í•˜ìœ„ í´ë”ë¡œ ìš”ì²­ì´ ì „ì†¡ë˜ë©´ Amazon S3ê°€ ì´ ì¸ë±ìŠ¤ ë¬¸ì„œë¥¼ ë°˜í™˜í•¨ ([ì¸ë±ìŠ¤ ë¬¸ì„œ êµ¬ì„±](https://docs.aws.amazon.com/ko_kr/AmazonS3/latest/userguide/IndexDocumentSupport.html)Â ì„¹ì…˜ì„ ì°¸ê³ )
    - 4XX í´ë˜ìŠ¤ ì˜¤ë¥˜ì— ëŒ€í•œ ì‚¬ìš©ì ì§€ì • ì˜¤ë¥˜ ë¬¸ì„œë¥¼ ì œê³µí•˜ë ¤ë©´ [**ì˜¤ë¥˜ ë¬¸ì„œ(Error document)**]ì— ì‚¬ìš©ì ì§€ì • ì˜¤ë¥˜ ë¬¸ì„œ íŒŒì¼ ì´ë¦„ì„ ì…ë ¥
    - ì˜¤ë¥˜ ë¬¸ì„œ ì´ë¦„ì€ ëŒ€ì†Œë¬¸ìë¥¼ êµ¬ë¶„í•˜ë©° S3 ë²„í‚·ì— ì—…ë¡œë“œí•˜ë ¤ëŠ” HTML ì˜¤ë¥˜ ë¬¸ì„œì˜ íŒŒì¼ ì´ë¦„ê³¼ ì •í™•íˆ ì¼ì¹˜í•´ì•¼ í•¨, ì‚¬ìš©ì ì§€ì • ì˜¤ë¥˜ ë¬¸ì„œë¥¼ ì§€ì •í•˜ì§€ ì•Šì•˜ëŠ”ë° ì˜¤ë¥˜ê°€ ë°œìƒí•˜ë©´ Amazon S3ì—ì„œ ê¸°ë³¸ HTML ì˜¤ë¥˜ ë¬¸ì„œë¥¼ ë°˜í™˜í•¨ ([ì‚¬ìš©ì ì§€ì • ì˜¤ë¥˜ ë¬¸ì„œ êµ¬ì„±](https://docs.aws.amazon.com/ko_kr/AmazonS3/latest/userguide/CustomErrorDocSupport.html)ì„ ì°¸ê³ )
    - (ì„ íƒ ì‚¬í•­) ê³ ê¸‰ ë¦¬ë””ë ‰ì…˜ ê·œì¹™ì„ ì§€ì •í•˜ë ¤ë©´Â **ë¦¬ë””ë ‰ì…˜ ê·œì¹™(Redirection rules)**ì— JSONì„ ì…ë ¥í•˜ì—¬ ê·œì¹™ì„ ì„¤ëª… (ex.Â ìš”ì²­ì˜ íŠ¹ì • ê°ì²´ í‚¤ ì´ë¦„ ë˜ëŠ” ì ‘ë‘ì‚¬ì— ë”°ë¼ ì¡°ê±´ë¶€ë¡œ ìš”ì²­ì„ ë¼ìš°íŒ… ê°€ëŠ¥. ìì„¸í•œ ë‚´ìš©ì€Â [ê³ ê¸‰ ì¡°ê±´ë¶€ ë¦¬ë””ë ‰ì…˜ì„ ì‚¬ìš©í•˜ë„ë¡ ë¦¬ë””ë ‰ì…˜ ê·œì¹™ êµ¬ì„±](https://docs.aws.amazon.com/ko_kr/AmazonS3/latest/userguide/how-to-page-redirect.html#advanced-conditional-redirects)Â ì„¹ì…˜ì„ ì°¸ê³ )
7. [**ë³€ê²½ ì‚¬í•­ ì €ì¥(Save changes)**] ì„ íƒ
8. Amazon S3ëŠ” ë²„í‚·ì— ëŒ€í•œ ì •ì  ì›¹ ì‚¬ì´íŠ¸ í˜¸ìŠ¤íŒ…ì„ ì§€ì›í•˜ë©°, í˜ì´ì§€ í•˜ë‹¨ì˜Â **ì •ì  ì›¹ ì‚¬ì´íŠ¸ í˜¸ìŠ¤íŒ…(Static website hosting)**ì— ë²„í‚·ì˜ ì›¹ ì‚¬ì´íŠ¸ ì—”ë“œí¬ì¸íŠ¸ê°€ í‘œì‹œ
    - 
        
        ![https://blog.kakaocdn.net/dn/lY7fx/btsddtQ1oyq/pHhtDpdjXfKSXyzoaVzjrK/img.png](https://blog.kakaocdn.net/dn/lY7fx/btsddtQ1oyq/pHhtDpdjXfKSXyzoaVzjrK/img.png)
        
9. **ì •ì  ì›¹ ì‚¬ì´íŠ¸ í˜¸ìŠ¤íŒ…**ì—ì„œÂ **ì—”ë“œí¬ì¸íŠ¸**ë¥¼ ê¸°ë¡
10. **ì—”ë“œí¬ì¸íŠ¸**ëŠ” ë²„í‚·ì˜ Amazon S3 ì›¹ ì‚¬ì´íŠ¸ ì—”ë“œí¬ì¸íŠ¸ ë²„í‚·ì„ ì •ì  ì›¹ ì‚¬ì´íŠ¸ë¡œ êµ¬ì„±í•œ í›„ ì´ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ì›¹ ì‚¬ì´íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
11. S3 ë²„í‚·ì—ì„œ ê¶Œí•œ > ë²„í‚· ì •ì±… > í¸ì§‘ > ì •ì±…ìƒì„±ê¸° í´ë¦­í•´ ì •ì±…ì„ ë§Œë“¤ê³  ì ìš©
    - 
        
        ![https://blog.kakaocdn.net/dn/cKHOgD/btsdhAIlRfk/Va0HBgBkiOAP8EBxqH0Wb1/img.png](https://blog.kakaocdn.net/dn/cKHOgD/btsdhAIlRfk/Va0HBgBkiOAP8EBxqH0Wb1/img.png)
        
        ![https://blog.kakaocdn.net/dn/bTIRPK/btsdd0nvfTY/5Tszesyz9xuZRER31uzqw0/img.png](https://blog.kakaocdn.net/dn/bTIRPK/btsdd0nvfTY/5Tszesyz9xuZRER31uzqw0/img.png)
        
        ![https://blog.kakaocdn.net/dn/8V3p8/btsdpyJFY7Y/hXvKEpjWjODTDVjEvD8uOk/img.png](https://blog.kakaocdn.net/dn/8V3p8/btsdpyJFY7Y/hXvKEpjWjODTDVjEvD8uOk/img.png)
        

3.Â [S3ì— Pipeline ì‚¬ìš©í•˜ê¸° ì„¤ì •](https://docs.aws.amazon.com/ko_kr/codepipeline/latest/userguide/tutorials-simple-codecommit.html#codecommit-create-deployment)

1. [Properties] íƒ­ì—ì„œ [Versioning]ì„ ì„ íƒ [Enable versioning]ì„ ì„ íƒí•œ ë‹¤ìŒ [Save]ë¥¼ ì„ íƒ
2. ë²„ì „ ê´€ë¦¬ê°€ í™œì„±í™”ë˜ë©´ Amazon S3ëŠ” ë²„í‚·ì— ìˆëŠ” ëª¨ë“  ê°ì²´ì˜ ëª¨ë“  ë²„ì „ì„ ì €ì¥
3. [Permissions] íƒ­ì—ì„œ ê¸°ë³¸ê°’ì„ ê·¸ëŒ€ë¡œ ë‘ê¸°(S3ì˜ ë²„í‚· ë° ê°ì²´ ê¶Œí•œì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€Â [ì •ì±…ì—ì„œ ê¶Œí•œ ì§€ì •](https://docs.aws.amazon.com/AmazonS3/latest/dev/using-with-s3-actions.html)Â ë‹¨ì›ì„ ì°¸ì¡°)
4. Amazon S3 ì½˜ì†”ì—ì„œ ë²„í‚·ì— íŒŒì¼ì„ ì—…ë¡œë“œ
    - ì—…ë¡œë“œë¥¼ ì„ íƒ
    - íŒŒì¼ì„ ëŒì–´ì„œ ë†“ê±°ë‚˜Â íŒŒì¼ ì¶”ê°€ë¥¼ ì„ íƒí•˜ê³  íŒŒì¼ ì°¾ê¸°
    - ì—…ë¡œë“œë¥¼ ì„ íƒ

![https://blog.kakaocdn.net/dn/N0AYB/btsdo9wq8VP/4PzbyUMRwoHPiLPtDvNcvK/img.png](https://blog.kakaocdn.net/dn/N0AYB/btsdo9wq8VP/4PzbyUMRwoHPiLPtDvNcvK/img.png)

4. ë¹Œë“œí•œ WEB ì„œë²„ íŒŒì¼ ì—…ë¡œë“œ í›„ S3 ì—”ë“œí¬ì¸íŠ¸ë¡œ ì ‘ê·¼ ì‹œ ì •ìƒ ë™ì‘ í™•ì¸

![https://blog.kakaocdn.net/dn/bENSoK/btsddHho562/QOgvpBVYi8yzwRMO33VML0/img.png](https://blog.kakaocdn.net/dn/bENSoK/btsddHho562/QOgvpBVYi8yzwRMO33VML0/img.png)

# Step 3 : CodePipeline + CodeBuildìœ¼ë¡œ WEB ì„œë²„ ë°°í¬ ìë™í™” êµ¬í˜„

1. í”„ë¡œì íŠ¸ ìµœìƒìœ„ ë””ë ‰í† ë¦¬ì—ì„œÂ [buildspec.yml](https://docs.aws.amazon.com/ko_kr/codebuild/latest/userguide/build-spec-ref.html)Â íŒŒì¼ ìƒì„±

```
version: 0.2

phases:
  pre_build:
    commands:
      - cd helloworld-web
      - npm install
  build:
    commands:
      - npm run build

artifacts:
  files:
    - '**/*'
  base-directory: 'helloworld-web/build' # íŠ¹ìˆ˜ë¬¸ìê°€ ìˆì„ ì‹œ ''ë¡œ ê°ì‹¸ì£¼ì–´ì•¼ í•¨
  #discard-paths: yes # ë””ë ‰í† ë¦¬ëŠ” í¬í•¨í•˜ì§€ ì•ŠëŠ” ê²½ìš° ì‚¬ìš©
```

2. CodePipelineì—ì„œ íŒŒì´í”„ë¼ì¸ ìƒì„±

2-1. íŒŒì´í”„ë¼ì¸ ì„¤ì • ì„ íƒ : íŒŒì´í”„ë¼ì¸ëª…, ì„œë¹„ìŠ¤ ì—­í•  ì„ íƒ í›„ ë‹¤ìŒ

- ê³ ê¸‰ ì„¤ì •ì—ì„œ ì•„í‹°íŒ©íŠ¸ ìŠ¤í† ì–´ë‚˜ ì•”í˜¸í™” í‚¤ë¥¼ ì„ íƒí•  ìˆ˜ ìˆìœ¼ë©° "ì•„í‹°íŒ©íŠ¸ ìŠ¤í† ì–´"ì˜ ë¦¬í¬ì§€í† ë¦¬ ë²„í‚·ì€ ì›ë³¸ ë²„í‚·/ìœ„ì¹˜ë¥¼ ëœ»í•˜ëŠ” ê²Œ ì•„ë‹Œ ë³„ë„ì˜ Amazon S3 ë²„í‚·ì„ ë³„ë„ì˜ íŒŒì´í”„ë¼ì¸ ì•„í‹°íŒ©íŠ¸ ë¦¬í¬ì§€í† ë¦¬ë¡œ ì‚¬ìš©í•˜ëŠ” ê²ƒ

2-2. ì†ŒìŠ¤ ìŠ¤í…Œì´ì§€ ì¶”ê°€ : ë¹Œë“œí•  ì†ŒìŠ¤ì˜ ê³µê¸‰ìë¥¼ ì„ íƒí•˜ê³  í•´ë‹¹ ì†ŒìŠ¤ ê³µê¸‰ìì™€ AWS ì—°ê²° êµ¬ì„± í›„ ë¦¬í¬ì§€í† ë¦¬ ì´ë¦„ ë° ë¸Œëœì¹˜ë¥¼ ì„ íƒ

![https://blog.kakaocdn.net/dn/by7iqX/btsdlJSilvo/CoiFXmPJVABK5ypslSF3AK/img.png](https://blog.kakaocdn.net/dn/by7iqX/btsdlJSilvo/CoiFXmPJVABK5ypslSF3AK/img.png)

2-3. ë¹Œë“œ ìŠ¤í…Œì´ì§€ ì¶”ê°€ : ë¹Œë“œ ê³µê¸‰ìë¥¼ ì„ íƒ(ì´ ê²½ìš° Codebuild)í•˜ê³  ë¦¬ì „ì„ ì„ íƒ

![https://blog.kakaocdn.net/dn/DA1rx/btsdwumtZ0L/Ko77KMXFjGQn27Ao0oNOGK/img.png](https://blog.kakaocdn.net/dn/DA1rx/btsdwumtZ0L/Ko77KMXFjGQn27Ao0oNOGK/img.png)

- ì´ë¯¸ ìƒì„±í•œ CodeBuildê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš° ì„ íƒí•˜ê±°ë‚˜ ìƒˆë¡­ê²Œ ìƒì„±í•  ê²½ìš° í”„ë¡œì íŠ¸ ìƒì„±ì„ ì„ íƒí•´ ìƒˆë¡œìš´ CodeBuild í”„ë¡œì íŠ¸ë¥¼ ìƒì„±

ë”ë³´ê¸°

2-4. ë°°í¬ ìŠ¤í…Œì´ì§€ ì¶”ê°€ : ë°°í¬ ê´€ë ¨ ì„¤ì • ë‚´ìš© ì§€ì •

![https://blog.kakaocdn.net/dn/cDJ2l2/btsdjn9NBhD/T7erKTLHkhi3p15gsEtNH0/img.png](https://blog.kakaocdn.net/dn/cDJ2l2/btsdjn9NBhD/T7erKTLHkhi3p15gsEtNH0/img.png)

2-5.Â ê²€í†  : íŒŒì´í”„ë¼ì¸ ë‚´ìš© ê²€í†  í›„ íŒŒì´í”„ë¼ì¸ ìƒì„±

![https://blog.kakaocdn.net/dn/zAl41/btsdpyQs2np/W9s0weTeeKhb3ilRTkorfk/img.png](https://blog.kakaocdn.net/dn/zAl41/btsdpyQs2np/W9s0weTeeKhb3ilRTkorfk/img.png)

3. íŒŒì´í”„ë¼ì¸ ìƒì„± í›„ ì •ìƒì ìœ¼ë¡œ WEB ì„œë²„ê°€ S3 ë²„í‚·ì— ë¹Œë“œ, ë°°í¬ ìë™í™”ë˜ëŠ” ê³¼ì • í™•ì¸

3-1. CodePipelineì—ì„œ ì†ŒìŠ¤ ë¹Œë“œ, ë°°í¬ ìë™í™” ë‚´ì—­ í™•ì¸

![https://blog.kakaocdn.net/dn/dJ04Ee/btsddtXPdDw/dM9kzRGrRBVg2a6KGv7kKK/img.png](https://blog.kakaocdn.net/dn/dJ04Ee/btsddtXPdDw/dM9kzRGrRBVg2a6KGv7kKK/img.png)

3-2.Â S3 ë²„í‚· ì—”ë“œí¬ì¸íŠ¸ë¡œ ì ‘ì†í•´ WEB ì„œë²„ í˜ì´ì§€ê°€ ì •ìƒì ìœ¼ë¡œ ë°°í¬ë˜ì—ˆëŠ”ì§€ í™•ì¸

![https://blog.kakaocdn.net/dn/zk0li/btsdeG93Nla/rfUXKbME64zTvV3CPO8aDk/img.png](https://blog.kakaocdn.net/dn/zk0li/btsdeG93Nla/rfUXKbME64zTvV3CPO8aDk/img.png)

# Step 4 :Â WEB ì„œë²„ ë‚´ìš©ì„ ë³€ê²½í•œ í›„ ë³€ê²½ì‚¬í•­ì´ ì œëŒ€ë¡œ S3ì— ë°°í¬ ë˜ëŠ”ì§€ í™•ì¸

1. WEB ì„œë²„ íŒŒì¼ ë‚´ìš©ì„ ìˆ˜ì •í•œ ë’¤ ë¦¬íŒŒì§€í† ë¦¬ì— add, commit, push ìˆ˜í–‰

```jsx
// *.jsì˜ ê²½ê³  ë©”ì‹œì§€ ìˆ˜ì •
// ... ìƒëµ ...
  if (error) return <FilledMessage>ìš”ì²­ì„ ë°›ì•„ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ ë¬¸ì œê°™ì€ë°ìš”? ì›¹ ë°°í¬ ìë™í™”ëŠ” ì„±ê³µì ìœ¼ë¡œ ì´ë£¨ì–´ì¡ŒìŠµë‹ˆë‹¤.</FilledMessage>
// ... í•˜ëµ ...
```

2. CodePipelineì—ì„œ ì •ìƒì ìœ¼ë¡œ ë¹Œë“œ, ë°°í¬ê°€ ìˆ˜í–‰ë˜ëŠ”ì§€ í™•ì¸

2-1. CodePipelineì—ì„œ ì†ŒìŠ¤ ë¹Œë“œ, ë°°í¬ ìë™í™” ë‚´ì—­ í™•ì¸

![https://blog.kakaocdn.net/dn/bisH8m/btsde0AwTim/nrWQakqpPtKZIep6Qkrxck/img.png](https://blog.kakaocdn.net/dn/bisH8m/btsde0AwTim/nrWQakqpPtKZIep6Qkrxck/img.png)

2-2.Â S3 ë²„í‚· ì—”ë“œí¬ì¸íŠ¸ë¡œ ì ‘ì†í•´ ìˆ˜ì •ëœ WEB ì„œë²„ í˜ì´ì§€ê°€ ì •ìƒì ìœ¼ë¡œ ë°°í¬ë˜ì—ˆëŠ”ì§€ í™•ì¸

![https://blog.kakaocdn.net/dn/yMusG/btsddt4xDOk/im0r9saoOxYvkR2e6T8LjK/img.png](https://blog.kakaocdn.net/dn/yMusG/btsddt4xDOk/im0r9saoOxYvkR2e6T8LjK/img.png)

# **âœï¸Â ë§ˆì¼ìŠ¤í†¤8Â -Â í”„ë¡ íŠ¸ì—”ë“œÂ HTTPSÂ ì ìš©**

# Step 1 :Â CloudFrontì—ì„œ ë°°í¬ë¥¼ ìƒì„±í•´ WEB ì„œë²„ê°€ ë°°í¬ëœ S3 ë²„í‚·ê³¼ ì—°ê²°

1. ì›ë³¸ ì„¹ì…˜ì˜ [ì›ë³¸ ë„ë©”ì¸]ì—ì„œ ì‚¬ìš©í•  AWS ì„œë¹„ìŠ¤ë‚˜ ì›ë³¸ ë„ë©”ì¸ ì´ë¦„ ì…ë ¥
2. ê¸°ë³¸ ìºì‹œ ë™ì‘ ì„¹ì…˜ì˜ [ë·°ì–´ í”„ë¡œí† ì½œ ì •ì±…]ì„ Redirect HTTP to HTTPSë¡œ ì„¤ì •
    - CloudFrontì— SSL ì¸ì¦ì„œë¥¼ ì ìš©í•´ S3 ë²„í‚·ì˜ WEB ì„œë²„ì— HTTPS ì•”í˜¸í™”ë¥¼ ì ìš©í•  ê²ƒì´ë¯€ë¡œ HTTP ìš”ì²­ì„ HTTPSë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
3. ì„¤ì • ì„¹ì…˜ì˜ [ëŒ€ì²´ ë„ë©”ì¸ ì´ë¦„]ì— ì‚¬ìš©í•  ë„ë©”ì¸ëª… ì…ë ¥
4. ì„¤ì • ì„¹ì…˜ì˜ [ì‚¬ìš©ì ì •ì˜ SSL ì¸ì¦ì„œ]ì— 3ë²ˆ í•­ëª©ì˜ ë„ë©”ì¸ì— ë°œê¸‰ ë°›ì€ ì¸ì¦ì„œë¥¼ ì ìš©
    - CloudFrontì˜ ê²½ìš° us-east-1 ë¦¬ì „ì˜ ì¸ì¦ì„œë¥¼ ì ìš©í•´ì•¼ í•˜ë¯€ë¡œ í•´ë‹¹ ë¦¬ì „ì˜ ì¸ì¦ì„œê°€ ì—†ëŠ” ê²½ìš° í•˜ë‹¨ì˜ ì¸ì¦ì„œ ìš”ì²­ì„ í†µí•´ ë°œê¸‰ë°›ì•„ ì ìš©
5. ì„¤ì • ì„¹ì…˜ì˜ [IPv6]ëŠ” ë„ê¸°ë¡œ ì„¤ì •

ë”ë³´ê¸°

# Step 2 : Route53ì„ ì´ìš©í•´ CloudFrontê³¼ ë„ë©”ì¸ ì—°ê²°

1. Route53 ì½˜ì†”ì˜ í˜¸ìŠ¤íŒ… ì˜ì—­ì—ì„œ CloudFrontì™€ ì—°ê²°í•  í˜¸ìŠ¤íŒ… ì˜ì—­ì—ì„œ ë ˆì½”ë“œ ìƒì„±

1-1. 1ë‹¨ê³„ ë¼ìš°íŒ… ì •ì±…ì—ì„œ ë‹¨ìˆœ ë¼ìš°íŒ… ì„ íƒ

1-2. 2ë‹¨ê³„ ë ˆì½”ë“œ êµ¬ì„±ì—ì„œ ë‹¨ìˆœ ë ˆì½”ë“œ ì •ì˜ ì„ íƒ

![https://blog.kakaocdn.net/dn/bdBCiA/btsdhyw9ukK/QpjXigKA672kCM2aPJ2oKK/img.png](https://blog.kakaocdn.net/dn/bdBCiA/btsdhyw9ukK/QpjXigKA672kCM2aPJ2oKK/img.png)

1. CloudFront ë°°í¬ë¥¼ ìƒì„±í•  ë•Œ ì…ë ¥í•œ ëŒ€ì²´ ë„ë©”ì¸ ì´ë¦„ê³¼ ë™ì¼í•˜ê²Œ [ë ˆì½”ë“œ ì´ë¦„] ì…ë ¥
2. [ê°’/íŠ¸ë˜í”½ ë¼ìš°íŒ… ëŒ€ìƒ]ì—ì„œ ì‚¬ìš©í•  ëŒ€ìƒ, ì´ ê²½ìš° CloudFront ë°°í¬ì— ëŒ€í•œ ë³„ì¹­ì„ ì„ íƒ
3. ì‹¤ì œ ì‚¬ìš©í•  CloudFront ë°°í¬ ì„ íƒ
4. [ë‹¨ìˆœ ë ˆì½”ë“œ ì •ì˜] ë²„íŠ¼ ì„ íƒí•˜ì—¬ ë ˆì½”ë“œ ë“±ë¡

# Step 3 : CloudFrontì˜ ë°°í¬ ë„ë©”ì¸ ì´ë¦„ê³¼ ëŒ€ì²´ ë„ë©”ì¸ ì´ë¦„(Route53ì— ë“±ë¡í•œ ë„ë©”ì¸)ìœ¼ë¡œ ì ‘ê·¼ ì‹œ HTTPSê°€ ì ìš©ëœ WEB ì„œë²„ë¡œ ì ‘ì†ë˜ëŠ”ì§€ í™•ì¸

![https://blog.kakaocdn.net/dn/bqwuho/btsdegcLJAS/OMlbZDyDKuvT2dFCCOZQok/img.png](https://blog.kakaocdn.net/dn/bqwuho/btsdegcLJAS/OMlbZDyDKuvT2dFCCOZQok/img.png)

1. ë°°í¬ ë„ë©”ì¸ ì´ë¦„ìœ¼ë¡œ ì ‘ì† ì‹œ

![https://blog.kakaocdn.net/dn/IXSps/btsdi3wVhbq/BxYbZtpph1NTWeljykbS5K/img.png](https://blog.kakaocdn.net/dn/IXSps/btsdi3wVhbq/BxYbZtpph1NTWeljykbS5K/img.png)

2. ëŒ€ì²´ ë„ë©”ì¸ ì´ë¦„ìœ¼ë¡œ ì ‘ì† ì‹œ

![https://blog.kakaocdn.net/dn/c8eNyg/btsdsRh51Bu/QdBXHabPDV6qxT7rqE8nv1/img.png](https://blog.kakaocdn.net/dn/c8eNyg/btsdsRh51Bu/QdBXHabPDV6qxT7rqE8nv1/img.png)

3. WAS ALBì™€ WEB CloudFrontì˜ Route 53 ë„ë©”ì¸ ì ìš© í™•ì¸

![https://blog.kakaocdn.net/dn/AXDbS/btsdxi7xotu/po88Ayar9prjDeUdfQwmb1/img.png](https://blog.kakaocdn.net/dn/AXDbS/btsdxi7xotu/po88Ayar9prjDeUdfQwmb1/img.png)

# **âœï¸Â ë§ˆì¼ìŠ¤í†¤9Â -Â í”„ë¡ íŠ¸ì—”ë“œ-ì„œë²„Â ì—°ê²°Â í™•ì¸**

# Step 1 : WEB ì„œë²„ê°€ ì˜ ì‘ë™í•˜ë„ë¡, WAS ì¸¡ ì½”ë“œë¥¼ ë³€ê²½

1.Â GETÂ /api/restaurants/Â APIÂ ì‘ì„±

```jsx
// .../routes/api/restaurants/index.js

'use strict'

module.exports = async function (fastify, opts) {
  fastify.get('/', async function (req, reply) {
    reply.send([
      {
        "name": "ìš©ë‹¤ë°©",
        "menu": [
          {
            "name": "ì• í”Œ ì‹œë‚˜ëª¬ ì—ì´ë“œ",
            "price": 6500,
            "duration": 5
          },
          {
            "name": "ì¹´í˜ëª¨ì¹´",
            "price": 6000,
            "duration": 5
          }
        ],
        "address": "ì„œìš¸ì‹œ ë§ˆí¬êµ¬ ì–‘í™”ë¡œ 1111",
        "rating": 4.5
      }
    ])
  })
}
```

2. HTTP ìš”ì²­ì„ í†µí•œ API í…ŒìŠ¤íŠ¸

```
$ curl http://localhost:3000/api/restaurants
[{"name":"ìš©ë‹¤ë°©","menu":[{"name":"ì• í”Œ ì‹œë‚˜ëª¬ ì—ì´ë“œ","price":6500,"duration":5},{"name":"ì¹´í˜ëª¨ì¹´","price":6000,"duration":5}],"address":"ì„œìš¸ì‹œ ë§ˆí¬êµ¬ ì–‘í™”ë¡œ 1111","rating":4.5}]%
```

# Step 2 : WASì— CORS í—ˆìš©

![https://blog.kakaocdn.net/dn/dx9VBK/btsdpxEdvJJ/A7MkDpqRodcAvpG5243NUK/img.png](https://blog.kakaocdn.net/dn/dx9VBK/btsdpxEdvJJ/A7MkDpqRodcAvpG5243NUK/img.png)

1.Â [@fastify/cors](https://www.npmjs.com/package/@fastify/cors)Â ëª¨ë“ˆ ì„¤ì¹˜

```
$ npm i @fastify/cors
```

# 2. WAS ì„œë²„ì˜ plugins ë””ë ‰í† ë¦¬ í•˜ìœ„ì— cors.js ëª¨ë“ˆ(í”ŒëŸ¬ê·¸ì¸) ë“±ë¡

```jsx
'use strict'

const fp = require('fastify-plugin')

module.exports = fp(async function (fastify, opts) {
  fastify.register(require('@fastify/cors'), {
    origin: "ë„ë©”ì¸ì£¼ì†Œ"
  })
})
```

# Step 3 : í”„ë¡ íŠ¸ì—”ë“œê°€ ì˜¬ë°”ë¥¸ ì„œë²„ë¥¼ ë°”ë¼ë³¼ ìˆ˜ ìˆë„ë¡ í™˜ê²½ë³€ìˆ˜ë¥¼ ì„¤ì • í›„ WEB ì„œë²„ì™€ WASê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸

1. CodeBuild ì½˜ì†”ì—ì„œ í”„ë¡œì íŠ¸ ë¹Œë“œ > ë¹Œë“œ í”„ë¡œì íŠ¸ ì´ë¦„ ì„ íƒ í›„ í¸ì§‘ > í™˜ê²½ ì„ íƒ

![https://blog.kakaocdn.net/dn/ZqdtB/btsdtFaRYiL/GtoxicfT6flONA7l90ktOk/img.png](https://blog.kakaocdn.net/dn/ZqdtB/btsdtFaRYiL/GtoxicfT6flONA7l90ktOk/img.png)

2.Â  WEB ì„œë²„ì— ì§€ì •ëœ WAS API í™˜ê²½ ë³€ìˆ˜ë¥¼ HTTPS ì ‘ê·¼ì´ ê°€ëŠ¥í•œ ë„ë©”ì¸ìœ¼ë¡œ ìˆ˜ì •

![https://blog.kakaocdn.net/dn/bgfWBL/btsddTPBZOD/69neE4qEtWaJ6DYl4lqtTK/img.png](https://blog.kakaocdn.net/dn/bgfWBL/btsddTPBZOD/69neE4qEtWaJ6DYl4lqtTK/img.png)

3. í™˜ê²½ ë³€ìˆ˜ ìˆ˜ì • í›„ WEBì„œë²„ë¡œ ì ‘ê·¼ ì‹œ WASì™€ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸

![https://blog.kakaocdn.net/dn/J7dAJ/btsdpbnFqGM/r0EDH1I4g6DdiZn9hv4DR1/img.png](https://blog.kakaocdn.net/dn/J7dAJ/btsdpbnFqGM/r0EDH1I4g6DdiZn9hv4DR1/img.png)

![https://blog.kakaocdn.net/dn/c7cVev/btsdpxqGcHF/q1KcsNno3jKT0QLvT9HkhK/img.png](https://blog.kakaocdn.net/dn/c7cVev/btsdpxqGcHF/q1KcsNno3jKT0QLvT9HkhK/img.png)

# #TROUBLE SHOOTING LOG

# ğŸ“ ë¬¸ì œ 1 : ì›¹ ì„œë²„ ìë™í™” íŒŒì´í”„ë¼ì¸ êµ¬ì„± ì‹œ Sourceì—ì„œ ê¶Œí•œ ë¶€ì¡± ë¬¸ì œ ë°œìƒ

![https://blog.kakaocdn.net/dn/pxjSc/btsdeINuaLN/dCNjYYUG9AyKKCfagbAqXk/img.png](https://blog.kakaocdn.net/dn/pxjSc/btsdeINuaLN/dCNjYYUG9AyKKCfagbAqXk/img.png)

> The provided role cannot be assumed: 'Access denied when attempting to assume the role 'arn:aws:iam::123456789012:role/service-role/AWSCodePipelineServiceRole-ap-northeast-2-helloworld-web''
> 
- ì›ì¸ : S3 ë²„í‚·ì— ëŒ€í•œ íŒŒì´í”„ë¼ì¸ ì„œë¹„ìŠ¤ ë¡¤(IAM)ì„ ì‚¬ìš©í•´ AWS ë¦¬ì†ŒìŠ¤ì— ëŒ€í•´ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆëŠ” ê¶Œí•œ ì •ì±…ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
- í•´ê²° ë°©ì•ˆ :Â í•´ë‹¹ IAM ì •ì±…ì—ì„œ ì‚¬ìš©ìê°€ ìœ„ì„í•˜ë ¤ëŠ” ì—­í• ì— ëŒ€í•´Â sts:AssumeRoleì„ í˜¸ì¶œí•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬([https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/troubleshoot_roles.html)](https://docs.aws.amazon.com/ko_kr/IAM/latest/UserGuide/troubleshoot_roles.html)

![https://blog.kakaocdn.net/dn/2Sodk/btsdemw3u1c/739Qz5wBN8TLSdk1nFy1y1/img.png](https://blog.kakaocdn.net/dn/2Sodk/btsdemw3u1c/739Qz5wBN8TLSdk1nFy1y1/img.png)

# # REFERENCES

[https://rainbound.tistory.com/entry/AWS-Parameter-Store-%EC%99%80-AWS-Secrets-Manager-%EA%B3%B5%ED%86%B5%EC%A0%90%EA%B3%BC-%EC%B0%A8%EC%9D%B4%EC%A0%90](https://rainbound.tistory.com/entry/AWS-Parameter-Store-%EC%99%80-AWS-Secrets-Manager-%EA%B3%B5%ED%86%B5%EC%A0%90%EA%B3%BC-%EC%B0%A8%EC%9D%B4%EC%A0%90)



[https://www.npmjs.com/package/@fastify/cors](https://www.npmjs.com/package/@fastify/cors)



[https://velog.io/@jisun-rea/AWS-IAM-Role-AssumeRole](https://velog.io/@jisun-rea/AWS-IAM-Role-AssumeRole)

