---
date: 2023-05-10 00:00:00
layout: post
title: DevOps&#91;API Gatewayì™€ ì„œë²„ë¦¬ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜&#93; / [Sprint]
subtitle: '01. API Gatewayì™€ ì„œë²„ë¦¬ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜'
description: 01. API Gatewayì™€ ì„œë²„ë¦¬ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜
image: /thumbnail/msa.png
optimized_image: /thumbnail/msa.png
category: Sprint
tags:
  - MSA
  - ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤
  - AWS Lambda
  - API Gateway
  - Serverless Application Model
  - SAM
  - SAM CLI
  - DynamoDB
  - DevOps BootCamp
author: teddy-woo

---

# #í•™ìŠµ ëª©í‘œ

- DynamoDBì— ë ˆì½”ë“œë¥¼ ì¶”ê°€í•˜ëŠ” ê°„ë‹¨í•œ ëŒë‹¤ í•¨ìˆ˜ë¥¼ í•˜ë‚˜ ë§Œë“¤ê³ , API Gatewayë¥¼ í†µí•´ ì´ë¥¼ í˜¸ì¶œí•˜ëŠ” ì˜ˆì œ
- Lambda í•¨ìˆ˜ì— JSON í˜•ì‹ì˜ payloadë¥¼ ì‹£ê³  ì‹¤í–‰í•˜ë©´ DynamoDBì— í•´ë‹¹ payloadê°€ ì €ì¥

# #í•´ê²° ê³¼ì œ

ğŸ’¡ë‹¤ìŒ ì•„í‚¤í…ì²˜ë¡œ êµ¬ì„±ëœ ì„œë²„ë¦¬ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬

- API Gateway - Lambda - DynamoDB

ğŸ’¡ì§ì ‘ API Gatewayë¡œ ì‹¤í–‰

ğŸ’¡ API Gatewayì˜ ì¸ì¦ ê¸°ëŠ¥ì„ ì´ìš©í•´ì„œ, HTTP ìš”ì²­ì— íŠ¹ì • API Keyë¥¼ ì‚¬ìš©í•˜ëŠ” ì˜ˆì œë¥¼ ë‹¤ìŒ ë‘ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ êµ¬í˜„

1. API Key
2. ê¶Œí•œ ë¶€ì—¬ì

ğŸ’¡CloudWatch Logsë¥¼ í†µí•´ì„œ API í˜¸ì¶œì„ ëª¨ë‹ˆí„°ë§í•  ìˆ˜ ìˆì–´ì•¼ í•¨

# #ê³¼ì œ í•­ëª©ë³„ ì§„í–‰ ìƒí™©

# **âœï¸**Â Â API Gateway - Lambda ë°°í¬ Instruction

# Step 1 :Â [Lambda to DynamoDB](https://serverlessland.com/patterns/lambda-dynamodb)Â SAM templates ë‹¤ìš´

```
$ git clone https://github.com/aws-samples/serverless-patterns/
```

# Step 2 :Â Lambda-dynamodbë¡œ ì´ë™í•´ template.yaml íŒŒì¼ì˜ Runtimeì„ ìˆ˜ì •

```
$ cd serverless-patterns/lambda-dynamodb
```

```
# template.yaml
- Runtime: nodejs12.x
+ Runtime: nodejs14.x
```

# Step 3 :Â sam build ëª…ë ¹ì–´ë¥¼ í†µí•´ í•¨ìˆ˜ê°€ ë¹Œë“œë˜ëŠ”ì§€ í™•ì¸

```
$ sam build
Building codeuri: .../serverless-patterns/lambda-dynamodb/src runtime: nodejs14.x metadata: {} architecture: x86_64 functions: LambdaPutDynamoDB
Running NodejsNpmBuilder:NpmPack
Running NodejsNpmBuilder:CopyNpmrcAndLockfile
Running NodejsNpmBuilder:CopySource
Running NodejsNpmBuilder:NpmInstall
Running NodejsNpmBuilder:CleanUpNpmrc
Running NodejsNpmBuilder:LockfileCleanUp

Build Succeeded

Built Artifacts  : .aws-sam/build
Built Template   : .aws-sam/build/template.yaml

Commands you can use next
=========================
[*] Validate SAM template: sam validate
[*] Invoke Function: sam local invoke
[*] Test Function in the Cloud: sam sync --stack-name {{stack-name}} --watch
[*] Deploy: sam deploy --guided
```

# Step 4 :Â sam deploy --guided ëª…ë ¹ì–´ë¥¼ í†µí•´ í•¨ìˆ˜ê°€ ë¹Œë“œë˜ëŠ”ì§€ í™•ì¸

```
$ sam deploy --guided

Configuring SAM deploy
======================

        Looking for config file [samconfig.toml] :  Found
        Reading default arguments  :  Success

        Setting default arguments for 'sam deploy'
        =========================================
        Stack Name [lambda-to-dynamodb]:
        AWS Region [ap-northeast-2]:
        #Shows you resources changes to be deployed and require a 'Y' to initiate deploy
        Confirm changes before deploy [y/N]: n
        #SAM needs permission to be able to create roles to connect to the resources in your template
        Allow SAM CLI IAM role creation [Y/n]: y
        #Preserves the state of previously provisioned resources when an operation fails
        Disable rollback [y/N]: n
        Save arguments to configuration file [Y/n]:
        SAM configuration file [samconfig.toml]:
        SAM configuration environment [default]:

        Looking for resources needed for deployment:

        Managed S3 bucket: aws-sam-cli-managed-default-samclisourcebucket-ubujxdz5rfok
        A different default S3 bucket can be set in samconfig.toml and auto resolution of buckets turned off by setting resolve_s3=False

        Saved arguments to config file
        Running 'sam deploy' for future deployments will use the parameters saved above.
        The above parameters can be changed by modifying samconfig.toml
        Learn more about samconfig.toml syntax at
        https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-config.html

        Uploading to lambda-to-dynamodb/b38b202e2b5bff16cd97a71d47b73087  1130928 / 1130928  (100.00%)

        Deploying with following values
        ===============================
        Stack name                   : lambda-to-dynamodb
        Region                       : ap-northeast-2
        Confirm changeset            : False
        Disable rollback             : False
        Deployment s3 bucket         : aws-sam-cli-managed-default-samclisourcebucket-ubujxdz5rfok
        Capabilities                 : ["CAPABILITY_IAM"]
        Parameter overrides          : {}
        Signing Profiles             : {}

Initiating deployment
=====================

        Uploading to lambda-to-dynamodb/782b0313f9e2219cee119519e5141c8a.template  1156 / 1156  (100.00%)

Waiting for changeset to be created..

CloudFormation stack changeset
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Operation                                   LogicalResourceId                           ResourceType                                Replacement
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
* Modify                                    LambdaPutDynamoDB                           AWS::Lambda::Function                       False
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Changeset created successfully. arn:aws:cloudformation:ap-northeast-2::changeSet/samcli-deploy1683691126/25d0b333-4a71-41e4-b8d0-3d88f2816163

2023-05-10 12:58:58 - Waiting for stack create/update to complete

CloudFormation events from stack operations (refresh every 5.0 seconds)
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
ResourceStatus                              ResourceType                                LogicalResourceId                           ResourceStatusReason
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
UPDATE_IN_PROGRESS                          AWS::Lambda::Function                       LambdaPutDynamoDB                           -
UPDATE_COMPLETE                             AWS::Lambda::Function                       LambdaPutDynamoDB                           -
UPDATE_COMPLETE_CLEANUP_IN_PROGRESS         AWS::CloudFormation::Stack                  lambda-to-dynamodb                          -
UPDATE_COMPLETE                             AWS::CloudFormation::Stack                  lambda-to-dynamodb                          -
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------

CloudFormation outputs from deployed stack
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Outputs
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Key                 DynamoDbTable
Description         DynamoDb Table
Value               lambda-to-dynamodb-DynamoTable-1VKHDFAO14BW3

Key                 LambdFunction
Description         LambdaPutDynamoDB function  Arn
Value               lambda-to-dynamodb-LambdaPutDynamoDB-RkTVQTa8WYqP
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Successfully created/updated stack - lambda-to-dynamodb in ap-northeast-2

$
```

# Step 5 :Â í•¨ìˆ˜ê°€ ë¹Œë“œ, ë°°í¬ë˜ê³  ì˜ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸

```
$ aws lambda invoke --function-name arn:aws:lambda:ap-northeast-2:<AWS ACCOUNT ID>:function:lambda-to-dynamodb-LambdaPutDynamoDB --invocation-type Event  --payload '{ "Metadata": "Hello" }'  response.json --cli-binary-format raw-in-base64-out
{
    "StatusCode": 202
}
```

# **âœï¸Â API ê²Œì´íŠ¸ì›¨ì´ - Lambda**

# Step 1 : AWS Lambda ì½˜ì†”ì—ì„œ ìƒì„±ëœ í•¨ìˆ˜ëª… ì„ íƒ í›„ íŠ¸ë¦¬ê±° ì¶”ê°€

![https://blog.kakaocdn.net/dn/bfhlR6/btsezLu4SYm/v46fOfYw16ZvKV80T9v341/img.png](https://blog.kakaocdn.net/dn/bfhlR6/btsezLu4SYm/v46fOfYw16ZvKV80T9v341/img.png)

# Step 2 :Â API ê²Œì´íŠ¸ì›¨ì´ë¥¼ ìƒì„±

![https://blog.kakaocdn.net/dn/cAzEY1/btseztn6yYT/teZLpjKQcJrjrNkYKywPgk/img.png](https://blog.kakaocdn.net/dn/cAzEY1/btseztn6yYT/teZLpjKQcJrjrNkYKywPgk/img.png)

1. API ê²Œì´íŠ¸ì›¨ì´ë¥¼ ì„ íƒ
2. ìƒˆ APIë¥¼ ìƒì„±
3. REST API ìœ í˜•
4. ë³´ì•ˆì€ "ì—´ê¸°"

# Step 3 :Â API ì—”ë“œí¬ì¸íŠ¸ì— HTTP ìš”ì²­ì„ ë³´ë‚´ë©´, í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ìš”ì²­ì˜ ìƒì„¸ ë‚´ìš©ì´ DynamoDBì— ì €ì¥ë˜ëŠ”ì§€ í™•ì¸

1. API ê²Œì´íŠ¸ì›¨ì´ì˜ endpoint í™•ì¸

![https://blog.kakaocdn.net/dn/b5I1TX/btseATzmZnb/1nTEqMj2r1IfARxTaKT8Q1/img.png](https://blog.kakaocdn.net/dn/b5I1TX/btseATzmZnb/1nTEqMj2r1IfARxTaKT8Q1/img.png)

2. ì—”ë“œí¬ì¸íŠ¸ì— curl ëª…ë ¹ì–´ë¡œ ìš”ì²­ ì „ì†¡í•˜ê±°ë‚˜ ì›¹ ë¸Œë¼ìš°ì €ì— ì ‘ì†í•´ í…ŒìŠ¤íŠ¸

```
$curl -X POST -H "Content-Type: application/json" -d "{ \"metatdata\":\"test!\" }" https://1234567890.execute-api.ap-northeast-2.amazonaws.com/default
```

3. sam deploy ì‹œ ìƒì„±ëœ DynamoDBì— ì •ìƒì ìœ¼ë¡œ ë°ì´í„°ê°€ ì…ë ¥ë˜ì—ˆëŠ”ì§€ í™•ì¸

![https://blog.kakaocdn.net/dn/GOnvP/btseGblKN2x/KWMZxhXF5ToyE1mgWt1Jak/img.png](https://blog.kakaocdn.net/dn/GOnvP/btseGblKN2x/KWMZxhXF5ToyE1mgWt1Jak/img.png)

# **âœï¸Â Â API ê²Œì´íŠ¸ì›¨ì´ì— ì œí•œ ì¶”ê°€í•˜ê¸°**

# Step 1 :Â [POST ì „ìš©](https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/api-gateway-create-api-from-example.html)ìœ¼ë¡œë§Œ ì‘ë™í•˜ê²Œ ë§Œë“¤ê¸°

![https://blog.kakaocdn.net/dn/ch56Jc/btseDVjmEVq/rOuydmk0Fx7qoeIkKTwMQk/img.png](https://blog.kakaocdn.net/dn/ch56Jc/btseDVjmEVq/rOuydmk0Fx7qoeIkKTwMQk/img.png)

![https://blog.kakaocdn.net/dn/baPg3X/btseGDbq5Sp/dInZgZ2bAT9KHUaCncA0r0/img.png](https://blog.kakaocdn.net/dn/baPg3X/btseGDbq5Sp/dInZgZ2bAT9KHUaCncA0r0/img.png)

![https://blog.kakaocdn.net/dn/OL8nn/btsezDDK6AC/S5JieTJBmon0ZtXomNsbRK/img.png](https://blog.kakaocdn.net/dn/OL8nn/btsezDDK6AC/S5JieTJBmon0ZtXomNsbRK/img.png)

![https://blog.kakaocdn.net/dn/D3e4f/btsexervJpt/ujc9Nb4K84nDJudGcYWdn1/img.png](https://blog.kakaocdn.net/dn/D3e4f/btsexervJpt/ujc9Nb4K84nDJudGcYWdn1/img.png)

![https://blog.kakaocdn.net/dn/dd0zAz/btsey7kOgN9/9F2feqLOR6jSFvb4fXwLOk/img.png](https://blog.kakaocdn.net/dn/dd0zAz/btsey7kOgN9/9F2feqLOR6jSFvb4fXwLOk/img.png)

```
$curl -X POST -H "Content-Type: application/json" -d "{ \"metatdata\":\"only POST test!\" }" https://1234567890.execute-api.ap-northeast-2.amazonaws.com/default
```

![https://blog.kakaocdn.net/dn/cFzBOO/btseAUkZNyi/13itbXIyOtWnlfn4chwXD0/img.png](https://blog.kakaocdn.net/dn/cFzBOO/btseAUkZNyi/13itbXIyOtWnlfn4chwXD0/img.png)

# Step 2 : ë³¸ë¬¸ë§Œ ì €ì¥í•˜ë„ë¡ ë§Œë“¤ê¸°

```jsx
/*! Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *  SPDX-License-Identifier: MIT-0
 */

// dependencies
const AWS = require('aws-sdk');
const moment = require('moment');
const documentClient = new AWS.DynamoDB.DocumentClient();

exports.handler =  async (event) => {
    let params = {
        TableName : process.env.DatabaseTable,
        Item: {
        ID: Math.floor(Math.random() * Math.floor(10000000)).toString(),
        created:  moment().format('YYYYMMDD-hhmmss'),
        metadata:event["metadata"],
        }
    }
    console.log(params)
    try {
        let data = await documentClient.put(params).promise()
        console.log(data)
    }
    catch (err) {
        console.log(err)
        return err
    }
    return {
          statusCode: 200,
          body: 'OK!',
      }
}
```

# Step 3 :Â [API í‚¤ë¥¼ ì´ìš©í•œ ì¸ì¦](https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/api-gateway-api-usage-plans.html)Â ì¶”ê°€í•˜ê¸°

1. ë©”ì„œë“œì—ì„œ API í‚¤ë¥¼ ìš”êµ¬í•˜ë„ë¡ ì„¤ì •

![https://blog.kakaocdn.net/dn/b1ZBq7/btseGDo3JMy/GtKkjiaWSXjl3GKZiuq8UK/img.png](https://blog.kakaocdn.net/dn/b1ZBq7/btseGDo3JMy/GtKkjiaWSXjl3GKZiuq8UK/img.png)

![https://blog.kakaocdn.net/dn/L4utL/btseAbAhXBX/sS1dGSSI3mdd9JhUsRrvz0/img.png](https://blog.kakaocdn.net/dn/L4utL/btseAbAhXBX/sS1dGSSI3mdd9JhUsRrvz0/img.png)

1. AWS Management Consoleì— ë¡œê·¸ì¸í•˜ê³ Â [https://console.aws.amazon.com/apigateway/](https://console.aws.amazon.com/apigateway/)ì—ì„œ API Gateway ì½˜ì†”ì„ ì„ íƒ
2. REST APIë¥¼ ì„ íƒ
3. API Gateway ê¸°ë³¸ íƒìƒ‰ ì°½ì—ì„œÂ **ë¦¬ì†ŒìŠ¤**ë¥¼ ì„ íƒ
4. **ë¦¬ì†ŒìŠ¤**ì—ì„œ ìƒˆ ë©”ì„œë“œë¥¼ ìƒì„±í•˜ê±°ë‚˜ ê¸°ì¡´ ë©”ì„œë“œë¥¼ ì„ íƒ
5. **ë©”ì„œë“œ ìš”ì²­(Method Request)**ì„ ì„ íƒ
6. **Settings(ì„¤ì •)**Â ì„¹ì…˜ì—ì„œÂ **API Key Required(API í‚¤ê°€ í•„ìš”í•¨)**ì—Â trueë¥¼ ì„ íƒ
7. í™•ì¸ í‘œì‹œ ì•„ì´ì½˜ì„ ì„ íƒí•˜ì—¬ ì„¤ì •ì„ ì €ì¥
8. **APIë¥¼ ë°°í¬í•˜ê±°ë‚˜ ë‹¤ì‹œ ë°°í¬í•˜ì—¬ ìš”êµ¬ ì‚¬í•­ì„ ì ìš©**

![https://blog.kakaocdn.net/dn/blV7qz/btseGDvRH9p/flSTkXrBmnLXZqwwfarL10/img.png](https://blog.kakaocdn.net/dn/blV7qz/btseGDvRH9p/flSTkXrBmnLXZqwwfarL10/img.png)

2. API í‚¤ ìƒì„±

1. AWS Management Consoleì— ë¡œê·¸ì¸í•˜ê³ Â [https://console.aws.amazon.com/apigateway/](https://console.aws.amazon.com/apigateway/)ì—ì„œ API Gateway ì½˜ì†”ì„ ì„ íƒ
2. REST APIë¥¼ ì„ íƒ
3. API Gateway ê¸°ë³¸ íƒìƒ‰ ì°½ì—ì„œÂ **API í‚¤**ë¥¼ ì„ íƒ
4. **ì‘ì—…**Â ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì—ì„œÂ **API í‚¤ ìƒì„±(Create API Key)**ì„ ì„ íƒ
5. **API í‚¤ ìƒì„±(Create API Key)**ì—ì„œ ë‹¤ìŒì„ ìˆ˜í–‰ (í˜¹ì€ ê°€ì ¸ì˜¤ê¸°ë¥¼ í†µí•´ CSVë¡œ ì„¤ì • ê°€ëŠ¥)
    1. **ì´ë¦„**Â ì…ë ¥ í•„ë“œì— API í‚¤ ì´ë¦„(ì˜ˆ:Â MyFirstKey)ì„ ì…ë ¥
    2. **ìë™ ìƒì„±**ì„ ì„ íƒí•˜ì—¬ API Gatewayê°€ í‚¤ ê°’ì„ ìƒì„±í•˜ë„ë¡ í•˜ê±°ë‚˜,Â **ì‚¬ìš©ì ì§€ì •**ì„ ì„ íƒí•˜ì—¬ ìˆ˜ë™ìœ¼ë¡œ í‚¤ë¥¼ ì…ë ¥
    3. **ì €ì¥**ì„ ì„ íƒ
6. í•„ìš”ì— ë”°ë¼ ì•ì˜ ë‹¨ê³„ë¥¼ ë°˜ë³µí•˜ì—¬ API í‚¤ë¥¼ ì¶”ê°€ ìƒì„±

![https://blog.kakaocdn.net/dn/6Jwhi/btsezMGZKqw/DTmpgQBOX4lrRkGXEKAJvK/img.png](https://blog.kakaocdn.net/dn/6Jwhi/btsezMGZKqw/DTmpgQBOX4lrRkGXEKAJvK/img.png)

3. ì‚¬ìš©ëŸ‰ ê³„íš ìƒì„±

1. Amazon API Gateway ê¸°ë³¸ íƒìƒ‰ ì°½ì—ì„œÂ **ì‚¬ìš©ëŸ‰ ê³„íš**ì„ ì„ íƒí•œ ë‹¤ìŒÂ **ìƒì„±**ì„ ì„ íƒ
2. **ì‚¬ìš©ëŸ‰ ê³„íš ìƒì„±(Create Usage Plan) ì„ íƒ**
    1. **ì´ë¦„**ì— ê³„íšì˜ ì´ë¦„ì„ ì…ë ¥(ì˜ˆ:Â Plan_A).
    2. **ì„¤ëª…**ì— ê³„íšì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥
    3. **Enable throttling(ì¡°ì ˆ í™œì„±í™”)**ë¥¼ ì„ íƒí•˜ê³ Â **Rate(ì†ë„)**(ì˜ˆ:Â 100) ë°Â **Burst(ë²„ìŠ¤íŠ¸)**(ì˜ˆ:Â 200)ë¥¼ ì„¤ì •
    4. **í• ë‹¹ëŸ‰ í™œì„±í™”(Enable quota)**ë¥¼ ì„ íƒí•˜ê³ , ì„ íƒí•œ ì‹œê°„ ê°„ê²©(ì˜ˆ:Â **ì›”**)ì— ëŒ€í•œ ê°’(ì˜ˆ:Â 5000)ì„ ì§€ì •í•˜ë„ë¡ ì„¤ì •
    5. [**Next**]ë¥¼ ì„ íƒ
    
    ![https://blog.kakaocdn.net/dn/mzvBG/btsex2EqR5A/RB8KmoqzT9F2nPE2DB2WFk/img.png](https://blog.kakaocdn.net/dn/mzvBG/btsex2EqR5A/RB8KmoqzT9F2nPE2DB2WFk/img.png)
    
3. ê³„íšì— ë‹¨ê³„ë¥¼ ì¶”ê°€í•˜ë ¤ë©´Â **ì—°ê²°ëœ API ë‹¨ê³„(Associated API Stages)**Â ì°½ì—ì„œ ë‹¤ìŒì„ ìˆ˜í–‰
    1. **API ë‹¨ê³„ ì¶”ê°€(Add API Stage)**ë¥¼ ì„ íƒ
    2. **API**Â ë“œë¡­ë‹¤ìš´ ëª©ë¡ì—ì„œ ì‚¬ìš©í•  APIë¥¼ ì„ íƒ
    3. **ë‹¨ê³„**Â ë“œë¡­ë‹¤ìš´ ëª©ë¡ì—ì„œ Stageë¥¼ ì„ íƒ
    4. í™•ì¸ í‘œì‹œ ì•„ì´ì½˜ì„ ì„ íƒí•˜ì—¬ ì €ì¥
    
    ![https://blog.kakaocdn.net/dn/R4eLk/btseATTfv3A/sVuqXLIddsONaEXj8yEZw0/img.png](https://blog.kakaocdn.net/dn/R4eLk/btseATTfv3A/sVuqXLIddsONaEXj8yEZw0/img.png)
    
4. ë©”ì„œë“œ ì¡°ì ˆì„ êµ¬ì„±í•˜ë ¤ë©´ ë‹¤ìŒì„ ìˆ˜í–‰
    1. **ë©”ì„œë“œ ì¡°ì ˆ êµ¬ì„±(Configure Method Throttling)**ì„ ì„ íƒ
    2. **ë¦¬ì†ŒìŠ¤/ë©”ì„œë“œ ì¶”ê°€(Add Resource/Method)**ë¥¼ ì„ íƒ
    3. **ë¦¬ì†ŒìŠ¤**Â ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì—ì„œ ë¦¬ì†ŒìŠ¤ë¥¼ ì„ íƒ
    4. **ë°©ë²•**Â ë“œë¡­ë‹¤ìš´ ë©”ë‰´ì—ì„œ ë°©ë²•ì„ ì„ íƒ
    5. **(Rate(requests per second)(ì†ë„(ì´ˆë‹¹ ìš”ì²­ ì†ë„))**(ì˜ˆ:Â 100)ì™€Â **Burst(ë²„ìŠ¤íŠ¸)**(ì˜ˆ:Â 200)ë¥¼ ì„¤ì •
    6. í™•ì¸ í‘œì‹œ ì•„ì´ì½˜ì„ ì„ íƒí•˜ì—¬ ì €ì¥
    7. **ë‹«ê¸°**ë¥¼ ì„ íƒ
5. ê³„íšì— í‚¤ë¥¼ ì¶”ê°€í•˜ë ¤ë©´Â **API í‚¤(API Keys)**Â íƒ­ì—ì„œ ë‹¤ìŒì„ ìˆ˜í–‰
    1. ê¸°ì¡´ í‚¤ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´Â **ì‚¬ìš©ëŸ‰ ê³„íšì— API í‚¤ ì¶”ê°€(Add API Key to Usage Plan)**ë¥¼ ì„ íƒ
    2. **ì´ë¦„**ì— ì¶”ê°€í•  API í‚¤ ì´ë¦„(ìƒì„±í•œ API í‚¤ ì´ë¦„)ì„ ì…ë ¥
    3. í™•ì¸ í‘œì‹œ ì•„ì´ì½˜ì„ ì„ íƒí•˜ì—¬ ì €ì¥
    4. í•„ìš”í•  ê²½ìš°, ì•ì˜ ë‹¨ê³„ë¥¼ ë°˜ë³µí•´ ì´ ì‚¬ìš©ëŸ‰ ê³„íšì— ë‹¤ë¥¸ ê¸°ì¡´ API í‚¤ë¥¼ ì¶”ê°€
    
    ![https://blog.kakaocdn.net/dn/bOl6Hw/btsezLnQTFQ/fzRUKDn9PAThqexC4Zt2kK/img.png](https://blog.kakaocdn.net/dn/bOl6Hw/btsezLnQTFQ/fzRUKDn9PAThqexC4Zt2kK/img.png)
    
6. ì‚¬ìš©ëŸ‰ ê³„íš ìƒì„±ì„ ë§ˆì¹˜ë ¤ë©´Â **ì™„ë£Œ**ë¥¼ ì„ íƒ
7. ì‚¬ìš©ëŸ‰ ê³„íšì— API ë‹¨ê³„ë¥¼ ë” ì¶”ê°€í•˜ë ¤ë©´Â **API ë‹¨ê³„ ì¶”ê°€(Add API Stage)**ë¥¼ ì„ íƒí•´ ì•ì˜ ë‹¨ê³„ë¥¼ ë°˜ë³µ

![https://blog.kakaocdn.net/dn/MDqxH/btseTgmNo6X/pPGkHdDCSk7GClKlbqgC00/img.png](https://blog.kakaocdn.net/dn/MDqxH/btseTgmNo6X/pPGkHdDCSk7GClKlbqgC00/img.png)

# Step 3 :Â [ê¶Œí•œ ë¶€ì—¬ìë¥¼ ì´ìš©í•œ ì¸ì¦](https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/apigateway-use-lambda-authorizer.html)Â ë¶€ì—¬í•˜ê¸°

0. ê¶Œí•œ ë¶€ì—¬ì ì¢…ë¥˜

- í† í° ê¸°ë°˜Â Lambda ê¶Œí•œ ë¶€ì—¬ì(TOKENÂ ê¶Œí•œ ë¶€ì—¬ìë¼ê³ ë„ í•¨): ë³´ìœ ì í† í°(JSON Web Token(JWT) ë˜ëŠ” OAuth í† í°)ì— ìˆëŠ” í˜¸ì¶œìì˜ ìê²© ì¦ëª…ì„ ë°›ìŒ
- ìš”ì²­ íŒŒë¼ë¯¸í„° ê¸°ë°˜Â Lambda ê¶Œí•œ ë¶€ì—¬ì(REQUESTÂ ê¶Œí•œ ë¶€ì—¬ìë¼ê³ ë„ í•¨) : í—¤ë”, ì¿¼ë¦¬ ë¬¸ìì—´ íŒŒë¼ë¯¸í„°,Â [stageVariables](https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/api-gateway-mapping-template-reference.html#stagevariables-template-reference)Â ë°Â [$context](https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/api-gateway-mapping-template-reference.html#context-variable-reference)Â ë³€ìˆ˜ì˜ ì¡°í•©ìœ¼ë¡œ í˜¸ì¶œìì˜ ìê²© ì¦ëª…ì„ ìˆ˜ì‹ 

Lambda ê¶Œí•œ ë¶€ì—¬ì ì¸ì¦ ì›Œí¬í”Œë¡œìš°

![https://blog.kakaocdn.net/dn/8wO0X/btseBdKPBEp/FC2prEmlvqLRMSATHAheZK/img.png](https://blog.kakaocdn.net/dn/8wO0X/btseBdKPBEp/FC2prEmlvqLRMSATHAheZK/img.png)

1. í† í° ê¸°ë°˜ì˜ Lambda ê¶Œí•œ ë¶€ì—¬ì í•¨ìˆ˜ ìƒì„± (Node.js)

1. Lambda ì½˜ì†”ì—ì„œÂ **í•¨ìˆ˜ ìƒì„±(Create function)**ì„ ì„ íƒ
2. **ìƒˆë¡œ ì‘ì„±**ì„ ì„ íƒ
3. í•¨ìˆ˜ ì´ë¦„ì„ ì…ë ¥
4. **í•¨ìˆ˜ ìƒì„±**ì„ ì„ íƒ
5. ë‹¤ìŒ ì½”ë“œë¥¼ ë³µì‚¬í•˜ì—¬ ì½”ë“œ í¸ì§‘ê¸°ì— ë¶™ì—¬ë„£ê¸°
    - `// A simple token-based authorizer example to demonstrate how to use an authorization token
    // to allow or deny a request. In this example, the caller named 'user' is allowed to invoke
    // a request if the client-supplied token value is 'allow'. The caller is not allowed to invoke
    // the request if the token value is 'deny'. If the token value is 'unauthorized' or an empty
    // string, the authorizer function returns an HTTP 401 status code. For any other token value,
    // the authorizer returns an HTTP 500 status code.
    // Note that token values are case-sensitive.
    export const handler = function(event, context, callback) { var token = event.authorizationToken; switch (token) { case 'allow': callback(null, generatePolicy('user', 'Allow', event.methodArn)); break; case 'deny': callback(null, generatePolicy('user', 'Deny', event.methodArn)); break; case 'unauthorized': callback("Unauthorized"); // Return a 401 Unauthorized response break; default: callback("Error: Invalid token"); // Return a 500 Invalid token response }
    };
    // Help function to generate an IAM policy
    var generatePolicy = function(principalId, effect, resource) { var authResponse = {}; authResponse.principalId = principalId; if (effect && resource) { var policyDocument = {}; policyDocument.Version = '2012-10-17'; policyDocument.Statement = []; var statementOne = {}; statementOne.Action = 'execute-api:Invoke'; statementOne.Effect = effect; statementOne.Resource = resource; policyDocument.Statement[0] = statementOne; authResponse.policyDocument = policyDocument; } // Optional output with custom properties of the String, Number or Boolean type. authResponse.context = { "stringKey": "stringval", "numberKey": 123, "booleanKey": true }; return authResponse;
    }`
6. **ë°°í¬**ë¥¼ ì„ íƒ

2. ê¶Œí•œ ë¶€ì—¬ì ìƒì„± í›„ í…ŒìŠ¤íŠ¸

- Lambda ê¶Œí•œ ë¶€ì—¬ì í•¨ìˆ˜ëŠ” IAM ì •ì±…ì„ ë°˜í™˜í•˜ëŠ” ê²ƒ ì™¸ì— í˜¸ì¶œìì˜ ë³´ì•ˆ ì£¼ì²´ IDë„ ë°˜í™˜í•´ì•¼ í•˜ë©° ì„ íƒì ìœ¼ë¡œ í†µí•© ë°±ì—”ë“œë¡œ ì „ë‹¬ë  ìˆ˜ ìˆëŠ” ì¶”ê°€ ì •ë³´ë¥¼ í¬í•¨í•˜ëŠ” context ê°ì²´ë¥¼ ë°˜í™˜ ê°€ëŠ¥ (ìì„¸í•œ ë‚´ìš©ì€ Amazon API Gateway Lambda ê¶Œí•œ ë¶€ì—¬ìì˜ ì¶œë ¥ ì„¹ì…˜ì„ ì°¸ì¡°)

![https://blog.kakaocdn.net/dn/pyLH2/btseRq4FJym/VJyJx7YZVEKTuYkiHfLBM1/img.png](https://blog.kakaocdn.net/dn/pyLH2/btseRq4FJym/VJyJx7YZVEKTuYkiHfLBM1/img.png)

![https://blog.kakaocdn.net/dn/1MCy4/btseK76zc1g/zs4sXxtsfyhJYEXTkRztkK/img.png](https://blog.kakaocdn.net/dn/1MCy4/btseK76zc1g/zs4sXxtsfyhJYEXTkRztkK/img.png)

![https://blog.kakaocdn.net/dn/sQn2F/btseOitd3VT/3RaN218ejnwMpJjau5HtDK/img.png](https://blog.kakaocdn.net/dn/sQn2F/btseOitd3VT/3RaN218ejnwMpJjau5HtDK/img.png)

1. API Gateway ì½˜ì†”ì—ì„œ ê¶Œí•œ ë¶€ì—¬ìë¥¼ ìƒì„±í•  APIë¥¼ ì„ íƒ í›„Â **ê¶Œí•œ ë¶€ì—¬ì**ë¥¼ ì„ íƒ
2. **ìƒˆë¡œìš´ ê¶Œí•œ ë¶€ì—¬ì ìƒì„±**ì„ ì„ íƒ
3. ê¶Œí•œ ë¶€ì—¬ì ì´ë¦„ì„ ì…ë ¥
4. **ìœ í˜•**ì— ëŒ€í•´ Lambdaë¥¼ ì„ íƒ
5. **Lambda í•¨ìˆ˜**ì—ì„œ Lambda ê¶Œí•œ ë¶€ì—¬ì í•¨ìˆ˜ë¥¼ ë§Œë“  ë¦¬ì „ì„ ì„ íƒí•˜ê³  ë“œë¡­ë‹¤ìš´ ëª©ë¡ì—ì„œ í•¨ìˆ˜ ì´ë¦„ì„ ì„ íƒ
6. **Lambda í˜¸ì¶œ ì—­í• ì€ ê³µë€**
7. **Lambda ì´ë²¤íŠ¸ í˜ì´ë¡œë“œ**ì˜ ê²½ìš°Â **í† í°**ì„ ì„ íƒ
8. **í† í° ì†ŒìŠ¤**ì—Â authorizationTokenì„ ì…ë ¥
9. **ìƒì„±**ì„ ì„ íƒí•œ ë‹¤ìŒÂ **Grant & Create(ê¶Œí•œ ë¶€ì—¬ ë° ìƒì„±)**ë¥¼ ì„ íƒ
10. **í…ŒìŠ¤íŠ¸**ë¥¼ ì„ íƒ
11. **ì¸ì¦ í† í°**Â ê°’ì—Â allow (deny, unauthorized ë“±)ë¥¼ ì…ë ¥
12. **í…ŒìŠ¤íŠ¸**ë¥¼ ì„ íƒ
    - í† í° ê°’ì´Â 'allow'ì¸ ê²½ìš° ê¶Œí•œ ë¶€ì—¬ì í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ëŠ”Â 200 OKÂ HTTP ì‘ë‹µ ë° IAM ì •ì±…ì„ ë°˜í™˜í•˜ê³  ë©”ì„œë“œ ìš”ì²­ì´ ì„±ê³µ
    - í† í° ê°’ì´Â 'deny'ì¸ ê²½ìš° ê¶Œí•œ ë¶€ì—¬ì í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ëŠ”Â 200 OKÂ HTTP ì‘ë‹µ ë° DenyÂ IAM ì •ì±…ì„ ë°˜í™˜í•˜ê³  ë©”ì„œë“œ ìš”ì²­ì´ ì‹¤íŒ¨ (í…ŒìŠ¤íŠ¸ í™˜ê²½ ë°–ì—ì„œëŠ” ê¶Œí•œ ë¶€ì—¬ì í•¨ìˆ˜ê°€ 403 Forbidden HTTP ì‘ë‹µì„ ë°˜í™˜í•˜ê³  ë©”ì„œë“œ ìš”ì²­ì´ ì‹¤íŒ¨)
    - í† í° ê°’ì´Â 'unauthorized'ì´ë‚˜ ë¹ˆ ë¬¸ìì—´ì¸ ê²½ìš° ê¶Œí•œ ë¶€ì—¬ì í•¨ìˆ˜ í…ŒìŠ¤íŠ¸ëŠ”Â 401 UnauthorizedÂ HTTP ì‘ë‹µì„ ë°˜í™˜í•˜ê³  ë©”ì„œë“œ í˜¸ì¶œì´ ì‹¤íŒ¨
    - ê·¸ ì™¸ í† í°ì˜ ê²½ìš° í´ë¼ì´ì–¸íŠ¸ëŠ”Â 500 Invalid tokenÂ ì‘ë‹µì„ ìˆ˜ì‹ 

```
# allow ì‹œ
Execution log for request de167097-b2da-4178-a3d6-11a2e4f98c3a
Tue May 09 11:50:02 UTC 2023 : Starting authorizer: uw0rhn for request: de167097-b2da-4178-a3d6-11a2e4f98c3a
Tue May 09 11:50:02 UTC 2023 : Incoming identity: ***ow
Tue May 09 11:50:02 UTC 2023 : Endpoint request URI: https://lambda.ap-northeast-2.amazonaws.com/2015-03-31/functions/arn:aws:lambda:ap-northeast-2::function:lambda-to-dynamodb-LambdaPutDynamoDB-RkTVQTa8WYqP/invocations
Tue May 09 11:50:02 UTC 2023 : Endpoint request headers: {X-Amz-Date=20230509T115002Z, x-amzn-apigateway-api-id=asjdflkajdslf, Accept=application/json, User-Agent=AmazonAPIGateway_asjdflkajdslf, Host=lambda.ap-northeast-2.amazonaws.com, X-Amz-Content-Sha256=1dc508af52d0d547a376b1a9c211cb6589558158d1e5fe1f75aacdf9d4ac4f23, X-Amzn-Trace-Id=Root=1-645a336a-5430185fd94306b520ad2690, x-amzn-lambda-integration-tag=de167097-b2da-4178-a3d6-11a2e4f98c3a, Authorization=**************************************************************************************************************************************************************************************************************************************************************************************************************************************************19aeef, X-Amz-Source-Arn=arn:aws:execute-api:ap-northeast-2::asjdflkajdslf/authorizers/uw0rhn, X-Amz-Security-Token=IQoJb3JpZ2luX2VjEFsaDmFwLW5vcnRoZWFzdC0yIkcwRQIhAJIGpx+Lj6xbRkgpqC0+okM9edS+C+snaVRYjWWZzUEgAiA07klItGV8/OqPtwtEkEEZKTZPAHuz7h5soBkrPz [TRUNCATED]
Tue May 09 11:50:02 UTC 2023 : Endpoint request body after transformations: {"type":"TOKEN","methodArn":"arn:aws:execute-api:ap-northeast-2::asjdflkajdslf/ESTestInvoke-stage/GET/","authorizationToken":"allow"}
Tue May 09 11:50:02 UTC 2023 : Sending request to https://lambda.ap-northeast-2.amazonaws.com/2015-03-31/functions/arn:aws:lambda:ap-northeast-2::function:lambda-to-dynamodb-LambdaPutDynamoDB-RkTVQTa8WYqP/invocations
Tue May 09 11:50:02 UTC 2023 : Authorizer result body before parsing: {"principalId":"user","policyDocument":{"Version":"2012-10-17","Statement":[{"Action":"execute-api:Invoke","Effect":"Allow","Resource":"arn:aws:execute-api:ap-northeast-2::asjdflkajdslf/ESTestInvoke-stage/GET/"}]},"context":{"stringKey":"stringval","numberKey":123,"booleanKey":true}}
Tue May 09 11:50:02 UTC 2023 : Using valid authorizer policy for principal: **er

# deny ì‹œ
Execution log for request bacfead0-29d5-4f4d-85e3-c04c8d027006
Tue May 09 11:49:23 UTC 2023 : Starting authorizer: uw0rhn for request: bacfead0-29d5-4f4d-85e3-c04c8d027006
Tue May 09 11:49:23 UTC 2023 : Incoming identity: **ny
Tue May 09 11:49:23 UTC 2023 : Endpoint request URI: https://lambda.ap-northeast-2.amazonaws.com/2015-03-31/functions/arn:aws:lambda:ap-northeast-2::function:lambda-to-dynamodb-LambdaPutDynamoDB-RkTVQTa8WYqP/invocations
Tue May 09 11:49:23 UTC 2023 : Endpoint request headers: {X-Amz-Date=20230509T114923Z, x-amzn-apigateway-api-id=asjdflkajdslf, Accept=application/json, User-Agent=AmazonAPIGateway_asjdflkajdslf, Host=lambda.ap-northeast-2.amazonaws.com, X-Amz-Content-Sha256=34ad40e000856138173e0db769795082d0f0b7495d901623b27e9d785ae96a53, X-Amzn-Trace-Id=Root=1-645a3343-e8a424804e6c72da185f4ec0, x-amzn-lambda-integration-tag=bacfead0-29d5-4f4d-85e3-c04c8d027006, Authorization=**************************************************************************************************************************************************************************************************************************************************************************************************************************************************a108f6, X-Amz-Source-Arn=arn:aws:execute-api:ap-northeast-2::asjdflkajdslf/authorizers/uw0rhn, X-Amz-Security-Token=IQoJb3JpZ2luX2VjEFsaDmFwLW5vcnRoZWFzdC0yIkcwRQIgEbDxNMMagNRNxC5WpHgx0Qo37YsOsSIAX2BkOY+Qj7oCIQCLyML+3y9hOj7cVItv7npmjXZU3lRn0I2oH9yVWh [TRUNCATED]
Tue May 09 11:49:23 UTC 2023 : Endpoint request body after transformations: {"type":"TOKEN","methodArn":"arn:aws:execute-api:ap-northeast-2::asjdflkajdslf/ESTestInvoke-stage/GET/","authorizationToken":"deny"}
Tue May 09 11:49:23 UTC 2023 : Sending request to https://lambda.ap-northeast-2.amazonaws.com/2015-03-31/functions/arn:aws:lambda:ap-northeast-2::function:lambda-to-dynamodb-LambdaPutDynamoDB-RkTVQTa8WYqP/invocations
Tue May 09 11:49:23 UTC 2023 : Authorizer result body before parsing: {"principalId":"user","policyDocument":{"Version":"2012-10-17","Statement":[{"Action":"execute-api:Invoke","Effect":"Deny","Resource":"arn:aws:execute-api:ap-northeast-2::asjdflkajdslf/ESTestInvoke-stage/GET/"}]},"context":{"stringKey":"stringval","numberKey":123,"booleanKey":true}}
Tue May 09 11:49:23 UTC 2023 : Using valid authorizer policy for principal: **er
```

3. Lambda ê¶Œí•œ ë¶€ì—¬ìë¥¼ ì‚¬ìš©í•˜ë„ë¡ API ë©”ì„œë“œë¥¼ êµ¬ì„±

![https://blog.kakaocdn.net/dn/FVB1j/btseSVC5Awt/bTgyLOleTB5nHo1D0Z9Px1/img.png](https://blog.kakaocdn.net/dn/FVB1j/btseSVC5Awt/bTgyLOleTB5nHo1D0Z9Px1/img.png)

1. ìƒˆ ë©”ì„œë“œë¥¼ ìƒì„±í•˜ê±°ë‚˜ ê¸°ì¡´ ë©”ì„œë“œë¥¼ ì„ íƒ í•„ìš”í•˜ë‹¤ë©´ ìƒˆ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±
2. **Method Execution(ë©”ì„œë“œ ì‹¤í–‰)**ì—ì„œÂ **Method Request(ë©”ì„œë“œ ìš”ì²­)**Â ë§í¬ë¥¼ ì„ íƒ
3. **ì„¤ì •**ì—ì„œÂ **ê¶Œí•œ ë¶€ì—¬**Â ë“œë¡­ë‹¤ìš´ ëª©ë¡ì„ í™•ì¥í•˜ì—¬ ë°©ê¸ˆ ìƒì„±í•œ Lambda ê¶Œí•œ ë¶€ì—¬ìë¥¼ ì„ íƒí•œ í›„, í™•ì¸ í‘œì‹œ ì•„ì´ì½˜ì„ ì„ íƒí•˜ì—¬ ì €ì¥
4. ì‚¬ìš©ì ì§€ì • ê¶Œí•œ ë¶€ì—¬ í† í°ì„ ë°±ì—”ë“œë¡œë„ ì „ë‹¬í•˜ë ¤ëŠ” ê²½ìš°, ì„ íƒì ìœ¼ë¡œÂ **Method Request(ë©”ì„œë“œ ìš”ì²­)**Â í˜ì´ì§€ì˜Â **Add header(í—¤ë” ì¶”ê°€)**ë¥¼ ì„ íƒí•˜ê³ Â **ì´ë¦„**ì— APIì— ëŒ€í•œ Lambda ê¶Œí•œ ë¶€ì—¬ìë¥¼ ìƒì„±í•  ë•Œ ì§€ì •í•œÂ **í† í° ì†ŒìŠ¤**Â ì´ë¦„ê³¼ ì¼ì¹˜í•˜ëŠ” í—¤ë” ì´ë¦„ì„ ì…ë ¥ í›„ í™•ì¸ ì•„ì´ì½˜ ì„ íƒí•´ ì €ì¥Â (REQUESTÂ ê¶Œí•œ ë¶€ì—¬ìì—ëŠ” ì´ ë‹¨ê³„ê°€ ì ìš©ë˜ì§€ ì•ŠìŒ)
5. **Deploy API(API ë°°í¬)**ë¥¼ ì„ íƒí•˜ì—¬ ë‹¨ê³„ì— APIë¥¼ ë°°í¬í•˜ê³ Â **Invoke URL(URL í˜¸ì¶œ)**Â ê°’ì„ API í˜¸ì¶œ ì‹œ ì‚¬ìš© (ë‹¨ê³„ ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ”Â REQUESTÂ ê¶Œí•œ ë¶€ì—¬ìì˜ ê²½ìš°Â **Stage Editor(ë‹¨ê³„ í¸ì§‘ê¸°)**ê°€ ì—´ë ¤ ìˆëŠ” ë™ì•ˆ í•„ìš”í•œ ë‹¨ê³„ ë³€ìˆ˜ë¥¼ ì§€ì •í•˜ê³  ê°’ì„ ì§€ì •í•´ì•¼í•¨)

4. ê¶Œí•œ ë¶€ì—¬ìì™€ API Keyê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸

case 1 : API Keyë§Œ Headerì— ì „ì†¡í–ˆì„ ê²½ìš°

![https://blog.kakaocdn.net/dn/AMUkR/btseQeRzzka/OsD3osmF2DUV2gK81adpf1/img.png](https://blog.kakaocdn.net/dn/AMUkR/btseQeRzzka/OsD3osmF2DUV2gK81adpf1/img.png)

case 2 : API Keyì™€ í—ˆìš©í•˜ëŠ” ê¶Œí•œ ë¶€ì—¬ìë¥¼ ì „ì†¡í–ˆì„ ê²½ìš°

![https://blog.kakaocdn.net/dn/0celb/btseP5UGDkq/t87Po6pkrq7JqEczK8DsS0/img.png](https://blog.kakaocdn.net/dn/0celb/btseP5UGDkq/t87Po6pkrq7JqEczK8DsS0/img.png)

case 3 : API Keyì™€ ê±°ë¶€í•˜ëŠ” ê¶Œí•œ ë¶€ì—¬ìë¥¼ ì „ì†¡í–ˆì„ ê²½ìš°

![https://blog.kakaocdn.net/dn/c1hrwQ/btsePUsfAz6/KYBTAkgYqbBRqx5JN0CmXK/img.png](https://blog.kakaocdn.net/dn/c1hrwQ/btsePUsfAz6/KYBTAkgYqbBRqx5JN0CmXK/img.png)

# #TROUBLE SHOOTING LOG

# ğŸ“ ë¬¸ì œ 1 : ê¶Œí•œê´€ë¦¬ì testì‹œ Execution failed due to an authorizer error, AuthorizerFailureException ì—ëŸ¬

- ì›ì¸ : js, mjs ì°¨ì´
- í•´ê²° ë°©ì•ˆ : ì¶”í›„ ì‘ì„±

# 

# #REFERENCES

[https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/how-to-method-settings.html?icmpid=docs_apigateway_console](https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/how-to-method-settings.html?icmpid=docs_apigateway_console)



[https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/rest-api-data-transformations.html](https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/rest-api-data-transformations.html)



[https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/how-to-method-settings-console.html](https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/how-to-method-settings-console.html)



[https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/how-to-set-up-method-using-console.html](https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/how-to-set-up-method-using-console.html)



[https://docs.aws.amazon.com/ko_kr/amazondynamodb/latest/developerguide/Streams.Lambda.Tutorial2.html](https://docs.aws.amazon.com/ko_kr/amazondynamodb/latest/developerguide/Streams.Lambda.Tutorial2.html)



[https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/api-gateway-setup-api-key-with-console.html](https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/api-gateway-setup-api-key-with-console.html)



[https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/api-gateway-lambda-authorizer-output.html](https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/api-gateway-lambda-authorizer-output.html)



[https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/apigateway-use-lambda-authorizer.html](https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/apigateway-use-lambda-authorizer.html)



[https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/apigateway-use-lambda-authorizer.html](https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/apigateway-use-lambda-authorizer.html)



[https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/apigateway-use-lambda-authorizer.html#api-gateway-lambda-authorizer-lambda-function-create](https://docs.aws.amazon.com/ko_kr/apigateway/latest/developerguide/apigateway-use-lambda-authorizer.html#api-gateway-lambda-authorizer-lambda-function-create)



[https://github.com/awslabs/aws-apigateway-lambda-authorizer-blueprints](https://github.com/awslabs/aws-apigateway-lambda-authorizer-blueprints)

[https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/lambda-intro-execution-role.html](https://docs.aws.amazon.com/ko_kr/lambda/latest/dg/lambda-intro-execution-role.html)

