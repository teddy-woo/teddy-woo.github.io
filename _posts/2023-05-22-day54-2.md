---
date: 2023-05-18 00:00:00
layout: post
title: DevOps&#91;Day54-2&#93; / [ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜]
subtitle: '04. ì¿ ë²„ë„¤í‹°ìŠ¤ ë„¤íŠ¸ì›Œí¬'
description: 04. ì¿ ë²„ë„¤í‹°ìŠ¤ ë„¤íŠ¸ì›Œí¬
image: /k8s.png
optimized_image: /k8s.png
category: ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
tags:
  - k8s
  - ì¿ ë²„ë„¤í‹°ìŠ¤
  - ì»¨í…Œì´ë„ˆ
  - ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
  - Kubernetes
  - minikube
  - kubrctl
  - liveness prob
  - Ingress
  - ì¸ê·¸ë ˆìŠ¤
  - helm
  - DevOps BootCamp
author: teddy-woo

---

# **# í•™ìŠµ ëª©í‘œ**

- ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ì´ ë¬´ì—‡ì¸ì§€ ì´í•´í•  ìˆ˜ ìˆë‹¤.
- ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ê°„ë‹¨í•œ ì‘ë™ ì›ë¦¬ë¥¼ ì´í•´í•  ìˆ˜ ìˆë‹¤.
- ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ ëª…ì„¸ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
    - íŒŒë“œ ëª…ì„¸ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
    - ë””í”Œë¡œì´ë¨¼íŠ¸ ëª…ì„¸ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
    - ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•´ íŒŒë“œë¥¼ ë…¸ì¶œí•  ìˆ˜ ìˆë‹¤.
- kubectl ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¦¬ì†ŒìŠ¤ì˜ ìƒì„±, ì‚­ì œ, ì¡°íšŒë¥¼ í•  ìˆ˜ ìˆë‹¤.
- kubectl ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¡¤ì•„ì›ƒ ê´€ë ¨ ì‘ì—…ì„ ì§„í–‰í•  ìˆ˜ ìˆë‹¤.
    - ë¡¤ë§ ë°°í¬ í˜„í™©ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
    - ìƒˆë¡œìš´ ë²„ì „ì— ë¬¸ì œê°€ ë°œìƒí–ˆì„ ë•Œ ë¡¤ë°±í•  ìˆ˜ ìˆë‹¤.

(ì´í•˜ advanced)

- liveness probeë¥¼ ì´ìš©í•˜ì—¬ íŒŒë“œì˜ health checkë¥¼ í•  ìˆ˜ ìˆë‹¤.
- ì¿ ë²„ë„¤í‹°ìŠ¤ê°€ Statefulí•œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë‹¤ë£¨ëŠ” ë°©ë²•ì„ ì´í•´í•  ìˆ˜ ìˆë‹¤.
- ì¿ ë²„ë„¤í‹°ìŠ¤ì—ì„œ ì¸ê·¸ë ˆìŠ¤ë¥¼ ì´ìš©í•œ HTTP ê¸°ë°˜ ë¼ìš°íŒ…ì„ ì ìš©í•  ìˆ˜ ìˆë‹¤.
- helm íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

---ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜

# **# í•™ìŠµ ë‚´ìš©**

# 1. ì¸ê·¸ë ˆìŠ¤

# ì¸ê·¸ë ˆìŠ¤

- í´ëŸ¬ìŠ¤í„° ë‚´ì˜ ì„œë¹„ìŠ¤ì— ëŒ€í•œ ì™¸ë¶€ ì ‘ê·¼ì„ ê´€ë¦¬í•˜ëŠ” API ê²Œì´íŠ¸ì›¨ì´
- ì¼ë°˜ì ìœ¼ë¡œ HTTPë¥¼ ê´€ë¦¬í•˜ë©° ë¡œë“œ ë°¸ëŸ°ì„œ, SSL Termination (í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œëŠ” HTTPë¡œë§Œ í†µì‹ í•˜ê²Œ í•˜ëŠ” ì „í™˜ ê³¼ì •), ê°€ìƒ í˜¸ìŠ¤íŒ…ì„ ì œê³µ

ì¸ê·¸ë ˆìŠ¤ ìƒì„± ë° ì ìš©

1) ê¸°ì¡´ ì„œë¹„ìŠ¤ íƒ€ì…ì„ LoadBalancerë¡œ ClusterIPë¡œ ë°”ê¾¸ê³  ì ìš©. ClusterIPëŠ” í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë©° ë” ì´ìƒ EXTERNAL-IPëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ

2) ì¸ê·¸ë ˆìŠ¤ ë¦¬ì†ŒìŠ¤ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ë§Œë“¤ê³  ì ìš©

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: nginx
  namespace: default
spec:
  rules:
  - host: localhost
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: nginx
            port:
              number: 80
```

3) ì¸ê·¸ë ˆìŠ¤ëŠ” kubectl get allë¡œëŠ” ì¡°íšŒê°€ ì•ˆë˜ë¯€ë¡œ kubectl get all, ingresses ì‚¬ìš©í•´ ìƒì„±ëœ ì¸ê·¸ë ˆìŠ¤ ì¡°íšŒ

```
$ kubectl apply -f application.yaml
deployment.apps/nginx-deployment created

$ kubectl apply -f service.yaml
service/nginx-service created

$ kubectl apply -f ingress.yaml
ingress.networking.k8s.io/nginx-ingress created

$ kubectl get all,ingresses
# pods ì •ë³´
NAME                                    READY   STATUS    RESTARTS        AGE
pod/nginx-deployment-85996f8dbd-tkmg7   1/1     Running   1 (3m10s ago)   122m

# service ì •ë³´
NAME                    TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
service/kubernetes      ClusterIP   10.96.0.1       <none>        443/TCP   123m
service/nginx-service   ClusterIP   10.98.165.212   <none>        80/TCP    7m36s # loadbalancerê°€ ì•„ë‹˜

# deployment ì •ë³´
NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/nginx-deployment   1/1     1            1           122m

# replicaset ì •ë³´
NAME                                          DESIRED   CURRENT   READY   AGE
replicaset.apps/nginx-deployment-85996f8dbd   1         1         1       122m

# ingress ì •ë³´
NAME                                      CLASS   HOSTS       ADDRESS        PORTS   AGE
ingress.networking.k8s.io/nginx-ingress   nginx   localhost   192.168.49.2   80      8m42s
```

4) ì¸ê·¸ë ˆìŠ¤ëŠ”Â ì¸ê·¸ë ˆìŠ¤Â ë¦¬ì†ŒìŠ¤(ì •ì±…Â ê·¸Â ìì²´)Â ì™¸ì—ë„Â ì¸ê·¸ë ˆìŠ¤Â ì»¨íŠ¸ë¡¤ëŸ¬(ì •ì±…ì„Â ì‹¤í–‰ì‹œí‚¤ëŠ”Â ë„êµ¬)ê°€Â ë°˜ë“œì‹œÂ í•„ìš”í•¨

â€» minikubeë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°, ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì• ë“œì˜¨ìœ¼ë¡œ ë³„ë„ì˜ ì„¤ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.Â [ê³µì‹ ë¬¸ì„œ](https://kubernetes.io/ko/docs/tasks/access-application-cluster/ingress-minikube/)ë¥¼ ì°¸ê³ í•´ì„œ nginx ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í™œì„±í™”

```
# NGINX ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í™œì„±í™”
$ minikube addons enable ingress
ğŸ’¡  ingress is an addon maintained by Kubernetes. For any concerns contact minikube on GitHub.
You can view the list of minikube maintainers at: https://github.com/kubernetes/minikube/blob/master/OWNERS
ğŸ’¡  After the addon is enabled, please run "minikube tunnel" and your ingress resources would be available at "127.0.0.1"
    â–ª Using image registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20230312-helm-chart-4.5.2-28-g66a760794
    â–ª Using image registry.k8s.io/ingress-nginx/controller:v1.7.0
    â–ª Using image registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20230312-helm-chart-4.5.2-28-g66a760794
ğŸ”  Verifying ingress addon...
ğŸŒŸ  'ingress' ì• ë“œì˜¨ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤

# NGINX ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
$ kubectl get pods -n ingress-nginx
NAME                                        READY   STATUS      RESTARTS   AGE
ingress-nginx-admission-create-qtm5q        0/1     Completed   0          58s
ingress-nginx-admission-patch-2mvkb         0/1     Completed   1          58s
ingress-nginx-controller-6cc5ccb977-7wwvr   1/1     Running     0          58s
```

5) í„°ë„ì„ ì—´ê³ , http://localhostì— ì ‘ì†

```
$ minikube tunnel
```

![https://blog.kakaocdn.net/dn/bkwPhH/btsg1bYG4aV/wMECmrP0BSq6gNOSPBOyVk/img.png](https://blog.kakaocdn.net/dn/bkwPhH/btsg1bYG4aV/wMECmrP0BSq6gNOSPBOyVk/img.png)

# ì¸ê·¸ë ˆìŠ¤ì˜ í•„ìš”ì„±

- ì„œë¹„ìŠ¤ë¥¼ í™œìš©í•´ ì™¸ë¶€ IP ì£¼ì†Œë¥¼ í• ë‹¹í•´ ì£¼ëŠ”Â **ì„œë¹„ìŠ¤**ì™€Â **ë¡œë“œ ë°¸ëŸ°ì„œ**ë¥¼ ìƒì„±í•˜ê³  ì»¨í…Œì´ë„ˆë¡œ íŠ¸ë˜í”½ì„ ë³´ë‚´ëŠ” ë°©ë²•ì„ ì´ìš©í•´ ì• í”Œë¦¬ì¼€ì´ì…˜(íŒŒë“œ)ì„ ì™¸ë¶€ì— ë…¸ì¶œì‹œí‚¬ ìˆ˜ ìˆëŠ”ë° ì™œ ì¸ê·¸ë ˆìŠ¤ë¥¼ ë³„ë„ë¡œ ì‚¬ìš©í•´ì•¼í• ê¹Œ?
- **ì¸ê·¸ë ˆìŠ¤ ë¦¬ì†ŒìŠ¤ëŠ” ë¡œë“œ ë°¸ëŸ°ì‹±ê³¼ ë”ë¶ˆì–´ í˜¸ìŠ¤íŠ¸ ê¸°ë°˜ ë¼ìš°íŒ…ì„ ì§€ì›í•˜ê¸° ë•Œë¬¸**
- ì•ì„œ ë§Œë“  ì„œë¹„ìŠ¤ì˜ ê²½ìš° LoadBalancerì—ì„œ ClusterIPë¡œ ë°”ê¿¨ê¸° ë•Œë¬¸ì— ì¸ê·¸ë ˆìŠ¤ê°€ ë¡œë“œ ë°¸ëŸ°ì„œì˜ ì—­í• ì„ ìˆ˜í–‰í•´ì•¼ í•¨
- ì•„ì£¼ ë‹¨ìˆœí•œ ì• í”Œë¦¬ì¼€ì´ì…˜ë„ ì„œë¹„ìŠ¤ëŠ” ë‘ ê°œ ì´ìƒì˜ HTTP ìš”ì²­ì„ ê°€ì§€ëŠ” ê²ƒì´ ë³´í†µ (ë³´í†µ ê°ê° Web Serverì™€ WASë¡œ ëŒ€í‘œ)
- ì´ëŸ¬í•œ ì„œë¹„ìŠ¤ì˜ ì ‘ê·¼ì„ ë³„ë„ì˜ í¬íŠ¸ë¡œ êµ¬ë¶„í•˜ì—¬ ì ‘ì†í•˜ê²Œ í•  ìˆ˜ë„ ìˆì§€ë§Œ, í•˜ë‚˜ì˜ í˜¸ìŠ¤íŠ¸ ìƒì—ì„œ ë¼ìš°íŒ…ìœ¼ë¡œ êµ¬ë¶„í•˜ë©´ ë³´ë‹¤ ìœ ì—°í•œ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŒ
- Web ServerëŠ” /ë¡œ, WASëŠ” /apië¡œ ë¼ìš°íŒ… ê°€ëŠ¥
- YAML íŒŒì¼ì—ì„œ spec.rules.hostì— ë³„ë„ì˜ í˜¸ìŠ¤íŠ¸ë¥¼ ì§€ì •í•˜ì—¬ Web ServerëŠ”Â [www.mydomain.click,](http://www.mydomain.click%2C/)Â WASëŠ” api.mydomain.clickìœ¼ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥

ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ë€?

- í”íˆ ì˜ ì•Œê³  ìˆëŠ” nginxì™€ ê°™ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë°”ë¡œ ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ (nginxê°€ í•˜ëŠ” ì¼ì´ ê²°êµ­ í˜¸ìŠ¤íŠ¸ ê¸°ë°˜ ë¼ìš°íŒ…ê³¼ ë¡œë“œ ë°¸ëŸ°ì‹±ì´ë¯€ë¡œ)
- ì¦‰ ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ê·œì¹™ì„ ì´í–‰í•˜ëŠ” ì‹¤ì§ˆì ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…Œì´ë„ˆ