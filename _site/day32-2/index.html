<!DOCTYPE html>
<html lang="ko" class="no-js">
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    

    
    

    
    

    
    

    <title>DevOps&#91;Day32-2&#93; / [Docker] | Teddy-woo's DevOps Challenge!</title>
    <meta name="description" content="도커 Docker Compose">
    
        <meta name="keywords" content="docker, Dockerfile, Compose, DevOps BootCamp">
    

    <!-- Social: Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="DevOps&#91;Day32-2&#93; / [Docker] | Teddy-woo's DevOps Challenge!">
    <meta name="twitter:description" content="도커 Docker Compose">

    
        <meta property="twitter:image" content="http://localhost:4000/docker.png">
    
    
    

    <!-- Social: Facebook / Open Graph -->
    <meta property="og:url" content="http://localhost:4000/day32-2/">
    <meta property="og:title" content="DevOps&#91;Day32-2&#93; / [Docker] | Teddy-woo's DevOps Challenge!">
    <meta property="og:image" content="/docker.png">
    <meta property="og:description" content="도커 Docker Compose">
    <meta property="og:site_name" content="도현's Blog | 도현's 데브옵스 도전기!">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/assets/img/icons/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/img/icons/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/icons/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/icons/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/icons/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/img/icons/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/img/icons/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/icons/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/img/icons/apple-touch-icon-152x152.png" />

    <!-- Windows 8 Tile Icons -->
    <meta name="application-name" content="Teddy-woo's DevOps Challenge!">
    <meta name="msapplication-TileColor" content="#141414">
    <meta name="msapplication-square70x70logo" content="smalltile.png" />
    <meta name="msapplication-square150x150logo" content="mediumtile.png" />
    <meta name="msapplication-wide310x150logo" content="widetile.png" />
    <meta name="msapplication-square310x310logo" content="largetile.png" />
    
    <!-- Android Lolipop Theme Color -->
    <meta name="theme-color" content="#141414">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/assets/css/styles.css">
    <link rel="canonical" href="http://localhost:4000/day32-2/">
    <link rel="alternate" type="application/rss+xml" title="도현's Blog | 도현's 데브옵스 도전기!" href="http://localhost:4000/feed.xml" />

    <!-- Include extra styles -->
    

    <!-- JavaScript enabled/disabled -->
    <script>
        document.querySelector('html').classList.remove('no-js');
    </script>
</head>

    <body class="has-push-menu">
        





        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" display="none" version="1.1"><defs><symbol id="icon-menu" viewBox="0 0 1024 1024"><path class="path1" d="M128 213.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 725.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5zM128 469.333h768q17.667 0 30.167 12.5t12.5 30.167-12.5 30.167-30.167 12.5h-768q-17.667 0-30.167-12.5t-12.5-30.167 12.5-30.167 30.167-12.5z"/></symbol><symbol id="icon-search" viewBox="0 0 951 1024"><path class="path1" d="M658.286 475.429q0-105.714-75.143-180.857t-180.857-75.143-180.857 75.143-75.143 180.857 75.143 180.857 180.857 75.143 180.857-75.143 75.143-180.857zM950.857 950.857q0 29.714-21.714 51.429t-51.429 21.714q-30.857 0-51.429-21.714l-196-195.429q-102.286 70.857-228 70.857-81.714 0-156.286-31.714t-128.571-85.714-85.714-128.571-31.714-156.286 31.714-156.286 85.714-128.571 128.571-85.714 156.286-31.714 156.286 31.714 128.571 85.714 85.714 128.571 31.714 156.286q0 125.714-70.857 228l196 196q21.143 21.143 21.143 51.429z"/></symbol><symbol id="icon-close" viewBox="0 0 1000 1000"><path d="M969.8,870.3c27,27.7,27,71.8,0,99.1C955.7,983,937.9,990,920,990c-17.9,0-35.7-7-49.7-20.7L500,599L129.6,969.4C115.6,983,97.8,990,79.9,990s-35.7-7-49.7-20.7c-27-27.3-27-71.4,0-99.1L400.9,500L30.3,129.3c-27-27.3-27-71.4,0-99.1c27.3-27,71.8-27,99.4,0L500,400.9L870.4,30.2c27.7-27,71.8-27,99.4,0c27,27.7,27,71.8,0,99.1L599.1,500L969.8,870.3z"/></symbol><symbol id="icon-twitter" viewBox="0 0 951 1024"><path class="path1" d="M925.714 233.143q-38.286 56-92.571 95.429 0.571 8 0.571 24 0 74.286-21.714 148.286t-66 142-105.429 120.286-147.429 83.429-184.571 31.143q-154.857 0-283.429-82.857 20 2.286 44.571 2.286 128.571 0 229.143-78.857-60-1.143-107.429-36.857t-65.143-91.143q18.857 2.857 34.857 2.857 24.571 0 48.571-6.286-64-13.143-106-63.714t-42-117.429v-2.286q38.857 21.714 83.429 23.429-37.714-25.143-60-65.714t-22.286-88q0-50.286 25.143-93.143 69.143 85.143 168.286 136.286t212.286 56.857q-4.571-21.714-4.571-42.286 0-76.571 54-130.571t130.571-54q80 0 134.857 58.286 62.286-12 117.143-44.571-21.143 65.714-81.143 101.714 53.143-5.714 106.286-28.571z"/></symbol><symbol id="icon-facebook" viewBox="0 0 585 1024"><path class="path1" d="M548 6.857v150.857h-89.714q-49.143 0-66.286 20.571t-17.143 61.714v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571q0-106.286 59.429-164.857t158.286-58.571q84 0 130.286 6.857z"/></symbol><symbol id="icon-clock" viewBox="0 0 1000 1000"><path d="M500,10C229.8,10,10,229.8,10,500c0,270.2,219.8,490,490,490c270.2,0,490-219.8,490-490C990,229.8,770.2,10,500,10z M500,910.2c-226.2,0-410.2-184-410.2-410.2c0-226.2,184-410.2,410.2-410.2c226.2,0,410.2,184,410.2,410.2C910.2,726.1,726.2,910.2,500,910.2z M753.1,374c8.2,11.9,5.2,28.1-6.6,36.3L509.9,573.7c-4.4,3.1-9.6,4.6-14.8,4.6c-4.1,0-8.3-1-12.1-3c-8.6-4.5-14-13.4-14-23.1V202.5c0-14.4,11.7-26.1,26.1-26.1c14.4,0,26.1,11.7,26.1,26.1v300l195.6-135.1C728.7,359.2,744.9,362.1,753.1,374z"/></symbol><symbol id="icon-calendar" viewBox="0 0 1000 1000"><path d="M920,500v420H80V500H920 M990,430H10v490c0,38.7,31.3,70,70,70h840c38.7,0,70-31.3,70-70V430L990,430z"/><path d="M850,80v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80H360v105c0,57.9-47.2,105-105,105c-58,0-105-47.1-105-105V80C72.8,80,10,142.7,10,220v140h980V220C990,142.7,927.2,80,850,80z"/><path d="M255,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C290,25.8,274.3,10,255,10z"/><path d="M745,10c-19.3,0-35,15.8-35,35v140c0,19.2,15.7,35,35,35c19.3,0,35-15.8,35-35V45C780,25.8,764.3,10,745,10z"/></symbol><symbol id="icon-github" viewBox="0 0 12 14"><path d="M6 1q1.633 0 3.012 0.805t2.184 2.184 0.805 3.012q0 1.961-1.145 3.527t-2.957 2.168q-0.211 0.039-0.312-0.055t-0.102-0.234q0-0.023 0.004-0.598t0.004-1.051q0-0.758-0.406-1.109 0.445-0.047 0.801-0.141t0.734-0.305 0.633-0.52 0.414-0.82 0.16-1.176q0-0.93-0.617-1.609 0.289-0.711-0.062-1.594-0.219-0.070-0.633 0.086t-0.719 0.344l-0.297 0.187q-0.727-0.203-1.5-0.203t-1.5 0.203q-0.125-0.086-0.332-0.211t-0.652-0.301-0.664-0.105q-0.352 0.883-0.062 1.594-0.617 0.68-0.617 1.609 0 0.664 0.16 1.172t0.41 0.82 0.629 0.523 0.734 0.305 0.801 0.141q-0.305 0.281-0.383 0.805-0.164 0.078-0.352 0.117t-0.445 0.039-0.512-0.168-0.434-0.488q-0.148-0.25-0.379-0.406t-0.387-0.187l-0.156-0.023q-0.164 0-0.227 0.035t-0.039 0.090 0.070 0.109 0.102 0.094l0.055 0.039q0.172 0.078 0.34 0.297t0.246 0.398l0.078 0.18q0.102 0.297 0.344 0.48t0.523 0.234 0.543 0.055 0.434-0.027l0.18-0.031q0 0.297 0.004 0.691t0.004 0.426q0 0.141-0.102 0.234t-0.312 0.055q-1.812-0.602-2.957-2.168t-1.145-3.527q0-1.633 0.805-3.012t2.184-2.184 3.012-0.805zM2.273 9.617q0.023-0.055-0.055-0.094-0.078-0.023-0.102 0.016-0.023 0.055 0.055 0.094 0.070 0.047 0.102-0.016zM2.516 9.883q0.055-0.039-0.016-0.125-0.078-0.070-0.125-0.023-0.055 0.039 0.016 0.125 0.078 0.078 0.125 0.023zM2.75 10.234q0.070-0.055 0-0.148-0.062-0.102-0.133-0.047-0.070 0.039 0 0.141t0.133 0.055zM3.078 10.562q0.062-0.062-0.031-0.148-0.094-0.094-0.156-0.023-0.070 0.062 0.031 0.148 0.094 0.094 0.156 0.023zM3.523 10.758q0.023-0.086-0.102-0.125-0.117-0.031-0.148 0.055t0.102 0.117q0.117 0.047 0.148-0.047zM4.016 10.797q0-0.102-0.133-0.086-0.125 0-0.125 0.086 0 0.102 0.133 0.086 0.125 0 0.125-0.086zM4.469 10.719q-0.016-0.086-0.141-0.070-0.125 0.023-0.109 0.117t0.141 0.062 0.109-0.109z"></path></symbol><symbol id="icon-medium" viewBox="0 0 1000 1000"><path d="M336.5,240.2v641.5c0,9.1-2.3,16.9-6.8,23.2s-11.2,9.6-20,9.6c-6.2,0-12.2-1.5-18-4.4L37.3,782.7c-7.7-3.6-14.1-9.8-19.4-18.3S10,747.4,10,739V115.5c0-7.3,1.8-13.5,5.5-18.6c3.6-5.1,8.9-7.7,15.9-7.7c5.1,0,13.1,2.7,24.1,8.2l279.5,140C335.9,238.6,336.5,239.5,336.5,240.2L336.5,240.2z M371.5,295.5l292,473.6l-292-145.5V295.5z M990,305.3v576.4c0,9.1-2.6,16.5-7.7,22.1c-5.1,5.7-12,8.5-20.8,8.5s-17.3-2.4-25.7-7.1L694.7,784.9L990,305.3z M988.4,239.7c0,1.1-46.8,77.6-140.3,229.4C754.6,621,699.8,709.8,683.8,735.7L470.5,389l177.2-288.2c6.2-10.2,15.7-15.3,28.4-15.3c5.1,0,9.8,1.1,14.2,3.3l295.9,147.7C987.6,237.1,988.4,238.2,988.4,239.7L988.4,239.7z"/></symbol><symbol id="icon-instagram" viewBox="0 0 489.84 489.84"><path d="M249.62,50.46c65.4,0,73.14.25,99,1.43C372.47,53,385.44,57,394.07,60.32a75.88,75.88,0,0,1,28.16,18.32,75.88,75.88,0,0,1,18.32,28.16c3.35,8.63,7.34,21.6,8.43,45.48,1.18,25.83,1.43,33.57,1.43,99s-0.25,73.14-1.43,99c-1.09,23.88-5.08,36.85-8.43,45.48a81.11,81.11,0,0,1-46.48,46.48c-8.63,3.35-21.6,7.34-45.48,8.43-25.82,1.18-33.57,1.43-99,1.43s-73.15-.25-99-1.43c-23.88-1.09-36.85-5.08-45.48-8.43A75.88,75.88,0,0,1,77,423.86,75.88,75.88,0,0,1,58.69,395.7c-3.35-8.63-7.34-21.6-8.43-45.48-1.18-25.83-1.43-33.57-1.43-99s0.25-73.14,1.43-99c1.09-23.88,5.08-36.85,8.43-45.48A75.88,75.88,0,0,1,77,78.64a75.88,75.88,0,0,1,28.16-18.32c8.63-3.35,21.6-7.34,45.48-8.43,25.83-1.18,33.57-1.43,99-1.43m0-44.13c-66.52,0-74.86.28-101,1.47s-43.87,5.33-59.45,11.38A120.06,120.06,0,0,0,45.81,47.44,120.06,120.06,0,0,0,17.56,90.82C11.5,106.4,7.36,124.2,6.17,150.27s-1.47,34.46-1.47,101,0.28,74.86,1.47,101,5.33,43.87,11.38,59.45a120.06,120.06,0,0,0,28.25,43.38,120.06,120.06,0,0,0,43.38,28.25c15.58,6.05,33.38,10.19,59.45,11.38s34.46,1.47,101,1.47,74.86-.28,101-1.47,43.87-5.33,59.45-11.38a125.24,125.24,0,0,0,71.63-71.63c6.05-15.58,10.19-33.38,11.38-59.45s1.47-34.46,1.47-101-0.28-74.86-1.47-101-5.33-43.87-11.38-59.45a120.06,120.06,0,0,0-28.25-43.38,120.06,120.06,0,0,0-43.38-28.25C394.47,13.13,376.67,9,350.6,7.8s-34.46-1.47-101-1.47h0Z" transform="translate(-4.7 -6.33)" /><path d="M249.62,125.48A125.77,125.77,0,1,0,375.39,251.25,125.77,125.77,0,0,0,249.62,125.48Zm0,207.41a81.64,81.64,0,1,1,81.64-81.64A81.64,81.64,0,0,1,249.62,332.89Z" transform="translate(-4.7 -6.33)"/><circle cx="375.66" cy="114.18" r="29.39" /></symbol><symbol id="icon-linkedin" viewBox="0 0 12 14"><path d="M2.727 4.883v7.742h-2.578v-7.742h2.578zM2.891 2.492q0.008 0.57-0.395 0.953t-1.059 0.383h-0.016q-0.641 0-1.031-0.383t-0.391-0.953q0-0.578 0.402-0.957t1.051-0.379 1.039 0.379 0.398 0.957zM12 8.187v4.437h-2.57v-4.141q0-0.82-0.316-1.285t-0.988-0.465q-0.492 0-0.824 0.27t-0.496 0.668q-0.086 0.234-0.086 0.633v4.32h-2.57q0.016-3.117 0.016-5.055t-0.008-2.313l-0.008-0.375h2.57v1.125h-0.016q0.156-0.25 0.32-0.438t0.441-0.406 0.68-0.34 0.895-0.121q1.336 0 2.148 0.887t0.813 2.598z"></path></symbol><symbol id="icon-heart" viewBox="0 0 34 30"><path d="M17,29.7 L16.4,29.2 C3.5,18.7 0,15 0,9 C0,4 4,0 9,0 C13.1,0 15.4,2.3 17,4.1 C18.6,2.3 20.9,0 25,0 C30,0 34,4 34,9 C34,15 30.5,18.7 17.6,29.2 L17,29.7 Z M9,2 C5.1,2 2,5.1 2,9 C2,14.1 5.2,17.5 17,27.1 C28.8,17.5 32,14.1 32,9 C32,5.1 28.9,2 25,2 C21.5,2 19.6,4.1 18.1,5.8 L17,7.1 L15.9,5.8 C14.4,4.1 12.5,2 9,2 Z" id="Shape"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 25.452 25.452"><path d="M4.471,24.929v-2.004l12.409-9.788c0.122-0.101,0.195-0.251,0.195-0.411c0-0.156-0.073-0.31-0.195-0.409L4.471,2.526V0.522c0-0.2,0.115-0.384,0.293-0.469c0.18-0.087,0.396-0.066,0.552,0.061l15.47,12.202c0.123,0.1,0.195,0.253,0.195,0.409c0,0.16-0.072,0.311-0.195,0.411L5.316,25.34c-0.155,0.125-0.372,0.147-0.552,0.061C4.586,25.315,4.471,25.13,4.471,24.929z"/></symbol><symbol id="icon-star" viewBox="0 0 48 48"><path fill="currentColor" d="M44,24c0,11.045-8.955,20-20,20S4,35.045,4,24S12.955,4,24,4S44,12.955,44,24z"/><path fill="#ffffff" d="M24,11l3.898,7.898l8.703,1.301l-6.301,6.102l1.5,8.699L24,30.898L16.199,35l1.5-8.699l-6.301-6.102  l8.703-1.301L24,11z"/></symbol><symbol id="icon-read" viewBox="0 0 32 32"><path fill="currentColor" d="M29,4H3C1.343,4,0,5.343,0,7v18c0,1.657,1.343,3,3,3h10c0,0.552,0.448,1,1,1h4c0.552,0,1-0.448,1-1h10  c1.657,0,3-1.343,3-3V7C32,5.343,30.657,4,29,4z M29,5v20H18.708c-0.618,0-1.236,0.146-1.789,0.422l-0.419,0.21V5H29z M15.5,5  v20.632l-0.419-0.21C14.528,25.146,13.91,25,13.292,25H3V5H15.5z M31,25c0,1.103-0.897,2-2,2H18v1h-4v-1H3c-1.103,0-2-0.897-2-2V7  c0-0.737,0.405-1.375,1-1.722V25c0,0.552,0.448,1,1,1h10.292c0.466,0,0.925,0.108,1.342,0.317l0.919,0.46  c0.141,0.07,0.294,0.106,0.447,0.106c0.153,0,0.306-0.035,0.447-0.106l0.919-0.46C17.783,26.108,18.242,26,18.708,26H29  c0.552,0,1-0.448,1-1V5.278C30.595,5.625,31,6.263,31,7V25z M6,12.5C6,12.224,6.224,12,6.5,12h5c0.276,0,0.5,0.224,0.5,0.5  S11.776,13,11.5,13h-5C6.224,13,6,12.776,6,12.5z M6,14.5C6,14.224,6.224,14,6.5,14h5c0.276,0,0.5,0.224,0.5,0.5S11.776,15,11.5,15  h-5C6.224,15,6,14.776,6,14.5z M6,16.5C6,16.224,6.224,16,6.5,16h5c0.276,0,0.5,0.224,0.5,0.5S11.776,17,11.5,17h-5  C6.224,17,6,16.776,6,16.5z M20,12.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,13,25.5,13h-5  C20.224,13,20,12.776,20,12.5z M20,14.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,15,25.5,15h-5  C20.224,15,20,14.776,20,14.5z M20,16.5c0-0.276,0.224-0.5,0.5-0.5h5c0.276,0,0.5,0.224,0.5,0.5S25.776,17,25.5,17h-5  C20.224,17,20,16.776,20,16.5z"></path></symbol></defs></svg>

        <header class="bar-header">
    <a id="menu" role="button">
        <svg id="open" class="icon-menu"><use xlink:href="#icon-menu"></use></svg>
    </a>
    <h1 class="logo">
        <a href="/">
            
                Teddy-woo's DevOps Challenge! <span class="version">v3.1.2</span>
            
        </a>
    </h1>
    <a id="search" class="dosearch" role="button">
        <svg class="icon-search"><use xlink:href="#icon-search"></use></svg>
    </a>
</header>

<div id="mask" class="overlay"></div>

<aside class="sidebar" id="sidebar">
  <nav id="navigation">
    <h2 style="position:sticky; top:0; background-color:#fff;">Menu</h2>
    <div style="height: 900px; overflow: auto;">
      <ul>
  
    
      <li>
        <a href="http://localhost:4000/">Home</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/개발%20프로세스와%20DEVOPS%20업무/">1. 개발 프로세스와 DEVOPS 업무</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/리눅스%20운영체제">2. 리눅스 운영체제</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/웹서비스%20개발%20기초/">3. 웹서비스 개발 기초</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/GIT과%20버전%20관리%20시스템/">4. GIT과 버전 관리 시스템</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/(사전준비)%20개발%20환경%20구축/">5. (사전준비) 개발 환경 구축</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/HTTP/">6. HTTP</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/WAS와%20WEB%20SERVER/">7. WAS와 WEB SERVER</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/데이터베이스/">8. 데이터베이스</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/프로젝트%20회고/">9. 프로젝트 회고</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/네트워크%20기초/">10. 네트워크 기초</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/웹%20서버%20프로그램/">11. 웹 서버 프로그램</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/YAML과%20JSON/">12. YAML과 JSON</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/트러블%20슈팅/">13. 트러블 슈팅</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/아마존%20웹%20서비스(AWS)/">14. 아마존 웹 서비스(AWS)</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/Docker/">15. DOCKER(도커)</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/지속적%20통합/">16. 지속적 통합</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/배포%20자동화/">17. 배포 자동화</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/feed.xml/">feed</a>
      </li>
    
  
</ul>

    </div>
  </nav>
</aside>
<div class="search-wrapper">
    <div class="search-form">
        <input type="text" class="search-field" placeholder="Search">
        <svg class="icon-remove-sign"><use xlink:href="#icon-close"></use></svg>
        <ul class="search-results search-list"></ul>
    </div>
</div>



        <section class="post two-columns">
            <article role="article" class="post-content">
                <p class="post-info">
                    
                        <svg class="icon-calendar" id="date"><use xlink:href="#icon-calendar"></use></svg>
                        <time class="date" datetime="2023-04-19T09:00:00+09:00">
                            


April 19, 2023

                        </time>
                    
                    <svg id="clock" class="icon-clock"><use xlink:href="#icon-clock"></use></svg>
                    <span>12 min to read</span>
                </p>
                <h1 class="post-title">DevOps&#91;Day32-2&#93; / [Docker]</h1>
                <p class="post-subtitle">도커 Docker Compose</p>

                
                    <img src="/docker.png" alt="Featured image" class="post-cover">
                

                <!-- Pagination links -->



                <!-- Add your table of contents here -->


                <h1 id="도커-컴포즈란">도커 컴포즈란?</h1>
<p>도커 컴포즈는 단일 서버에서 여러개의 컨테이너를 하나의 서비스로 정의해 컨테이너의 묶음으로 관리할 수 있는 작업 환경을 제공하는 관리 도구입니다.</p>

<p><img src="https://velog.velcdn.com/images/dnehgus6975/post/6c4b965e-76a4-4237-b2a0-a11cffd33400/image.png" alt="" /></p>

<h3 id="도커-컴포즈를-사용하는-이유">도커 컴포즈를 사용하는 이유</h3>
<p>여러 개의 컨테이너가 하나의 어플리케이션으로 동작할 때 도커 컴포즈를 사용하지 않는다면, 이를 테스트하려면 각 컨테이너를 하나씩 생성해야 합니다. 예를 들면, 웹 어플리케이션을 테스트하려면 웹 서버 컨테이너, 데이터베이스 컨테이너 두 개의 컨테이너를 각각 생성해야 합니다.</p>

<p>즉, 아래와 같이 두개의 run 명령어를 입력해야합니다.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">--name</span> wordpress_db <span class="nt">-d</span> mysql:8

<span class="nv">$ </span>docker run <span class="nt">-d</span> <span class="nt">-p</span> 8080:80 <span class="se">\</span>
<span class="nt">--link</span> wordpress_db:mysql <span class="nt">--name</span> seunghwan_wordpress <span class="se">\</span>
wordpress:latest
</code></pre></div></div>
<p>위의 예제를 실행하면 wordpress와 mysql 컨테이너를 생성합니다. 이처럼 여러 개의 컨테이너로 구성된 어플리케이션을 구축하기 위해 run 명령어를 여러 번 사용할 수 있지만 각 컨테이너가 제대로 동작하는지 확인하는 테스트 단계에서는 이런식으로 일일히 여러개의 컨테이너를 실행하기는 번거롭습니다. 매번 run 명령어에 옵션을 설정해 CLI로 컨테이너를 생성하기보다는 여러 개의 컨테이너를 하나의 서비스로 정리해 컨테이너 묶음으로 관리할 수 있다면 좀 더 편리할 것입니다. 이를 위해 도커 컴포즈(Docker Compose)는 컨테이너를 이용한 서비스의 개발과 CI를 위해 여러 개의 컨테이너를 하나의 프로젝트로서 다룰 수 있는 작업 환경을 제공합니다.</p>

<p>도커 컴포즈는 여러 개의 컨테이너의 옵션과 환경을 정의한 파일을 읽어 컨테이너를 순차적으로 생성하는 방식으로 동작합니다. 도커 컴포즈의 설정 파일은 도커 엔진의 run 명령어의 옵션을 그대로 사용할 수 있으며, 각 컨테이너의 의존성, 네트워크, 볼륨 등을 함께 정의할 수 있습니다. 또한 스웜모드의 서비스와 유사하게 설정 파일에 정의된 서비스의 컨테이너 수를 유동적으로 조절할 수 있으며 컨테이너의 서비스 디스커버리도 자동으로 이뤄집니다. 그래서 컨테이너의 수가 많아지고 정의해야 할 옵션이 많아지고 정의해야 할 옵션이 많아진다면 도커 컴포즈를 사용하는 것이 좋습니다.</p>

<h2 id="docker-run-명령어와-docker-compose-사용-비교">docker run 명령어와 docker compose 사용 비교</h2>
<h3 id="docker-run-명령어로-컨테이너-생성">docker run 명령어로 컨테이너 생성</h3>
<p>아래의 명령어는 CLI에서 docker run 명령어를 이용해서 mysql을 만들고, wordpress를 생성해서 mysql을 연결하는 명령어입니다.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-d</span> <span class="nt">--name</span> wordpress_db <span class="se">\</span>
	<span class="nt">--network</span> seunghwan_network <span class="se">\</span>
	<span class="nt">-p</span> 3306:3306 <span class="se">\</span>
	<span class="nt">-e</span> <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>seosh817 <span class="se">\</span>
	<span class="nt">-e</span> <span class="nv">MYSQL_DATABASE</span><span class="o">=</span>seosh817 <span class="se">\</span>
	<span class="nt">-e</span> <span class="nv">MYSQL_USER</span><span class="o">=</span>seosh817 <span class="se">\</span>
	<span class="nt">-e</span> <span class="nv">MYSQL_PASSWORD</span><span class="o">=</span>seosh817 <span class="se">\</span>
	<span class="nt">-v</span> mysql:/var/lib/mysql <span class="se">\</span>
	<span class="nt">--restart</span> unless-stopped <span class="se">\</span>
	mysql:8
    
<span class="nv">$ </span>docker run <span class="nt">-d</span> <span class="nt">--name</span> seunghwan_wordpress <span class="se">\</span>
	<span class="nt">--network</span> seunghwan_network <span class="se">\</span>
	<span class="nt">-p</span> 8080:80 <span class="se">\</span>
	<span class="nt">--link</span> wordpress_db:mysql <span class="se">\</span>
	<span class="nt">-e</span> <span class="nv">WORDPRESS_DB_HOST</span><span class="o">=</span>db:3306 <span class="se">\</span>
	<span class="nt">-e</span> <span class="nv">WORDPRESS_DB_USER</span><span class="o">=</span>seosh817 <span class="se">\</span>
	<span class="nt">-e</span> <span class="nv">WORDPRESS_DB_PASSWORD</span><span class="o">=</span>seosh817 <span class="se">\</span>
	<span class="nt">-e</span> <span class="nv">WORDPRESS_DB_NAME</span><span class="o">=</span>seosh817 <span class="se">\</span>
	<span class="nt">--restart</span> unless-stopped <span class="se">\</span>
	wordpress:latest
</code></pre></div></div>
<h3 id="docker-composeyml로-도커-컴포즈-프로젝트-실행">docker-compose.yml로 도커 컴포즈 프로젝트 실행</h3>
<p>위에서 docker run 명령어로 컨테이너를 실행하던 것을 docker compose.yml로 변경해 보겠습니다.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.9'</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mysql:8</span>
    <span class="na">volumes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">db:/var/lib/mysql</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">environment</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">MYSQL_ROOT_PASSWORD=seosh817</span>
    <span class="pi">-</span> <span class="s">MYSQL_DATABASE=seosh817</span>
    <span class="pi">-</span> <span class="s">MYSQL_USER=seosh817</span>
    <span class="pi">-</span> <span class="s">MYSQL_PASSWORD=seosh817</span>
    <span class="na">networks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">wordpress</span>

  <span class="na">wordpress</span><span class="pi">:</span>
    <span class="na">depends_on</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">db</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">wordpress:latest</span>
    <span class="na">ports</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s2">"</span><span class="s">8000:80"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">unless-stopped</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">WORDPRESS_DB_HOST</span><span class="pi">:</span> <span class="s">db:3306</span>
      <span class="na">WORDPRESS_DB_USER</span><span class="pi">:</span> <span class="s">seosh817</span>
      <span class="na">WORDPRESS_DB_PASSWORD</span><span class="pi">:</span> <span class="s">seosh817</span>
      <span class="na">WORDPRESS_DB_NAME</span><span class="pi">:</span> <span class="s">seosh817</span>
    <span class="na">networks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">wordpress</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">db</span><span class="pi">:</span> <span class="pi">{}</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">wordpress</span><span class="pi">:</span> <span class="pi">{}</span>
</code></pre></div></div>
<blockquote>
  <p>yaml 파일에서 들여쓰기를 할 때 탭(Tab)은 도커 컴포즈가 인식하지 못하므로 2개의 공백(Space)을 사용해서 하위 항목을 구분해야 합니다.</p>
</blockquote>

<p>도커 컴포즈를 사용하려면 컨테이너 설정을 저장해 놓은 yaml 파일이 필요합니다. 그러므로 기존에 사용하던 run 명령어를 yaml 파일로 변환하는 것이 도커 컴포즈 사용법의 대부분입니다.</p>

<p>위의 docker-compose.yml 파일을 보면 서비스로 db, wordpress 두개가 존재합니다.</p>

<p>그리고 볼륨으로 db, 네트워크로 wordpress를 생성하고 서비스에서 해당 볼륨과 네트워크를 사용하는 구조로 되어있습니다.</p>

<p>어떠한 설정도 하지 않으면 도커 컴포즈는 현재 디렉토리의 docker-compose.yml 파일을 읽어 로컬의 도커 엔진에게 컨테이너 생성을 요청합니다. docker compse up 명령어로 도커 컴포즈 프로젝트를 실행할 수 있습니다. docker-compose.yml을 읽어 컨테이너를 생성해 보겠습니다.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker-compose up -d
</code></pre></div></div>
<h2 id="도커-컴포즈-yaml-파일의-옵션">도커 컴포즈 yaml 파일의 옵션</h2>
<p>도커 컴포즈 yaml 파일의 옵션들을 알아보겠습니다.</p>

<h3 id="버전-정의">버전 정의</h3>
<p><strong>version</strong> -&gt; yaml 파일 포맷의 버전을 나타냅니다. 도커 컴포즈 버전마다 사용하는 yaml 포맷 버전이 있으므로 도커 컴포즈 버전은 도커 엔진 버전에 의존성이 있으므로 가능하면 최신 버전을 사용하는 것이 좋습니다.</p>

<h3 id="서비스-정의">서비스 정의</h3>
<p>서비스는 도커 컴포즈로 생성할 컨테이너 옵션을 정의합니다. 이 항목에 쓰인 각 서비스는 컨테이너로 구현되며, 하나의 프로젝트로ㅠ서 도커 컴포즈에 의해 관리됩니다. 서비스의 이름은 services의 하위 항목으로 정의하고, 컨테이너의 옵션은 서비스 이름의 하위 항목에 정의합니다.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">container_1</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">...</span>
  <span class="na">container_2</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">...</span>
</code></pre></div></div>
<p><strong>services</strong> -&gt; 생성될 컨테이너들을 묶어놓은 단위입니다. 서비스 항목 아래에는 각 컨테이너에 적용될 생성 옵션을 지정합니다.</p>

<p><strong>image</strong> -&gt; 서비스의 컨테이너를 생성할 때 쓰일 이미지의 이름을 설정합니다. 이미지 이름 포맷은 docker run과 같으며 만일 이미지가 도커에 존재하지 않으면 도커 허브에서 자동으로 내려받습니다.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">container_1</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">seosh817/composetest:mysql</span>
</code></pre></div></div>
<p><strong>links</strong> -&gt; docker run 명령어의 –link와 같으며, 다른 서비스에 서비스명만으로 접근할 수 있도록 설정합니다. [SERVICE:ALIAS] 형식을 사용하면 서비스에 별칭으로도 접근할 수 있습니다.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">links</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db</span>
      <span class="pi">-</span> <span class="s">db:database</span>
      <span class="pi">-</span> <span class="s">redis</span>
</code></pre></div></div>
<p><strong>environment</strong> -&gt; docker run 명령어의 –env, -e 옵션과 동일합니다. 서비스의 컨테이너 내부에서 사용할 환경변수를 지정하며, 딕셔너리(Dictionary)나 배열 형태로 사용할 수 있습니다.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">MYSQL_ROOT_PASSWORD=mypassword</span>
      <span class="pi">-</span> <span class="s">MYSQL_DATABASE_NAME=mydb</span>
    <span class="s">or</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">MYSQL_ROOT_PASSOWRD:mypassword</span>
      <span class="pi">-</span> <span class="s">MYSQL_DATABASE_NAME:mydb</span>
</code></pre></div></div>
<p><strong>command</strong> -&gt; 컨테이너가 실행될 때 수행할 명령어를 설정하며, docker run 명령어의 마지막에 붙는 커맨드와 같습니다. Dockerfile의 RUN과 같은 배열 형태로도 사용할 수 있습니다.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
<span class="err">	</span><span class="na">image</span><span class="pi">:</span> <span class="s">seosh817/composetest:web</span>
<span class="na">	command</span><span class="pi">:</span> <span class="s">apachectl -DFOREGROUND</span>
  <span class="s">or</span>
  <span class="s">web</span><span class="err">:</span>
<span class="err">	</span><span class="na">image</span><span class="pi">:</span> <span class="s">seosh817/composetest:web</span>
<span class="na">	command</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">apachectl</span><span class="pi">,</span> <span class="nv">-DFOREGROUND</span><span class="pi">]</span>
</code></pre></div></div>
<p><strong>depends_on</strong> -&gt; 특정 컨테이너에 대한 의존 관계를 나타내며, 이 항목에 명시된 컨테이너가 먼저 생성되고 실행됩니다. 다음 예제에서는 web 컨테이너보다 mysql 컨테이너가 먼저 생성됩니다.</p>

<blockquote>
  <p>links도 depends_on과 같이 컨테이너의 생성 순서와 실행 순서를 정의하지만 depends_on은 서비스 이름으로만 접근할 수 있다는 점이 다릅니다.</p>
</blockquote>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">seosh817/composetest:web</span>
    <span class="s">depends_on</span>
      <span class="s">- mysql</span>
      
  <span class="na">mysql</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">seosh817/composetest:mysql</span>
</code></pre></div></div>
<p>특정 서비스의 컨테이너만 생성하되 의존성이 없는 컨테이너를 생성하려면 –no-deps 옵션을 사용합니다.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker-compose up --no-deps web
</code></pre></div></div>
<p><strong>ports</strong> -&gt; docker run 명령어의 -p와 같으며 서비스의 컨테이너를 개방할 포트를 설정합니다. 그러나 단일 호스트 환경에서 80:80과 같이 호스트의 특정 포트를 서비스의 컨테이너에 연결하면 docker-compose scale 명령어로 서비스의 컨테이너의 수를 늘릴 수 없습니다.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">seosh817/composetest:web</span>
      <span class="s">ports</span><span class="err">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">8080"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">8081-8100"</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
        <span class="s">...</span>
</code></pre></div></div>
<p><strong>build</strong> -&gt; build 항목에 정의된 도커파일에서 이미지를 빌드해 서비스의 컨테이너를 생성하도록 설정합니다. 다음 예제는 ./composetest 디렉토리에 저장된 도커파일로 이미지를 빌드해 컨테이너를 생성합니다. 새롭게 빌드될 이미지의 이름은 image 항목에 정의된 이름인 seosh817/composetest:web이 됩니다.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">./composetest</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">seosh817/composetest:web</span>
</code></pre></div></div>
<p>또한 build 항목에서는 도커파일에 사용될 컨텍스트나 도커파일의 이름, 도커파일에서 사용될 인자 값을 설정할 수 있습니다. 다음과 같이 image 항목을 설정하지 않으면 이미지의 이름은 [프로젝트 이름]:[서비스 이름]이 됩니다.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">build</span><span class="pi">:</span> <span class="s">./composetest</span>
    <span class="na">context</span><span class="pi">:</span> <span class="s">./composetest</span>
    <span class="na">dockerfile</span><span class="pi">:</span> <span class="s">myDockerfile</span>
    <span class="na">args</span><span class="pi">:</span>
      <span class="na">HOST_NAME</span><span class="pi">:</span> <span class="s">web</span>
      <span class="na">HOST_CONFIG</span><span class="pi">:</span> <span class="s">self_config</span>
</code></pre></div></div>
<p><strong>extends</strong> -&gt; 다른 yaml 파일이나 현재 yaml 파일에서 서비스 속성을 상속 받도록 설정합니다. 아래의 docker-compose.yml의 web 서비스는 extend_compose.yml의 extend_web 서비스의 옵션을 그대로 갖게 됩니다. 즉, web 서비스의 컨테이너는 ubuntu:focal 이미지의 80:80 포트로 설정됩니다. file 항목을 설정하지 않으면 현재 yaml 파일에서 extends할 서비스를 찾습니다.</p>

<p><strong>docker-compose.yml 파일</strong></p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.9'</span>
  <span class="na">services</span><span class="pi">:</span>
    <span class="na">web</span><span class="pi">:</span>
      <span class="na">extends</span><span class="pi">:</span>
        <span class="na">file</span><span class="pi">:</span> <span class="s">extend_compose.yml</span>
        <span class="na">service</span><span class="pi">:</span> <span class="s">extend_web</span>
</code></pre></div></div>
<p><strong>extend_compose.yml 파일</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.9'</span>
  <span class="na">services</span><span class="pi">:</span>
    <span class="na">web</span><span class="pi">:</span>
      <span class="na">extend_web</span><span class="pi">:</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">ubuntu:focal</span>
      <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s2">"</span><span class="s">80:80"</span>
</code></pre></div></div>
<h3 id="네트워크-정의">네트워크 정의</h3>
<p><strong>driver</strong> -&gt; 도커 컴포즈는 생성된 컨테이너를 위해 기본적으로 브리지 타입의 네트워크를 생성합니다. 그러나 yaml 파일에서 driver 항목을 정의해 서비스의 컨테이너가 서비스의 컨테이너가 브리지 네트워크가 아닌 다른 네트워크를 사용하도록 설정할 수 있습니다. 특정 드라이버에 필요한 옵션은 하위 항목인 driver_ops로 전달할 수 있습니다.</p>

<p>아래 예제는 docker-compose up -d 명령어로 컨테이너를 생성할 때 mynetwork라는 overlay 타입의 네트워크도 함께 생성하고, myservice 서비스의 네트워크가 mynetwork 네트워크를 사용하도록 설정합니다. 단, overlay 타입의 네트워크는 스웜 모드나 주키퍼를 사용하는 환경이어야만 생성할 수 있습니다.</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.9'</span>
<span class="na">services</span><span class="pi">:</span>
  <span class="na">myservice</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">nginx</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">mynetwork</span>
<span class="na">networks</span><span class="pi">:</span>
  <span class="s">mynetwork</span>
    <span class="s">driver</span><span class="err">:</span> <span class="s">overlay</span>
    <span class="s">driver_opts</span><span class="err">:</span>
      <span class="na">subnet</span><span class="pi">:</span> <span class="s2">"</span><span class="s">255.255.255.0"</span>
      <span class="na">IPAddress</span><span class="pi">:</span> <span class="s2">"</span><span class="s">10.0.0.2"</span>
</code></pre></div></div>
<p><strong>ipam</strong> -&gt; IPAM(IP Address Manager)를 위해 사용할 수 있는 옵션으로서 subnet, ip 범위 등을 설정할 수 있습니다. driver 항목에서는 IPAM을 지원하는 드라이버의 이름을 입력합니다.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="s">...</span>
  
<span class="na">networks</span><span class="pi">:</span>
  <span class="na">ipam</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">mydriver</span>
    <span class="na">config</span><span class="pi">:</span>
      <span class="na">subnet</span><span class="pi">:</span> <span class="s">172.20.0.0/16</span>
      <span class="na">ip_range</span><span class="pi">:</span> <span class="s">172.20.5.0/24</span>
      <span class="na">gateway</span><span class="pi">:</span> <span class="s">172.20.5.1</span>
</code></pre></div></div>
<p><strong>external</strong> -&gt; yaml 파일을 통해 프로젝트를 생성할 때마다 네트워크를 생성하는 것이 아닌, 기존의 네트워크를 사용하도록 설정합니다. 이를 설정하려면 사용하려는 외부 네트워크의 이름을 하위 항목으로 입력한 뒤 external의 값을 true로 설정합니다. external 옵션을 준비된 네트워크를 사용하므로 driver, driver_ops, ipam 옵션과 함께 사용할 수 없습니다.</p>

<p>아래는 서비스의 컨테이너가 기존의 seosh817_network라는 이름의 네트워크를 사용하도록 설정합니다.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">seosh817/composetest:web</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">seosh817_network</span>
<span class="na">networks</span><span class="pi">:</span>
  <span class="na">seosh817_network</span><span class="pi">:</span>
    <span class="na">extenral</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>
<h3 id="볼륨-정의">볼륨 정의</h3>
<p>driver -&gt; 볼륨을 생성할 때 사용될 드라이버를 설정합니다. 어떠한 설정도 하지 않으면 local로 설정되며 사용하는 드라이버에 따라 변경해야 합니다. 드라이버를 사용하기 위한 추가 옵션은 하위 항목인 driver_opts를 통해 인자로 설정할 수 있습니다.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.9'</span>
<span class="na">services</span><span class="pi">:</span>
<span class="nn">...</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">driver</span><span class="pi">:</span> <span class="s">flocker</span>
    <span class="s">driver_opts</span><span class="err">:</span>
      <span class="na">opts</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1"</span>
      <span class="na">opt2</span><span class="pi">:</span> <span class="m">2</span>
</code></pre></div></div>
<p><strong>external</strong> -&gt; 도커 컴포즈는 yaml 파일에서 volume, volume-from 옵션 등을 사용하면 프로젝트마다 볼륨을 생성합니다. 이때 external 옵션을 설정하면 볼륨을 프로젝트를 생성할 때마다 매번 생성하지 않고 기존 볼륨을 사용하도록 설정합니다. 다음 예제에서 myvolume이라는 이름의 외부 볼륨을 web 서비스의 컨테이너에 마운트합니다.</p>
<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">services</span><span class="pi">:</span>
  <span class="na">web</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">seosh817/composetest:web</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">myvolume:/var/www/html</span>

<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">myvolume</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="no">true</span>
</code></pre></div></div>
<h3 id="도커-컴포즈-네트워크">도커 컴포즈 네트워크</h3>
<p>yaml 파일에 네트워크 항목을 정의하지 않으면 도커 컴포즈는 프로젝트 별로 브리지 타입의 네트워크를 생성합니다. 생성된 네트워크의 이름은 [프로젝트 이름]_default로 설정되며, docker-compose up 명령어로 생성되고 docker-compose down 명령어로 삭제됩니다.</p>

<p>docker-compose up 명령어뿐만 아니라 docker-compose scale 명령어로 생성되는 컨테이너 전부가 이 브리지 타입의 네트워크를 사용합니다. 서비스 내의 컨테이너는 –net-alias 서비스의 이름을 갖도록 자동으로 설정되므로 이 네트워크에 속한 컨테이너는 서비스의 이름으로 서비스 내의 컨테이너에 접근할 수 있습니다.</p>

<p><img src="https://velog.velcdn.com/images/dnehgus6975/post/95dad0f6-e344-46a0-a0a5-b49907698067/image.png" alt="" /></p>

<p>예를 들어, web 서비스와 mysql 서비스가 각기 존재할 때 web 서비스의 컨테이너가 mysql이라는 호스트 이름으로 접근하면 mysql 서비스의 컨테이너 중 하나의 IP로 변환(resolve)되며, 컨테이너가 여러개 존재할 경우 라운드 로빈으로 연결을 분산합니다.</p>

<p>따라서 docker-compose scale 명령어로 컨테이너의 수를 늘려도 해당 서비스의 이름으로 서비스의 모든 컨테이너에 접근할 수 있습니다. 서비스의 이름으로 컨테이너에 접근하는 방식은 스웜 모드와 유사하지만 작동 원리는 다릅니다.</p>

<h3 id="도커-컴포즈-명령어">도커 컴포즈 명령어</h3>
<p>도커 컴포즈 명령어들을 정리하겠습니다.</p>

<p>도커 컴포즈 프로젝트 실행
도커 컴포즈 프로젝트는 docker-compose up 명령어로 실행할 수 있습니다.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Foreground로 도커 컴포즈 프로젝트 실행</span>
<span class="nv">$ </span>docker-compose up

<span class="c"># Background로 도커 컴포즈 프로젝트 실행</span>
<span class="nv">$ </span>docker-compose up <span class="nt">-d</span>

<span class="c"># 프로젝트 이름 my-project로 변경하여 도커 컴포즈 프로젝트 실행</span>
<span class="nv">$ </span>docker-compose <span class="nt">-p</span> my-project up <span class="nt">-d</span>

<span class="c"># docker-compose scale 명령어로 각 서비스에 여러개의 컨테이너를 생성</span>
<span class="c"># 단, scale 시 주의할 점은 포트를 여러개 지정하면 충돌이나므로 호스트 포트는 하나만 지정해주어야 함.</span>
<span class="nv">$ </span>docker-compose scale <span class="o">[</span>서비스명]<span class="o">=[</span>컨테이너 갯수]
</code></pre></div></div>
<p>-d 옵션 -&gt; 도커 컴포즈 프로젝트를 백그라운드에서 실행합니다.</p>

<p>-p 옵션 -&gt; 프로젝트 이름을 변경하여 도커 컴포즈 프로젝트를 실행합니다. 만약, -p 옵션으로 명시하지 않으면 컨테이너들은 현재 디렉터리의 이름으로 시작하는 이름을 가지게 됩니다.</p>

<p>도커 컴포즈 프로젝트 종료
도커 컴포즈 프로젝트는 <strong>docker-compose down</strong> 명령어로 종료할 수 있습니다.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 프로젝트 내 컨테이너 및 네트워크 종료 및 제거</span>
<span class="nv">$ </span>docker-compose down

<span class="c"># 프로젝트 내 컨테이너, 네트워크 및 볼륨 종료 및 제거</span>
<span class="nv">$ </span>docker-compose down <span class="nt">-v</span>
</code></pre></div></div>
<p>-v 옵션 -&gt; 도커 컴포즈 프로젝트가 종료할 때 네트워크와 볼륨을 제거 후 종료합니다.</p>

<p>도커 컴포즈 프로젝트 목록 확인
도커 컴포즈 프로젝트 목록은 <strong>docker-compose ps</strong> 명령어로 확인할 수 있습니다.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 도커 컴포즈 프로젝트 목록 확인</span>
<span class="nv">$ </span>docker-compose ps
</code></pre></div></div>


                <!-- Pagination links -->


            </article>

            
                <aside class="see-also">
                    <h2>See also</h2>
                    <ul>
                        
                        
                        
                            <li>
                                <a href="/day5-1/">
                                    
                                        <img src="/linux.png">
                                    
                                    <h3>DevOps&#91;Day5-1&#93; / [리눅스 운영체제]</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/day13-2/">
                                    
                                        <img src="/net.png">
                                    
                                    <h3>DevOps&#91;Day13-2&#93; / [HTTP]</h3>
                                </a>
                            </li>
                        
                            <li>
                                <a href="/day3-1/">
                                    
                                        <img src="/linux.png">
                                    
                                    <h3>DevOps&#91;Day3-1&#93; / [리눅스 운영체제]</h3>
                                </a>
                            </li>
                        
                    </ul>
                </aside>
            

        </section>

        <!-- Add time bar only for pages without pagination -->
        
            <div class="time-bar" data-minutes="12">
    <span class="time-completed"></span>
    <span class="time-remaining"></span>
    <div class="bar">
        <span class="completed" style="width:0%;"></span>
        <span class="remaining" style="width:100%;"></span>
    </div>
</div>

            <div class="recommendation">
    <div class="message">
        <strong>Why don't you read something next?</strong>
        <div>
            <button>
                <svg><use xlink:href="#icon-arrow-right"></use></svg>
                <span>Go back to top</span>
            </button>
        </div>
    </div>
    
    <a href="/day33/" class="post-preview">
        <div class="image">
            
                <img src="/git.png">
            
        </div>
        <h3 class="title">DevOps&#91;Day33&#93; / [지속적 통합]</h3>
    </a>
</div>

        

        <!-- Show modal if the post is the last one -->
        

        <!-- Show modal before user leaves the page -->
        

        <!-- Add your newsletter subscription form here -->

        <section class="share">
    <h3>Share</h3>
    <a aria-label="Share on Twitter" href="https://twitter.com/intent/tweet?text=&quot;도커 Docker Compose&quot;%20http://localhost:4000/day32-2/%20via%20&#64;&hashtags=docker,Dockerfile,Compose,DevOps BootCamp"
    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
        <svg class="icon icon-twitter"><use xlink:href="#icon-twitter"></use></svg>
    </a>
    <a aria-label="Share on Facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/day32-2/"
    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
        <svg class="icon icon-facebook"><use xlink:href="#icon-facebook"></use></svg>
    </a>
</section>

        


        

<section class="comments">
    <h3>Comments</h3>
    <div id="disqus_thread"></div>
</section>
<script type="text/javascript">
    var disqus_loaded = false;

    function load_disqus()
    {
        disqus_loaded = true;
        var disqus_shortname = 'teddynote';
        var disqus_title = '';
        var disqus_url = '/day32-2/';
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        var ldr = document.getElementById('disqus_loader');
    };
    window.onscroll = function(e) {
        if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 800)) {
            //hit bottom of page
            if (disqus_loaded==false)
                load_disqus()
        }
    };
</script>



        <footer>
    <p>
      
        <a href="https://github.com/teddy-woo" title="Github">
          <svg><use xlink:href="#icon-github"></use></svg>
        </a>
      
      
      
      
      
      
    </p>

    <ul>
  
    
      <li>
        <a href="http://localhost:4000/">Home</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/개발%20프로세스와%20DEVOPS%20업무/">1. 개발 프로세스와 DEVOPS 업무</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/리눅스%20운영체제">2. 리눅스 운영체제</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/웹서비스%20개발%20기초/">3. 웹서비스 개발 기초</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/GIT과%20버전%20관리%20시스템/">4. GIT과 버전 관리 시스템</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/(사전준비)%20개발%20환경%20구축/">5. (사전준비) 개발 환경 구축</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/HTTP/">6. HTTP</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/WAS와%20WEB%20SERVER/">7. WAS와 WEB SERVER</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/데이터베이스/">8. 데이터베이스</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/프로젝트%20회고/">9. 프로젝트 회고</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/네트워크%20기초/">10. 네트워크 기초</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/웹%20서버%20프로그램/">11. 웹 서버 프로그램</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/YAML과%20JSON/">12. YAML과 JSON</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/트러블%20슈팅/">13. 트러블 슈팅</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/아마존%20웹%20서비스(AWS)/">14. 아마존 웹 서비스(AWS)</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/Docker/">15. DOCKER(도커)</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/지속적%20통합/">16. 지속적 통합</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/배포%20자동화/">17. 배포 자동화</a>
      </li>
    
  
    
      <li>
        <a href="http://localhost:4000/category/feed.xml/">feed</a>
      </li>
    
  
</ul>


    <p>
      <span>Jekflix</span> was made with <svg class="love"><use xlink:href="#icon-heart"></use></svg> by <a href="https://rossener.com" target="_blank" class="creator">Thiago Rossener</a>
    </p>
</footer>









<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "Teddy-woo's DevOps Challenge!",
  "description": "도현's 데브옵스 도전기! is made by Teddy-woo.",
  "url": "http://localhost:4000/",
  "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:4000/assets/img/icons/mediumtile.png",
      "width": "600",
      "height": "315"
  },
  "sameAs": [
    "https://github.com/teddy-woo"
  ]
}
</script>

<!-- Include the script that allows Netlify CMS login -->
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

<!-- Include the website scripts -->
<script src="/assets/js/scripts.min.js"></script>

<!-- Include Google Analytics script -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YQQ2NQ44TG"></script>
<script>
  var host = window.location.hostname;
  if (host != 'localhost') {
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-YQQ2NQ44TG');
  }
</script>
  


<!-- Include extra scripts -->



        

        
        
        
        
        
        
        
        
        <script type="application/ld+json">
        {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "name": "DevOps&#91;Day32-2&#93; / [Docker]",
            "headline": "도커 Docker Compose",
            "description": "도커 Docker Compose",
            "image": "/docker.png",
            "url": "http://localhost:4000/day32-2/",
            "articleBody": "도커 컴포즈란?
도커 컴포즈는 단일 서버에서 여러개의 컨테이너를 하나의 서비스로 정의해 컨테이너의 묶음으로 관리할 수 있는 작업 환경을 제공하는 관리 도구입니다.



도커 컴포즈를 사용하는 이유
여러 개의 컨테이너가 하나의 어플리케이션으로 동작할 때 도커 컴포즈를 사용하지 않는다면, 이를 테스트하려면 각 컨테이너를 하나씩 생성해야 합니다. 예를 들면, 웹 어플리케이션을 테스트하려면 웹 서버 컨테이너, 데이터베이스 컨테이너 두 개의 컨테이너를 각각 생성해야 합니다.

즉, 아래와 같이 두개의 run 명령어를 입력해야합니다.
$ docker run --name wordpress_db -d mysql:8

$ docker run -d -p 8080:80 \
--link wordpress_db:mysql --name seunghwan_wordpress \
wordpress:latest

위의 예제를 실행하면 wordpress와 mysql 컨테이너를 생성합니다. 이처럼 여러 개의 컨테이너로 구성된 어플리케이션을 구축하기 위해 run 명령어를 여러 번 사용할 수 있지만 각 컨테이너가 제대로 동작하는지 확인하는 테스트 단계에서는 이런식으로 일일히 여러개의 컨테이너를 실행하기는 번거롭습니다. 매번 run 명령어에 옵션을 설정해 CLI로 컨테이너를 생성하기보다는 여러 개의 컨테이너를 하나의 서비스로 정리해 컨테이너 묶음으로 관리할 수 있다면 좀 더 편리할 것입니다. 이를 위해 도커 컴포즈(Docker Compose)는 컨테이너를 이용한 서비스의 개발과 CI를 위해 여러 개의 컨테이너를 하나의 프로젝트로서 다룰 수 있는 작업 환경을 제공합니다.

도커 컴포즈는 여러 개의 컨테이너의 옵션과 환경을 정의한 파일을 읽어 컨테이너를 순차적으로 생성하는 방식으로 동작합니다. 도커 컴포즈의 설정 파일은 도커 엔진의 run 명령어의 옵션을 그대로 사용할 수 있으며, 각 컨테이너의 의존성, 네트워크, 볼륨 등을 함께 정의할 수 있습니다. 또한 스웜모드의 서비스와 유사하게 설정 파일에 정의된 서비스의 컨테이너 수를 유동적으로 조절할 수 있으며 컨테이너의 서비스 디스커버리도 자동으로 이뤄집니다. 그래서 컨테이너의 수가 많아지고 정의해야 할 옵션이 많아지고 정의해야 할 옵션이 많아진다면 도커 컴포즈를 사용하는 것이 좋습니다.

docker run 명령어와 docker compose 사용 비교
docker run 명령어로 컨테이너 생성
아래의 명령어는 CLI에서 docker run 명령어를 이용해서 mysql을 만들고, wordpress를 생성해서 mysql을 연결하는 명령어입니다.
$ docker run -d --name wordpress_db \
	--network seunghwan_network \
	-p 3306:3306 \
	-e MYSQL_ROOT_PASSWORD=seosh817 \
	-e MYSQL_DATABASE=seosh817 \
	-e MYSQL_USER=seosh817 \
	-e MYSQL_PASSWORD=seosh817 \
	-v mysql:/var/lib/mysql \
	--restart unless-stopped \
	mysql:8
    
$ docker run -d --name seunghwan_wordpress \
	--network seunghwan_network \
	-p 8080:80 \
	--link wordpress_db:mysql \
	-e WORDPRESS_DB_HOST=db:3306 \
	-e WORDPRESS_DB_USER=seosh817 \
	-e WORDPRESS_DB_PASSWORD=seosh817 \
	-e WORDPRESS_DB_NAME=seosh817 \
	--restart unless-stopped \
	wordpress:latest

docker-compose.yml로 도커 컴포즈 프로젝트 실행
위에서 docker run 명령어로 컨테이너를 실행하던 것을 docker compose.yml로 변경해 보겠습니다.
version: &apos;3.9&apos;

services:
  db:
    image: mysql:8
    volumes:
    - db:/var/lib/mysql
    restart: unless-stopped
    environment:
    - MYSQL_ROOT_PASSWORD=seosh817
    - MYSQL_DATABASE=seosh817
    - MYSQL_USER=seosh817
    - MYSQL_PASSWORD=seosh817
    networks:
    - wordpress

  wordpress:
    depends_on:
    - db
    image: wordpress:latest
    ports:
    - &quot;8000:80&quot;
    restart: unless-stopped
    environment:
      WORDPRESS_DB_HOST: db:3306
      WORDPRESS_DB_USER: seosh817
      WORDPRESS_DB_PASSWORD: seosh817
      WORDPRESS_DB_NAME: seosh817
    networks:
    - wordpress

volumes:
  db: {}

networks:
  wordpress: {}


  yaml 파일에서 들여쓰기를 할 때 탭(Tab)은 도커 컴포즈가 인식하지 못하므로 2개의 공백(Space)을 사용해서 하위 항목을 구분해야 합니다.


도커 컴포즈를 사용하려면 컨테이너 설정을 저장해 놓은 yaml 파일이 필요합니다. 그러므로 기존에 사용하던 run 명령어를 yaml 파일로 변환하는 것이 도커 컴포즈 사용법의 대부분입니다.

위의 docker-compose.yml 파일을 보면 서비스로 db, wordpress 두개가 존재합니다.

그리고 볼륨으로 db, 네트워크로 wordpress를 생성하고 서비스에서 해당 볼륨과 네트워크를 사용하는 구조로 되어있습니다.

어떠한 설정도 하지 않으면 도커 컴포즈는 현재 디렉토리의 docker-compose.yml 파일을 읽어 로컬의 도커 엔진에게 컨테이너 생성을 요청합니다. docker compse up 명령어로 도커 컴포즈 프로젝트를 실행할 수 있습니다. docker-compose.yml을 읽어 컨테이너를 생성해 보겠습니다.
docker-compose up -d

도커 컴포즈 yaml 파일의 옵션
도커 컴포즈 yaml 파일의 옵션들을 알아보겠습니다.

버전 정의
version -&amp;gt; yaml 파일 포맷의 버전을 나타냅니다. 도커 컴포즈 버전마다 사용하는 yaml 포맷 버전이 있으므로 도커 컴포즈 버전은 도커 엔진 버전에 의존성이 있으므로 가능하면 최신 버전을 사용하는 것이 좋습니다.

서비스 정의
서비스는 도커 컴포즈로 생성할 컨테이너 옵션을 정의합니다. 이 항목에 쓰인 각 서비스는 컨테이너로 구현되며, 하나의 프로젝트로ㅠ서 도커 컴포즈에 의해 관리됩니다. 서비스의 이름은 services의 하위 항목으로 정의하고, 컨테이너의 옵션은 서비스 이름의 하위 항목에 정의합니다.
services:
  container_1:
    image: ...
  container_2:
    image: ...

services -&amp;gt; 생성될 컨테이너들을 묶어놓은 단위입니다. 서비스 항목 아래에는 각 컨테이너에 적용될 생성 옵션을 지정합니다.

image -&amp;gt; 서비스의 컨테이너를 생성할 때 쓰일 이미지의 이름을 설정합니다. 이미지 이름 포맷은 docker run과 같으며 만일 이미지가 도커에 존재하지 않으면 도커 허브에서 자동으로 내려받습니다.
services:
  container_1:
    image: seosh817/composetest:mysql

links -&amp;gt; docker run 명령어의 –link와 같으며, 다른 서비스에 서비스명만으로 접근할 수 있도록 설정합니다. [SERVICE:ALIAS] 형식을 사용하면 서비스에 별칭으로도 접근할 수 있습니다.
services:
  web:
    links:
      - db
      - db:database
      - redis

environment -&amp;gt; docker run 명령어의 –env, -e 옵션과 동일합니다. 서비스의 컨테이너 내부에서 사용할 환경변수를 지정하며, 딕셔너리(Dictionary)나 배열 형태로 사용할 수 있습니다.
services:
  web:
    environment:
      - MYSQL_ROOT_PASSWORD=mypassword
      - MYSQL_DATABASE_NAME=mydb
    or
    environment:
      - MYSQL_ROOT_PASSOWRD:mypassword
      - MYSQL_DATABASE_NAME:mydb

command -&amp;gt; 컨테이너가 실행될 때 수행할 명령어를 설정하며, docker run 명령어의 마지막에 붙는 커맨드와 같습니다. Dockerfile의 RUN과 같은 배열 형태로도 사용할 수 있습니다.
services:
  web:
	image: seosh817/composetest:web
	command: apachectl -DFOREGROUND
  or
  web:
	image: seosh817/composetest:web
	command: [apachectl, -DFOREGROUND]

depends_on -&amp;gt; 특정 컨테이너에 대한 의존 관계를 나타내며, 이 항목에 명시된 컨테이너가 먼저 생성되고 실행됩니다. 다음 예제에서는 web 컨테이너보다 mysql 컨테이너가 먼저 생성됩니다.


  links도 depends_on과 같이 컨테이너의 생성 순서와 실행 순서를 정의하지만 depends_on은 서비스 이름으로만 접근할 수 있다는 점이 다릅니다.


services:
  web:
    image: seosh817/composetest:web
    depends_on
      - mysql
      
  mysql:
    image: seosh817/composetest:mysql

특정 서비스의 컨테이너만 생성하되 의존성이 없는 컨테이너를 생성하려면 –no-deps 옵션을 사용합니다.
$ docker-compose up --no-deps web

ports -&amp;gt; docker run 명령어의 -p와 같으며 서비스의 컨테이너를 개방할 포트를 설정합니다. 그러나 단일 호스트 환경에서 80:80과 같이 호스트의 특정 포트를 서비스의 컨테이너에 연결하면 docker-compose scale 명령어로 서비스의 컨테이너의 수를 늘릴 수 없습니다.
services:
  web:
    image: seosh817/composetest:web
      ports:
        - &quot;8080&quot;
        - &quot;8081-8100&quot;
        - &quot;80:80&quot;
        ...

build -&amp;gt; build 항목에 정의된 도커파일에서 이미지를 빌드해 서비스의 컨테이너를 생성하도록 설정합니다. 다음 예제는 ./composetest 디렉토리에 저장된 도커파일로 이미지를 빌드해 컨테이너를 생성합니다. 새롭게 빌드될 이미지의 이름은 image 항목에 정의된 이름인 seosh817/composetest:web이 됩니다.
services:
  web:
    build: ./composetest
    image: seosh817/composetest:web

또한 build 항목에서는 도커파일에 사용될 컨텍스트나 도커파일의 이름, 도커파일에서 사용될 인자 값을 설정할 수 있습니다. 다음과 같이 image 항목을 설정하지 않으면 이미지의 이름은 [프로젝트 이름]:[서비스 이름]이 됩니다.
services:
  web:
    build: ./composetest
    context: ./composetest
    dockerfile: myDockerfile
    args:
      HOST_NAME: web
      HOST_CONFIG: self_config

extends -&amp;gt; 다른 yaml 파일이나 현재 yaml 파일에서 서비스 속성을 상속 받도록 설정합니다. 아래의 docker-compose.yml의 web 서비스는 extend_compose.yml의 extend_web 서비스의 옵션을 그대로 갖게 됩니다. 즉, web 서비스의 컨테이너는 ubuntu:focal 이미지의 80:80 포트로 설정됩니다. file 항목을 설정하지 않으면 현재 yaml 파일에서 extends할 서비스를 찾습니다.

docker-compose.yml 파일
version: &apos;3.9&apos;
  services:
    web:
      extends:
        file: extend_compose.yml
        service: extend_web

extend_compose.yml 파일
version: &apos;3.9&apos;
  services:
    web:
      extend_web:
      image: ubuntu:focal
      ports:
        - &quot;80:80&quot;

네트워크 정의
driver -&amp;gt; 도커 컴포즈는 생성된 컨테이너를 위해 기본적으로 브리지 타입의 네트워크를 생성합니다. 그러나 yaml 파일에서 driver 항목을 정의해 서비스의 컨테이너가 서비스의 컨테이너가 브리지 네트워크가 아닌 다른 네트워크를 사용하도록 설정할 수 있습니다. 특정 드라이버에 필요한 옵션은 하위 항목인 driver_ops로 전달할 수 있습니다.

아래 예제는 docker-compose up -d 명령어로 컨테이너를 생성할 때 mynetwork라는 overlay 타입의 네트워크도 함께 생성하고, myservice 서비스의 네트워크가 mynetwork 네트워크를 사용하도록 설정합니다. 단, overlay 타입의 네트워크는 스웜 모드나 주키퍼를 사용하는 환경이어야만 생성할 수 있습니다.
version: &apos;3.9&apos;
services:
  myservice:
    image: nginx
    networks:
      - mynetwork
networks:
  mynetwork
    driver: overlay
    driver_opts:
      subnet: &quot;255.255.255.0&quot;
      IPAddress: &quot;10.0.0.2&quot;

ipam -&amp;gt; IPAM(IP Address Manager)를 위해 사용할 수 있는 옵션으로서 subnet, ip 범위 등을 설정할 수 있습니다. driver 항목에서는 IPAM을 지원하는 드라이버의 이름을 입력합니다.
services:
  ...
  
networks:
  ipam:
    driver: mydriver
    config:
      subnet: 172.20.0.0/16
      ip_range: 172.20.5.0/24
      gateway: 172.20.5.1

external -&amp;gt; yaml 파일을 통해 프로젝트를 생성할 때마다 네트워크를 생성하는 것이 아닌, 기존의 네트워크를 사용하도록 설정합니다. 이를 설정하려면 사용하려는 외부 네트워크의 이름을 하위 항목으로 입력한 뒤 external의 값을 true로 설정합니다. external 옵션을 준비된 네트워크를 사용하므로 driver, driver_ops, ipam 옵션과 함께 사용할 수 없습니다.

아래는 서비스의 컨테이너가 기존의 seosh817_network라는 이름의 네트워크를 사용하도록 설정합니다.
services:
  web:
    image: seosh817/composetest:web
    networks:
      - seosh817_network
networks:
  seosh817_network:
    extenral: true

볼륨 정의
driver -&amp;gt; 볼륨을 생성할 때 사용될 드라이버를 설정합니다. 어떠한 설정도 하지 않으면 local로 설정되며 사용하는 드라이버에 따라 변경해야 합니다. 드라이버를 사용하기 위한 추가 옵션은 하위 항목인 driver_opts를 통해 인자로 설정할 수 있습니다.
version: &apos;3.9&apos;
services:
...

volumes:
  driver: flocker
    driver_opts:
      opts: &quot;1&quot;
      opt2: 2

external -&amp;gt; 도커 컴포즈는 yaml 파일에서 volume, volume-from 옵션 등을 사용하면 프로젝트마다 볼륨을 생성합니다. 이때 external 옵션을 설정하면 볼륨을 프로젝트를 생성할 때마다 매번 생성하지 않고 기존 볼륨을 사용하도록 설정합니다. 다음 예제에서 myvolume이라는 이름의 외부 볼륨을 web 서비스의 컨테이너에 마운트합니다.
services:
  web:
    image: seosh817/composetest:web
    volumes:
      - myvolume:/var/www/html

volumes:
  myvolume:
    external: true

도커 컴포즈 네트워크
yaml 파일에 네트워크 항목을 정의하지 않으면 도커 컴포즈는 프로젝트 별로 브리지 타입의 네트워크를 생성합니다. 생성된 네트워크의 이름은 [프로젝트 이름]_default로 설정되며, docker-compose up 명령어로 생성되고 docker-compose down 명령어로 삭제됩니다.

docker-compose up 명령어뿐만 아니라 docker-compose scale 명령어로 생성되는 컨테이너 전부가 이 브리지 타입의 네트워크를 사용합니다. 서비스 내의 컨테이너는 –net-alias 서비스의 이름을 갖도록 자동으로 설정되므로 이 네트워크에 속한 컨테이너는 서비스의 이름으로 서비스 내의 컨테이너에 접근할 수 있습니다.



예를 들어, web 서비스와 mysql 서비스가 각기 존재할 때 web 서비스의 컨테이너가 mysql이라는 호스트 이름으로 접근하면 mysql 서비스의 컨테이너 중 하나의 IP로 변환(resolve)되며, 컨테이너가 여러개 존재할 경우 라운드 로빈으로 연결을 분산합니다.

따라서 docker-compose scale 명령어로 컨테이너의 수를 늘려도 해당 서비스의 이름으로 서비스의 모든 컨테이너에 접근할 수 있습니다. 서비스의 이름으로 컨테이너에 접근하는 방식은 스웜 모드와 유사하지만 작동 원리는 다릅니다.

도커 컴포즈 명령어
도커 컴포즈 명령어들을 정리하겠습니다.

도커 컴포즈 프로젝트 실행
도커 컴포즈 프로젝트는 docker-compose up 명령어로 실행할 수 있습니다.
# Foreground로 도커 컴포즈 프로젝트 실행
$ docker-compose up

# Background로 도커 컴포즈 프로젝트 실행
$ docker-compose up -d

# 프로젝트 이름 my-project로 변경하여 도커 컴포즈 프로젝트 실행
$ docker-compose -p my-project up -d

# docker-compose scale 명령어로 각 서비스에 여러개의 컨테이너를 생성
# 단, scale 시 주의할 점은 포트를 여러개 지정하면 충돌이나므로 호스트 포트는 하나만 지정해주어야 함.
$ docker-compose scale [서비스명]=[컨테이너 갯수]

-d 옵션 -&amp;gt; 도커 컴포즈 프로젝트를 백그라운드에서 실행합니다.

-p 옵션 -&amp;gt; 프로젝트 이름을 변경하여 도커 컴포즈 프로젝트를 실행합니다. 만약, -p 옵션으로 명시하지 않으면 컨테이너들은 현재 디렉터리의 이름으로 시작하는 이름을 가지게 됩니다.

도커 컴포즈 프로젝트 종료
도커 컴포즈 프로젝트는 docker-compose down 명령어로 종료할 수 있습니다.
# 프로젝트 내 컨테이너 및 네트워크 종료 및 제거
$ docker-compose down

# 프로젝트 내 컨테이너, 네트워크 및 볼륨 종료 및 제거
$ docker-compose down -v

-v 옵션 -&amp;gt; 도커 컴포즈 프로젝트가 종료할 때 네트워크와 볼륨을 제거 후 종료합니다.

도커 컴포즈 프로젝트 목록 확인
도커 컴포즈 프로젝트 목록은 docker-compose ps 명령어로 확인할 수 있습니다.
# 도커 컴포즈 프로젝트 목록 확인
$ docker-compose ps

",
            "wordcount": "2178",
            "inLanguage": "ko",
            "dateCreated": "2023-04-19/",
            "datePublished": "2023-04-19/",
            "dateModified": "2023-04-19/",
            "author": {
                "@type": "Person",
                "name": "Mr. Anderson",
                
                "image": "/assets/img/uploads/profile.png",
                
                "jobTitle": "The One",
                "url": "http://localhost:4000/authors/mranderson/",
                "sameAs": [
                    "https://github.com/github_username","https://www.facebook.com/facebook_username","https://twitter.com/twitter_username","https://medium.com/@medium_username","https://www.instagram.com/instagram_username","https://www.linkedin.com/in/linkedin_username"
                ]
            },
            "publisher": {
                "@type": "Organization",
                "name": "Teddy-woo's DevOps Challenge!",
                "url": "http://localhost:4000/",
                "logo": {
                    "@type": "ImageObject",
                    "url": "http://localhost:4000/assets/img/blog-image.png",
                    "width": "600",
                    "height": "315"
                }
            },
            "mainEntityOfPage": "True",
            "genre": "Docker",
            "articleSection": "Docker",
            "keywords": ["docker","Dockerfile","Compose","DevOps BootCamp"]
        }
        </script>
    </body>
</html>
